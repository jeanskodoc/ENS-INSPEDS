<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plateforme d'Analyse - Inspecteurs √âducation</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/pyodide/v0.24.1/full/pyodide.js"></script>
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2980b9;
            --success-color: #2ecc71;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --info-color: #9b59b6;
            --dark-color: #2c3e50;
            --light-color: #f5f5f5;
            --gray-color: #7f8c8d;
            --border-radius: 10px;
            --box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--light-color);
            padding: 20px;
            color: var(--dark-color);
            line-height: 1.6;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            overflow: hidden;
        }

        /* Header */
        header {
            text-align: center;
            padding: 25px 30px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            position: relative;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .platform-name {
            font-size: 1.4rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-info {
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        header h1 {
            color: white;
            margin-bottom: 10px;
            font-size: 1.8rem;
        }

        header p {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1rem;
        }

        /* Navigation */
        .tabs-container {
            background-color: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
            overflow-x: auto;
        }

        .tabs {
            display: flex;
            list-style: none;
            padding: 0;
            margin: 0;
            min-width: 800px;
        }

        .tab {
            padding: 15px 20px;
            cursor: pointer;
            font-weight: 600;
            color: var(--gray-color);
            border-bottom: 3px solid transparent;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
        }

        .tab:hover {
            background-color: #e9ecef;
            color: var(--dark-color);
        }

        .tab.active {
            color: var(--primary-color);
            border-bottom: 3px solid var(--primary-color);
            background-color: white;
        }

        /* Contenu des onglets */
        .tab-content {
            display: none;
            padding: 30px;
            min-height: 500px;
        }

        .tab-content.active {
            display: block;
        }

        /* Section d'importation */
        .import-section {
            background: #f8f9fa;
            padding: 30px;
            border-radius: var(--border-radius);
            margin-bottom: 30px;
            border: 2px dashed var(--primary-color);
            text-align: center;
        }

        .import-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .import-card {
            background: white;
            padding: 25px;
            border-radius: var(--border-radius);
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            border: 2px solid transparent;
        }

        .import-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary-color);
        }

        .import-card i {
            font-size: 3rem;
            color: var(--primary-color);
            margin-bottom: 15px;
        }

        .import-card h3 {
            margin-bottom: 10px;
            color: var(--dark-color);
        }

        .import-card p {
            color: var(--gray-color);
            font-size: 0.9rem;
            margin-bottom: 20px;
        }

        .file-input-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
        }

        .file-input-wrapper input[type=file] {
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }

        /* Boutons */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--secondary-color);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background-color: var(--success-color);
            color: white;
        }

        .btn-secondary:hover {
            background-color: #27ae60;
            transform: translateY(-2px);
        }

        .btn-danger {
            background-color: var(--danger-color);
            color: white;
        }

        .btn-danger:hover {
            background-color: #c0392b;
            transform: translateY(-2px);
        }

        .btn-warning {
            background-color: var(--warning-color);
            color: white;
        }

        .btn-warning:hover {
            background-color: #d68910;
            transform: translateY(-2px);
        }

        .btn-info {
            background-color: var(--info-color);
            color: white;
        }

        .btn-info:hover {
            background-color: #8e44ad;
            transform: translateY(-2px);
        }

        .btn-light {
            background-color: #f8f9fa;
            color: var(--dark-color);
            border: 1px solid #dee2e6;
        }

        .btn-light:hover {
            background-color: #e9ecef;
        }

        .btn-sm {
            padding: 8px 12px;
            font-size: 0.9rem;
        }

        .btn-xs {
            padding: 5px 8px;
            font-size: 0.8rem;
        }

        /* Bouton Retour */
        .btn-return {
            background-color: white;
            color: var(--primary-color);
            border: 2px solid white;
        }

        .btn-return:hover {
            background-color: rgba(255, 255, 255, 0.2);
            color: white;
        }

        /* Sections de donn√©es */
        .data-section {
            margin-bottom: 30px;
            padding: 25px;
            background-color: #f9f9f9;
            border-radius: var(--border-radius);
            border-left: 4px solid var(--primary-color);
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .data-section h2 {
            background-color: var(--primary-color);
            color: white;
            padding: 12px 20px;
            border-radius: 5px;
            margin: -25px -25px 25px -25px;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
        }

        /* Tableaux */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .data-table th {
            background-color: var(--primary-color);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        .data-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #e9ecef;
        }

        .data-table tr:hover {
            background-color: #f8f9fa;
        }

        /* Dashboard */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .dashboard-card {
            background: white;
            padding: 25px;
            border-radius: var(--border-radius);
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }

        .dashboard-card h3 {
            margin-bottom: 15px;
            color: var(--dark-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .chart-container {
            height: 300px;
            margin: 20px 0;
            position: relative;
        }

        /* Statistiques */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #e9ecef;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary-color);
            margin: 10px 0;
        }

        /* Filtres */
        .filter-bar {
            display: flex;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
            padding: 15px;
            background: #f8f9fa;
            border-radius: var(--border-radius);
        }

        .search-box {
            flex: 1;
            min-width: 250px;
            position: relative;
        }

        .search-box i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray-color);
        }

        .search-box input {
            padding-left: 40px;
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }

        /* Onglets secondaires */
        .sub-tabs {
            display: flex;
            border-bottom: 2px solid #dee2e6;
            margin-bottom: 25px;
            overflow-x: auto;
        }

        .sub-tab {
            padding: 12px 25px;
            cursor: pointer;
            font-weight: 600;
            color: var(--gray-color);
            border-bottom: 3px solid transparent;
            transition: var(--transition);
            white-space: nowrap;
        }

        .sub-tab:hover {
            color: var(--dark-color);
        }

        .sub-tab.active {
            color: var(--primary-color);
            border-bottom: 3px solid var(--primary-color);
        }

        .sub-tab-content {
            display: none;
        }

        .sub-tab-content.active {
            display: block;
        }

        /* Badges */
        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-right: 5px;
        }

        .badge-primary {
            background-color: #e3f2fd;
            color: var(--primary-color);
        }

        .badge-success {
            background-color: #e8f5e9;
            color: var(--success-color);
        }

        .badge-warning {
            background-color: #fff3e0;
            color: var(--warning-color);
        }

        .badge-danger {
            background-color: #ffebee;
            color: var(--danger-color);
        }

        .badge-info {
            background-color: #f3e5f5;
            color: var(--info-color);
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            background: var(--success-color);
            color: white;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            z-index: 1000;
            opacity: 0;
            transform: translateY(-20px);
            transition: opacity 0.3s, transform 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
            max-width: 400px;
        }

        .notification.show {
            opacity: 1;
            transform: translateY(0);
        }

        .notification.error {
            background: var(--danger-color);
        }

        .notification.warning {
            background: var(--warning-color);
        }

        .notification.info {
            background: var(--info-color);
        }

        /* Loader */
        .loader {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255,255,255,0.8);
            z-index: 1001;
            align-items: center;
            justify-content: center;
        }

        .loader.active {
            display: flex;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: var(--border-radius);
            padding: 30px;
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #dee2e6;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray-color);
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .container {
                max-width: 100%;
            }
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .container {
                padding: 0;
            }
            
            .tab-content {
                padding: 20px;
            }
            
            .data-section {
                padding: 20px;
            }
            
            .import-grid {
                grid-template-columns: 1fr;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .filter-bar {
                flex-direction: column;
            }
            
            .search-box {
                min-width: 100%;
            }
            
            .sub-tabs {
                flex-wrap: wrap;
            }
            
            .sub-tab {
                padding: 10px 15px;
                font-size: 0.9rem;
            }
            
            .file-type-tabs {
                flex-direction: column;
            }
            
            .header-content {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .header-actions {
                display: flex;
                gap: 10px;
                width: 100%;
                justify-content: space-between;
            }
        }

        /* Utilitaires */
        .hidden {
            display: none !important;
        }

        .text-center {
            text-align: center;
        }

        .text-right {
            text-align: right;
        }

        .mb-20 {
            margin-bottom: 20px;
        }

        .mt-20 {
            margin-top: 20px;
        }

        .mb-30 {
            margin-bottom: 30px;
        }

        .mt-30 {
            margin-top: 30px;
        }

        .d-flex {
            display: flex;
        }

        .align-center {
            align-items: center;
        }

        .justify-between {
            justify-content: space-between;
        }

        .gap-10 {
            gap: 10px;
        }

        .gap-15 {
            gap: 15px;
        }

        .gap-20 {
            gap: 20px;
        }

        .w-100 {
            width: 100%;
        }

        .export-options {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        /* Cartes enseignants */
        .teacher-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .teacher-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-left: 4px solid var(--primary-color);
            transition: var(--transition);
            cursor: pointer;
        }

        .teacher-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
        }

        .teacher-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .teacher-name {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--dark-color);
        }

        .teacher-matricule {
            background: var(--primary-color);
            color: white;
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
        }

        .teacher-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            font-size: 0.9rem;
        }

        .teacher-info-item {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--gray-color);
        }

        .teacher-info-item i {
            color: var(--primary-color);
        }

        /* Fichiers par type */
        .files-by-type {
            margin: 20px 0;
        }

        .file-type-group {
            margin-bottom: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }

        .file-list {
            margin-top: 10px;
            padding-left: 20px;
        }

        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .file-item:last-child {
            border-bottom: none;
        }

        /* Visualisation donn√©es */
        .data-preview {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #ddd;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 0.9rem;
            white-space: pre-wrap;
        }

        /* Header actions */
        .header-actions {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        /* Section Python Analysis */
        .python-editor {
            width: 100%;
            height: 300px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #f8f9fa;
            resize: vertical;
            margin-bottom: 15px;
        }

        .python-output {
            background-color: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            margin-top: 15px;
        }

        .python-script-item {
            padding: 10px 15px;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .python-script-item:hover {
            background-color: #f8f9fa;
            border-color: var(--primary-color);
        }

        .python-analysis-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .python-analysis-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        @media (max-width: 768px) {
            .python-analysis-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Am√©liorations sp√©cifiques pour l'analyse Python */
        .python-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }

        .python-stat-item {
            background: white;
            padding: 10px;
            border-radius: 5px;
            text-align: center;
            border: 1px solid #e9ecef;
        }

        .python-stat-value {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--primary-color);
            margin: 5px 0;
        }

        .python-template-section {
            margin-top: 20px;
        }

        .python-template-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        /* Compatibilit√© avec les fichiers export√©s */
        .compatibility-check {
            padding: 15px;
            background: #e8f5e9;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid var(--success-color);
        }

        .compatibility-check.warning {
            background: #fff3e0;
            border-left-color: var(--warning-color);
        }

        .data-structure-view {
            margin: 15px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .structure-item {
            margin: 5px 0;
            padding: 5px 10px;
            background: white;
            border-radius: 4px;
            border: 1px solid #e9ecef;
        }

        /* Formulaires d'√©dition */
        .edit-form {
            max-width: 800px;
            margin: 0 auto;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark-color);
        }

        .form-control {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
        }

        /* Am√©liorations pour les analyses */
        .analysis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .analysis-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #e9ecef;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .analysis-card h4 {
            margin-bottom: 15px;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .analysis-list {
            list-style: none;
            padding: 0;
        }

        .analysis-list li {
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            justify-content: space-between;
        }

        .analysis-list li:last-child {
            border-bottom: none;
        }

        /* Am√©liorations pour les projets */
        .project-timeline {
            margin: 20px 0;
            padding: 20px;
            background: white;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }

        .timeline-item {
            display: flex;
            margin-bottom: 20px;
            position: relative;
        }

        .timeline-item:last-child {
            margin-bottom: 0;
        }

        .timeline-date {
            min-width: 100px;
            padding-right: 20px;
            text-align: right;
            font-weight: 600;
            color: var(--primary-color);
        }

        .timeline-content {
            flex: 1;
            padding-left: 20px;
            border-left: 3px solid var(--primary-color);
        }

        /* Am√©liorations pour les √©valuations */
        .evaluation-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .metric-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #e9ecef;
        }

        .metric-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary-color);
            margin: 5px 0;
        }

        /* Barre de progression */
        .progress-bar {
            height: 10px;
            background: #e9ecef;
            border-radius: 5px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: var(--primary-color);
            transition: width 0.3s;
        }
    </style>
</head>
<body>
    <!-- Loader -->
    <div class="loader" id="loader">
        <div class="spinner"></div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification">
        <i class="fas fa-check-circle" id="notificationIcon"></i>
        <span id="notificationMessage"></span>
    </div>

    <!-- Container principal -->
    <div class="container">
        <header>
            <div class="header-content">
                <div class="platform-name">
                    <i class="fas fa-chart-line"></i>
                    <span>Plateforme d'Analyse - Inspecteurs √âducation</span>
                </div>
                <div class="header-actions">
                    <div class="user-info">
                        <i class="fas fa-user-shield"></i>
                        <span>Inspecteur - <span id="currentYear"></span></span>
                    </div>
                    <a href="index.html" class="btn btn-return">
                        <i class="fas fa-home"></i> Retour √† l'accueil
                    </a>
                </div>
            </div>
            <h1><i class="fas fa-analytics"></i> ANALYSE DES FICHES ENSEIGNANTS</h1>
            <p>Importation, visualisation et analyse des donn√©es p√©dagogiques compl√®tes</p>
        </header>

        <!-- Navigation principale -->
        <div class="tabs-container">
            <ul class="tabs">
                <li class="tab active" data-tab="tab-import">
                    <i class="fas fa-upload"></i> Importation
                </li>
                <li class="tab" data-tab="tab-python">
                    <i class="fab fa-python"></i> Analyse Python
                </li>
                <li class="tab" data-tab="tab-dashboard">
                    <i class="fas fa-tachometer-alt"></i> Tableau de bord
                </li>
                <li class="tab" data-tab="tab-teachers">
                    <i class="fas fa-users"></i> Enseignants
                </li>
                <li class="tab" data-tab="tab-pedagogy">
                    <i class="fas fa-chalkboard-teacher"></i> P√©dagogie
                </li>
                <li class="tab" data-tab="tab-evaluations">
                    <i class="fas fa-chart-line"></i> √âvaluations
                </li>
                <li class="tab" data-tab="tab-projects">
                    <i class="fas fa-project-diagram"></i> Projets
                </li>
                <li class="tab" data-tab="tab-retirement">
                    <i class="fas fa-umbrella-beach"></i> Retraite
                </li>
                <li class="tab" data-tab="tab-export">
                    <i class="fas fa-download"></i> Export Excel
                </li>
            </ul>
        </div>

        <!-- Onglet Importation -->
        <div id="tab-import" class="tab-content active">
            <div class="import-section">
                <h2><i class="fas fa-file-import"></i> IMPORTATION DES DONN√âES</h2>
                <p>S√©lectionnez le type d'importation ou choisissez un type de fichier sp√©cifique</p>
                
                <!-- Compatibilit√© avec les fichiers export√©s -->
                <div class="compatibility-check">
                    <h4><i class="fas fa-check-circle"></i> Compatibilit√© avec les fichiers de la Fiche Administrative Enseignant</h4>
                    <p>Cette plateforme supporte tous les fichiers JSON export√©s depuis l'application "Fiche Administrative Enseignant" :</p>
                    <ul>
                        <li>Fichiers individuels par onglet (tab1, tab2, tab3, tab4, tab5)</li>
                        <li>Fichier JSON complet (export total)</li>
                        <li>Fichiers multiples d'un m√™me enseignant</li>
                    </ul>
                </div>
                
                <div class="import-grid">
                    <!-- Import fichier unique -->
                    <div class="import-card">
                        <i class="fas fa-file-import"></i>
                        <h3>Import fichier unique</h3>
                        <p>Importez un fichier JSON sp√©cifique (tab1, tab2, etc.)</p>
                        <div class="file-input-wrapper">
                            <button class="btn btn-primary" id="singleFileBtn">
                                <i class="fas fa-upload"></i> Choisir un fichier
                            </button>
                            <input type="file" id="singleFileInput" accept=".json" style="display: none;">
                        </div>
                    </div>

                    <!-- Import multiple -->
                    <div class="import-card">
                        <i class="fas fa-folder-open"></i>
                        <h3>Import multiple</h3>
                        <p>Importez tous les fichiers JSON d'un enseignant</p>
                        <div class="file-input-wrapper">
                            <button class="btn btn-secondary" id="multiFileBtn">
                                <i class="fas fa-folder-open"></i> Choisir des fichiers
                            </button>
                            <input type="file" id="multiFileInput" accept=".json" multiple style="display: none;">
                        </div>
                    </div>

                    <!-- Import dossier -->
                    <div class="import-card">
                        <i class="fas fa-database"></i>
                        <h3>Import complet</h3>
                        <p>Importez un fichier JSON complet (export total)</p>
                        <div class="file-input-wrapper">
                            <button class="btn btn-info" id="completeFileBtn">
                                <i class="fas fa-database"></i> Choisir un fichier
                            </button>
                            <input type="file" id="completeFileInput" accept=".json" style="display: none;">
                        </div>
                    </div>
                </div>

                <!-- Liste des fichiers import√©s -->
                <div class="data-section mt-30" id="importedFilesSection" style="display: none;">
                    <h2><i class="fas fa-list-check"></i> FICHIERS IMPORT√âS</h2>
                    <div id="importedFilesList"></div>
                </div>

                <!-- Vue d'ensemble -->
                <div class="data-section mt-30" id="overviewSection" style="display: none;">
                    <h2><i class="fas fa-eye"></i> VUE D'ENSEMBLE</h2>
                    <div class="stats-grid" id="overviewStats"></div>
                </div>

                <!-- Visualisation des donn√©es -->
                <div class="data-section mt-30" id="dataPreviewSection" style="display: none;">
                    <h2><i class="fas fa-eye"></i> VISUALISATION DES DONN√âES</h2>
                    <select id="dataPreviewSelect" class="w-100 mb-20" style="padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                        <option value="">S√©lectionner un enseignant pour pr√©visualiser...</option>
                    </select>
                    <div id="dataPreviewContent"></div>
                </div>
            </div>
        </div>

        <!-- Onglet Analyse Python -->
        <div id="tab-python" class="tab-content">
            <div class="import-section">
                <h2><i class="fab fa-python"></i> ANALYSE AVEC PYTHON</h2>
                <p>Ex√©cutez des scripts Python pour analyser les donn√©es import√©es</p>
                
                <!-- Indicateur Pyodide -->
                <div id="pyodideStatus" class="compatibility-check" style="display: none;">
                    <h4><i class="fas fa-spinner fa-spin"></i> Chargement de Pyodide...</h4>
                    <p>Initialisation de l'environnement Python dans le navigateur</p>
                </div>
                
                <div class="python-analysis-grid">
                    <div>
                        <div class="python-analysis-controls">
                            <button class="btn btn-primary" onclick="runPythonAnalysis()">
                                <i class="fas fa-play"></i> Ex√©cuter l'analyse
                            </button>
                            <button class="btn btn-secondary" onclick="loadPythonTemplate('basic_analysis')">
                                <i class="fas fa-file-code"></i> Charger un mod√®le
                            </button>
                            <button class="btn btn-info" onclick="savePythonScript()">
                                <i class="fas fa-save"></i> Sauvegarder le script
                            </button>
                            <button class="btn btn-warning" onclick="clearPythonOutput()">
                                <i class="fas fa-broom"></i> Effacer la sortie
                            </button>
                        </div>

                        <textarea class="python-editor" id="pythonEditor" placeholder="√âcrivez votre code Python ici...">
# === ANALYSE DES DONN√âES ENSEIGNANTS ===
# Les donn√©es charg√©es sont disponibles dans la variable 'teachers_data'
# Cette variable contient la liste compl√®te des enseignants import√©s

def analyse_basique(teachers_data):
    """Analyse basique des donn√©es enseignants"""
    if not teachers_data:
        return "‚ö†Ô∏è Aucune donn√©e disponible. Veuillez d'abord importer des donn√©es."
    
    total_enseignants = len(teachers_data)
    fiches_completes = sum(1 for t in teachers_data if t.get('complete', False))
    
    # Calcul des statistiques g√©n√©rales
    stats = {
        'total_enseignants': total_enseignants,
        'fiches_completes': fiches_completes,
        'pourcentage_complet': (fiches_completes / total_enseignants * 100) if total_enseignants > 0 else 0,
        'age_moyen': 0,
        'service_moyen': 0
    }
    
    # Calcul de l'√¢ge moyen
    ages = [t.get('age') for t in teachers_data if t.get('age')]
    if ages:
        stats['age_moyen'] = sum(ages) / len(ages)
    
    # Calcul des ann√©es de service moyennes
    services = [t.get('serviceYears') for t in teachers_data if t.get('serviceYears')]
    if services:
        stats['service_moyen'] = sum(services) / len(services)
    
    return stats

# Ex√©cution de l'analyse
print("üîç ANALYSE DES DONN√âES ENSEIGNANTS")
print("=" * 50)

if 'teachers_data' in globals() and teachers_data:
    resultats = analyse_basique(teachers_data)
    
    print(f"üë• Nombre total d'enseignants: {resultats['total_enseignants']}")
    print(f"‚úÖ Fiches compl√®tes: {resultats['fiches_completes']}")
    print(f"üìä Taux de compl√©tion: {resultats['pourcentage_complet']:.1f}%")
    print(f"üéÇ √Çge moyen: {resultats['age_moyen']:.1f} ans")
    print(f"‚è≥ Service moyen: {resultats['service_moyen']:.1f} ans")
    
    # Analyse par √©tablissement
    print("\nüìå R√âPARTITION PAR √âTABLISSEMENT")
    print("-" * 40)
    
    etablissements = {}
    for teacher in teachers_data:
        etab = teacher.get('establishment', 'Non sp√©cifi√©')
        etablissements[etab] = etablissements.get(etab, 0) + 1
    
    for etab, count in sorted(etablissements.items(), key=lambda x: x[1], reverse=True):
        pourcentage = (count / len(teachers_data) * 100) if teachers_data else 0
        print(f"üè´ {etab}: {count} enseignants ({pourcentage:.1f}%)")
    
    # Analyse des mati√®res
    print("\nüìö MATI√àRES ENSEIGN√âES")
    print("-" * 40)
    
    matieres = {}
    for teacher in teachers_data:
        if teacher.get('data') and teacher['data'].get('subjects'):
            for subject in teacher['data']['subjects']:
                if subject and subject.get('name'):
                    matiere = subject['name']
                    matieres[matiere] = matieres.get(matiere, 0) + 1
    
    if matieres:
        print(f"üìñ Nombre de mati√®res diff√©rentes: {len(matieres)}")
        print("Top 10 des mati√®res les plus enseign√©es:")
        for matiere, count in sorted(matieres.items(), key=lambda x: x[1], reverse=True)[:10]:
            print(f"  ‚Ä¢ {matiere}: {count} enseignants")
    else:
        print("Aucune mati√®re enregistr√©e")
        
else:
    print("‚ùå Aucune donn√©e disponible. Veuillez d'abord importer des donn√©es dans l'onglet 'Importation'.")
                        </textarea>

                        <div class="python-output" id="pythonOutput">
                            <span style="color: #4CAF50;">Sortie Python s'affichera ici...</span>
                            <br><br>
                            <span style="color: #888; font-size: 0.9em;">
                                Ex√©cutez le script pour voir les r√©sultats d'analyse.
                            </span>
                        </div>
                    </div>

                    <div>
                        <div class="data-section">
                            <h3><i class="fas fa-code"></i> Scripts d'analyse pr√©d√©finis</h3>
                            <div class="python-template-grid">
                                <div class="python-script-item" onclick="loadPythonTemplate('basic_analysis')">
                                    <strong><i class="fas fa-chart-bar"></i> Analyse basique</strong>
                                    <p>Statistiques g√©n√©rales des enseignants</p>
                                </div>
                                <div class="python-script-item" onclick="loadPythonTemplate('pedagogy_analysis')">
                                    <strong><i class="fas fa-chalkboard-teacher"></i> Analyse p√©dagogique</strong>
                                    <p>Analyse des donn√©es d'enseignement</p>
                                </div>
                                <div class="python-script-item" onclick="loadPythonTemplate('retirement_analysis')">
                                    <strong><i class="fas fa-umbrella-beach"></i> Planification retraite</strong>
                                    <p>Analyse des d√©parts √† la retraite</p>
                                </div>
                                <div class="python-script-item" onclick="loadPythonTemplate('evaluation_analysis')">
                                    <strong><i class="fas fa-chart-line"></i> Analyse √©valuations</strong>
                                    <p>Statistiques des √©valuations</p>
                                </div>
                                <div class="python-script-item" onclick="loadPythonTemplate('export_analysis')">
                                    <strong><i class="fas fa-file-export"></i> Rapport complet</strong>
                                    <p>G√©n√©ration de rapport d√©taill√©</p>
                                </div>
                                <div class="python-script-item" onclick="loadPythonTemplate('data_validation')">
                                    <strong><i class="fas fa-check-circle"></i> Validation donn√©es</strong>
                                    <p>V√©rification de la qualit√© des donn√©es</p>
                                </div>
                            </div>
                        </div>

                        <div class="data-section mt-20">
                            <h3><i class="fas fa-chart-bar"></i> Statistiques disponibles</h3>
                            <div class="python-stats">
                                <div class="python-stat-item">
                                    <div>Enseignants</div>
                                    <div class="python-stat-value" id="pythonTeacherCount">0</div>
                                </div>
                                <div class="python-stat-item">
                                    <div>Fiches compl√®tes</div>
                                    <div class="python-stat-value" id="pythonCompleteCount">0</div>
                                </div>
                                <div class="python-stat-item">
                                    <div>Mati√®res</div>
                                    <div class="python-stat-value" id="pythonSubjectsCount">0</div>
                                </div>
                                <div class="python-stat-item">
                                    <div>√âtablissements</div>
                                    <div class="python-stat-value" id="pythonEstablishmentsCount">0</div>
                                </div>
                            </div>
                        </div>

                        <div class="data-section mt-20">
                            <h3><i class="fas fa-info-circle"></i> Variables disponibles</h3>
                            <div class="data-preview" style="font-size: 0.85rem;">
# Variables disponibles dans le contexte Python:
# - teachers_data: Liste compl√®te des donn√©es enseignants
#   Chaque enseignant a les propri√©t√©s suivantes:
#   ‚Ä¢ fullName: Nom complet
#   ‚Ä¢ lastName, firstName: Nom et pr√©nom
#   ‚Ä¢ matricule: Num√©ro matricule
#   ‚Ä¢ establishment: √âtablissement
#   ‚Ä¢ age: √Çge (calcul√©)
#   ‚Ä¢ serviceYears: Ann√©es de service
#   ‚Ä¢ complete: Fiche compl√®te (bool√©en)
#   ‚Ä¢ data: Donn√©es structur√©es (√©tablissement, personal, professional, subjects, etc.)

# Exemples d'acc√®s aux donn√©es:
# for teacher in teachers_data:
#     print(f"Enseignant: {teacher['fullName']}")
#     print(f"Matricule: {teacher.get('matricule', 'Non sp√©cifi√©')}")
#     print(f"√âtablissement: {teacher.get('establishment', 'Non sp√©cifi√©')}")
#     
#     if teacher.get('data'):
#         print(f"Mati√®res: {[s['name'] for s in teacher['data'].get('subjects', [])]}")
#         print(f"Date retraite: {teacher['data'].get('professional', {}).get('retirement_date')}")

# Modules Python disponibles:
# - datetime, math, statistics, json, collections, itertools
                            </div>
                        </div>
                    </div>
                </div>

                <div class="data-section mt-30">
                    <h3><i class="fas fa-database"></i> Structure des donn√©es</h3>
                    <div class="data-preview" style="font-size: 0.85rem;">
# Structure compl√®te des donn√©es d'un enseignant:
teacher_example = {
    "id": 1234567890,
    "lastName": "Dupont",
    "firstName": "Jean",
    "fullName": "Jean Dupont",
    "matricule": "12345ABC",
    "establishment": "Lyc√©e Victor Hugo",
    "age": 45,
    "serviceYears": 20,
    "yearsToRetirement": 15,
    "complete": True,
    "files": [
        {
            "name": "tab1_infos.json",
            "type": "tab1",
            "importDate": "2024-01-15T10:30:00Z"
        }
    ],
    "data": {
        "establishment": {
            "name": "Lyc√©e Victor Hugo",
            "type": "lycee",
            "address": "123 Rue de l'√âcole",
            "phone": "01 23 45 67 89",
            "email": "contact@lycee-victor-hugo.fr"
        },
        "personal": {
            "last_name": "Dupont",
            "first_name": "Jean",
            "birth_date": "1979-05-15",
            "birth_place": "Paris",
            "nationality": "Fran√ßaise",
            "address": "456 Rue de la Maison",
            "personal_phone": "06 12 34 56 78"
        },
        "professional": {
            "matricule": "12345ABC",
            "position": "Professeur",
            "grade": "Professeur certifi√©",
            "professional_category": "A2",
            "engagement_date": "2004-09-01",
            "retirement_date": "2039-05-15",
            "weekly_hours": 18
        },
        "subjects": [
            {"name": "Math√©matiques", "type": "main", "hours": 12},
            {"name": "Physique", "type": "secondary", "hours": 6}
        ],
        "lessons": [...],      # Liste des le√ßons (onglet 2)
        "evaluations": [...],  # Liste des √©valuations (onglet 3)
        "projects": [...]      # Liste des projets (onglet 4)
    }
}
                    </div>
                </div>
            </div>
        </div>

        <!-- Onglet Tableau de bord -->
        <div id="tab-dashboard" class="tab-content">
            <div class="filter-bar">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" placeholder="Rechercher un enseignant..." id="dashboardSearch">
                </div>
                <select id="dashboardFilterSubject" class="form-control">
                    <option value="">Toutes les mati√®res</option>
                </select>
                <select id="dashboardFilterCategory" class="form-control">
                    <option value="">Toutes les cat√©gories</option>
                </select>
                <select id="dashboardFilterEstablishment" class="form-control">
                    <option value="">Tous les √©tablissements</option>
                </select>
                <button class="btn btn-primary" onclick="applyDashboardFilters()">
                    <i class="fas fa-filter"></i> Appliquer
                </button>
            </div>

            <!-- Statistiques globales -->
            <div class="data-section">
                <h2><i class="fas fa-chart-bar"></i> STATISTIQUES GLOBALES</h2>
                <div class="stats-grid" id="globalStats"></div>
            </div>

            <!-- Graphiques -->
            <div class="dashboard-grid">
                <div class="dashboard-card">
                    <h3><i class="fas fa-chart-pie"></i> R√©partition par mati√®re</h3>
                    <div class="chart-container">
                        <canvas id="subjectChart"></canvas>
                    </div>
                </div>
                <div class="dashboard-card">
                    <h3><i class="fas fa-chart-line"></i> √âvolution des retraites</h3>
                    <div class="chart-container">
                        <canvas id="retirementChart"></canvas>
                    </div>
                </div>
                <div class="dashboard-card">
                    <h3><i class="fas fa-chart-bar"></i> Heures d'enseignement</h3>
                    <div class="chart-container">
                        <canvas id="hoursChart"></canvas>
                    </div>
                </div>
                <div class="dashboard-card">
                    <h3><i class="fas fa-graduation-cap"></i> R√©partition par √¢ge</h3>
                    <div class="chart-container">
                        <canvas id="ageChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Derni√®res activit√©s -->
            <div class="data-section">
                <h2><i class="fas fa-history"></i> ACTIVIT√âS P√âDAGOGIQUES R√âCENTES</h2>
                <div id="recentActivities"></div>
            </div>

            <!-- Alertes et notifications -->
            <div class="data-section">
                <h2><i class="fas fa-bell"></i> ALERTES ET RECOMMANDATIONS</h2>
                <div id="alertsContainer"></div>
            </div>
        </div>

        <!-- Onglet Enseignants -->
        <div id="tab-teachers" class="tab-content">
            <div class="filter-bar">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" placeholder="Rechercher par nom, matricule..." id="teacherSearch">
                </div>
                <button class="btn btn-light" onclick="sortTeachers('name')">
                    <i class="fas fa-sort-alpha-down"></i> Trier par nom
                </button>
                <button class="btn btn-light" onclick="sortTeachers('retirement')">
                    <i class="fas fa-calendar"></i> Trier par retraite
                </button>
                <button class="btn btn-light" onclick="filterCompleteOnly()">
                    <i class="fas fa-check-circle"></i> Fiches compl√®tes
                </button>
                <button class="btn btn-primary" onclick="addNewTeacher()">
                    <i class="fas fa-plus"></i> Ajouter enseignant
                </button>
            </div>

            <!-- Liste des enseignants -->
            <div id="teachersListContainer">
                <div class="teacher-cards" id="teachersCards"></div>
            </div>

            <!-- Pagination -->
            <div class="filter-bar" id="teachersPagination" style="display: none;">
                <button class="btn btn-light" onclick="changeTeacherPage(-1)">
                    <i class="fas fa-chevron-left"></i> Pr√©c√©dent
                </button>
                <span id="teacherPageInfo"></span>
                <button class="btn btn-light" onclick="changeTeacherPage(1)">
                    Suivant <i class="fas fa-chevron-right"></i>
                </button>
            </div>
        </div>

        <!-- Onglet P√©dagogie -->
        <div id="tab-pedagogy" class="tab-content">
            <!-- Sous-onglets p√©dagogie -->
            <div class="sub-tabs">
                <div class="sub-tab active" data-subtab="pedagogy-overview">Vue d'ensemble</div>
                <div class="sub-tab" data-subtab="pedagogy-subjects">Mati√®res enseign√©es</div>
                <div class="sub-tab" data-subtab="pedagogy-lessons">Le√ßons</div>
                <div class="sub-tab" data-subtab="pedagogy-tp">Travaux pratiques</div>
                <div class="sub-tab" data-subtab="pedagogy-resources">Ressources</div>
            </div>

            <!-- Sous-contenus -->
            <div class="sub-tab-content active" data-subtab="pedagogy-overview">
                <div class="data-section">
                    <h2><i class="fas fa-chart-bar"></i> STATISTIQUES P√âDAGOGIQUES</h2>
                    <div id="pedagogyStats"></div>
                </div>
                
                <div class="dashboard-grid">
                    <div class="dashboard-card">
                        <h3><i class="fas fa-chart-pie"></i> R√©partition des mati√®res</h3>
                        <div class="chart-container">
                            <canvas id="pedagogySubjectsChart"></canvas>
                        </div>
                    </div>
                    <div class="dashboard-card">
                        <h3><i class="fas fa-chart-bar"></i> Charge horaire</h3>
                        <div class="chart-container">
                            <canvas id="pedagogyHoursChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <div class="sub-tab-content" data-subtab="pedagogy-subjects">
                <div class="data-section">
                    <h2><i class="fas fa-book"></i> MATI√àRES ENSEIGN√âES</h2>
                    <div id="subjectsAnalysis"></div>
                </div>
            </div>

            <div class="sub-tab-content" data-subtab="pedagogy-lessons">
                <div class="data-section">
                    <h2><i class="fas fa-chalkboard"></i> LE√áONS ENREGISTR√âES</h2>
                    <div id="lessonsAnalysis"></div>
                </div>
            </div>

            <div class="sub-tab-content" data-subtab="pedagogy-tp">
                <div class="data-section">
                    <h2><i class="fas fa-flask"></i> TRAVAUX PRATIQUES</h2>
                    <div id="tpAnalysis"></div>
                </div>
            </div>

            <div class="sub-tab-content" data-subtab="pedagogy-resources">
                <div class="data-section">
                    <h2><i class="fas fa-file-alt"></i> RESSOURCES P√âDAGOGIQUES</h2>
                    <div id="resourcesAnalysis"></div>
                </div>
            </div>
        </div>

        <!-- Onglet √âvaluations -->
        <div id="tab-evaluations" class="tab-content">
            <div class="filter-bar">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" placeholder="Rechercher par mati√®re ou type..." id="evaluationSearch">
                </div>
                <select id="evaluationTypeFilter" class="form-control">
                    <option value="">Tous les types</option>
                    <option value="examen">Examen</option>
                    <option value="contr√¥le">Contr√¥le</option>
                    <option value="devoir">Devoir</option>
                    <option value="oral">Oral</option>
                </select>
                <button class="btn btn-primary" onclick="applyEvaluationFilters()">
                    <i class="fas fa-filter"></i> Filtrer
                </button>
            </div>

            <div class="data-section">
                <h2><i class="fas fa-chart-line"></i> STATISTIQUES D'√âVALUATION</h2>
                <div class="stats-grid" id="evaluationStats"></div>
            </div>

            <div class="dashboard-grid">
                <div class="dashboard-card">
                    <h3><i class="fas fa-chart-bar"></i> Distribution des notes</h3>
                    <div class="chart-container">
                        <canvas id="gradesDistributionChart"></canvas>
                    </div>
                </div>
                <div class="dashboard-card">
                    <h3><i class="fas fa-chart-line"></i> √âvolution des moyennes</h3>
                    <div class="chart-container">
                        <canvas id="gradesEvolutionChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="data-section">
                <h2><i class="fas fa-table"></i> ANALYSE DES √âVALUATIONS</h2>
                <div id="evaluationsAnalysis"></div>
            </div>
        </div>

        <!-- Onglet Projets -->
        <div id="tab-projects" class="tab-content">
            <div class="filter-bar">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" placeholder="Rechercher un projet..." id="projectSearch">
                </div>
                <select id="projectStatusFilter" class="form-control">
                    <option value="">Tous les statuts</option>
                    <option value="en_cours">En cours</option>
                    <option value="termine">Termin√©</option>
                    <option value="planifie">Planifi√©</option>
                </select>
                <button class="btn btn-primary" onclick="applyProjectFilters()">
                    <i class="fas fa-filter"></i> Filtrer
                </button>
                <button class="btn btn-success" onclick="addNewProject()">
                    <i class="fas fa-plus"></i> Nouveau projet
                </button>
            </div>

            <div class="data-section">
                <h2><i class="fas fa-project-diagram"></i> STATISTIQUES DES PROJETS</h2>
                <div class="stats-grid" id="projectsStats"></div>
            </div>

            <div class="dashboard-grid">
                <div class="dashboard-card">
                    <h3><i class="fas fa-chart-pie"></i> R√©partition par statut</h3>
                    <div class="chart-container">
                        <canvas id="projectsStatusChart"></canvas>
                    </div>
                </div>
                <div class="dashboard-card">
                    <h3><i class="fas fa-chart-bar"></i> Projets par enseignant</h3>
                    <div class="chart-container">
                        <canvas id="projectsByTeacherChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="data-section">
                <h2><i class="fas fa-table"></i> PROJETS ET ACTIVIT√âS</h2>
                <div id="projectsAnalysis"></div>
            </div>

            <div class="data-section">
                <h2><i class="fas fa-calendar-alt"></i> CALENDRIER DES PROJETS</h2>
                <div id="projectsCalendar"></div>
            </div>
        </div>

        <!-- Onglet Retraite -->
        <div id="tab-retirement" class="tab-content">
            <div class="filter-bar">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" placeholder="Rechercher par nom..." id="retirementSearch">
                </div>
                <select id="retirementYearFilter" class="form-control">
                    <option value="">Toutes les ann√©es</option>
                </select>
                <button class="btn btn-primary" onclick="applyRetirementFilters()">
                    <i class="fas fa-filter"></i> Filtrer
                </button>
                <button class="btn btn-warning" onclick="generateRetirementReport()">
                    <i class="fas fa-file-pdf"></i> Rapport retraite
                </button>
            </div>

            <div class="dashboard-grid">
                <div class="dashboard-card">
                    <h3><i class="fas fa-calendar-times"></i> Prochaines retraites</h3>
                    <div id="upcomingRetirements"></div>
                </div>
                <div class="dashboard-card">
                    <h3><i class="fas fa-chart-bar"></i> R√©partition par ann√©e</h3>
                    <div class="chart-container">
                        <canvas id="retirementYearChart"></canvas>
                    </div>
                </div>
                <div class="dashboard-card">
                    <h3><i class="fas fa-exclamation-triangle"></i> Alertes retraite</h3>
                    <div id="retirementAlerts"></div>
                </div>
                <div class="dashboard-card">
                    <h3><i class="fas fa-calendar-alt"></i> Calendrier des d√©parts</h3>
                    <div id="retirementCalendar"></div>
                </div>
            </div>

            <div class="data-section">
                <h2><i class="fas fa-table"></i> TABLEAU DES RETRAITES</h2>
                <div id="retirementTable"></div>
            </div>

            <!-- Analyse de la retraite -->
            <div class="data-section">
                <h2><i class="fas fa-chart-pie"></i> ANALYSE PAR CAT√âGORIE</h2>
                <div class="stats-grid" id="retirementAnalysis"></div>
            </div>

            <!-- Plan de remplacement -->
            <div class="data-section">
                <h2><i class="fas fa-user-plus"></i> PLAN DE REMPLACEMENT</h2>
                <div id="replacementPlan"></div>
            </div>
        </div>

        <!-- Onglet Export Excel -->
        <div id="tab-export" class="tab-content">
            <div class="import-section">
                <h2><i class="fas fa-file-excel"></i> EXPORT EXCEL</h2>
                <p>Exportez toutes les donn√©es analys√©es au format Excel</p>

                <div class="export-options">
                    <button class="btn btn-success" onclick="exportAllToExcel()">
                        <i class="fas fa-file-excel"></i> Export complet
                    </button>
                    <button class="btn btn-primary" onclick="exportTeachersToExcel()">
                        <i class="fas fa-users"></i> Liste enseignants
                    </button>
                    <button class="btn btn-info" onclick="exportPedagogyToExcel()">
                        <i class="fas fa-chalkboard-teacher"></i> Donn√©es p√©dagogiques
                    </button>
                    <button class="btn btn-warning" onclick="exportEvaluationsToExcel()">
                        <i class="fas fa-chart-line"></i> Donn√©es √©valuations
                    </button>
                    <button class="btn btn-secondary" onclick="exportRetirementToExcel()">
                        <i class="fas fa-umbrella-beach"></i> Planification retraite
                    </button>
                    <button class="btn btn-secondary" onclick="exportProjectsToExcel()">
                        <i class="fas fa-project-diagram"></i> Projets et activit√©s
                    </button>
                    <button class="btn btn-info" onclick="exportCustomExcel()">
                        <i class="fas fa-cog"></i> Export personnalis√©
                    </button>
                </div>

                <!-- Options d'export avanc√©es -->
                <div class="data-section mt-30">
                    <h2><i class="fas fa-sliders-h"></i> OPTIONS D'EXPORT AVANC√âES</h2>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Format de fichier</label>
                            <select id="exportFormat" class="form-control">
                                <option value="xlsx">Excel (.xlsx)</option>
                                <option value="csv">CSV (.csv)</option>
                                <option value="json">JSON (.json)</option>
                                <option value="pdf">PDF (.pdf)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Encodage</label>
                            <select id="exportEncoding" class="form-control">
                                <option value="utf-8">UTF-8</option>
                                <option value="iso-8859-1">ISO-8859-1</option>
                                <option value="windows-1252">Windows-1252</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Inclure les donn√©es</label>
                        <div>
                            <label style="display: inline-block; margin-right: 20px;">
                                <input type="checkbox" id="exportIncludeStats" checked> Statistiques
                            </label>
                            <label style="display: inline-block; margin-right: 20px;">
                                <input type="checkbox" id="exportIncludeCharts" checked> Graphiques
                            </label>
                            <label style="display: inline-block; margin-right: 20px;">
                                <input type="checkbox" id="exportIncludeRaw" checked> Donn√©es brutes
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Aper√ßu des donn√©es √† exporter -->
                <div class="data-section mt-30">
                    <h2><i class="fas fa-eye"></i> APER√áU DES DONN√âES √Ä EXPORTER</h2>
                    <div id="exportPreview"></div>
                </div>
            </div>
        </div>

        <!-- Actions globales -->
        <div class="filter-bar" style="margin-top: 30px;">
            <a href="index.html" class="btn btn-light">
                <i class="fas fa-home"></i> Retour √† l'accueil
            </a>
            <button class="btn btn-light" onclick="clearAllData()">
                <i class="fas fa-trash"></i> Effacer toutes les donn√©es
            </button>
            <button class="btn btn-info" onclick="generateReport()">
                <i class="fas fa-file-pdf"></i> G√©n√©rer rapport
            </button>
            <button class="btn btn-primary" onclick="saveSession()">
                <i class="fas fa-save"></i> Sauvegarder la session
            </button>
            <button class="btn btn-secondary" onclick="backupData()">
                <i class="fas fa-download"></i> Exporter session
            </button>
            <button class="btn btn-warning" onclick="showSettings()">
                <i class="fas fa-cog"></i> Param√®tres
            </button>
        </div>
    </div>

    <!-- Modal pour l'√©dition d'un enseignant -->
    <div class="modal" id="teacherEditModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="teacherEditTitle">√âditer un enseignant</h3>
                <button class="modal-close" onclick="closeTeacherEdit()">&times;</button>
            </div>
            <div id="teacherEditContent"></div>
        </div>
    </div>

    <!-- Modal pour l'ajout d'un projet -->
    <div class="modal" id="projectEditModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="projectEditTitle">Nouveau projet</h3>
                <button class="modal-close" onclick="closeProjectEdit()">&times;</button>
            </div>
            <div id="projectEditContent"></div>
        </div>
    </div>

    <!-- Modal des param√®tres -->
    <div class="modal" id="settingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-cog"></i> Param√®tres</h3>
                <button class="modal-close" onclick="closeSettings()">&times;</button>
            </div>
            <div id="settingsContent">
                <div class="form-group">
                    <label class="form-label">Langue</label>
                    <select id="languageSetting" class="form-control">
                        <option value="fr">Fran√ßais</option>
                        <option value="en">English</option>
                        <option value="es">Espa√±ol</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Th√®me</label>
                    <select id="themeSetting" class="form-control">
                        <option value="light">Clair</option>
                        <option value="dark">Sombre</option>
                        <option value="auto">Automatique</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">
                        <input type="checkbox" id="autoSaveSetting" checked> Sauvegarde automatique
                    </label>
                </div>
                <div class="form-group">
                    <label class="form-label">
                        <input type="checkbox" id="notificationsSetting" checked> Notifications
                    </label>
                </div>
                <div class="form-group">
                    <label class="form-label">Taille des polices</label>
                    <select id="fontSizeSetting" class="form-control">
                        <option value="small">Petite</option>
                        <option value="medium" selected>Moyenne</option>
                        <option value="large">Grande</option>
                    </select>
                </div>
                <div class="form-group">
                    <button class="btn btn-primary" onclick="saveSettings()">
                        <i class="fas fa-save"></i> Sauvegarder les param√®tres
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Variables globales
        let teachersData = [];
        let currentTeacherIndex = -1;
        let charts = {};
        let filteredTeachers = [];
        let currentFileType = 'all';
        let pyodide = null;
        let currentSort = { field: 'lastName', direction: 'asc' };
        let showCompleteOnly = false;
        let pyodideLoaded = false;
        let currentTeacherPage = 1;
        let teachersPerPage = 12;
        let filteredProjects = [];
        let filteredEvaluations = [];
        let appSettings = {
            language: 'fr',
            theme: 'light',
            autoSave: true,
            notifications: true,
            fontSize: 'medium'
        };

        // Types de fichiers support√©s
        const FILE_TYPES = {
            'tab1': {
                name: 'Informations G√©n√©rales',
                icon: 'fa-user-tie',
                description: 'Donn√©es personnelles, professionnelles et √©tablissement'
            },
            'tab2': {
                name: 'Enseignement & P√©dagogie',
                icon: 'fa-chalkboard-teacher',
                description: 'Planning, le√ßons, TP, ressources'
            },
            'tab3': {
                name: '√âvaluations & Statistiques',
                icon: 'fa-chart-line',
                description: '√âvaluations, performances, statistiques'
            },
            'tab4': {
                name: 'Projets & Activit√©s',
                icon: 'fa-project-diagram',
                description: 'Projets p√©dagogiques, activit√©s, r√©unions'
            },
            'tab5': {
                name: 'Donn√©es & Archives',
                icon: 'fa-database',
                description: 'Sauvegardes, logs, donn√©es techniques'
            },
            'complete': {
                name: 'Fichier complet',
                icon: 'fa-database',
                description: 'Toutes les donn√©es en un seul fichier'
            }
        };

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            initApp();
        });

        async function initApp() {
            // Initialiser l'ann√©e
            const currentYear = new Date().getFullYear();
            document.getElementById('currentYear').textContent = currentYear;
            
            // Charger les param√®tres
            loadSettings();
            
            // Appliquer les param√®tres
            applySettings();
            
            // Gestion des onglets
            initTabs();
            
            // Gestion des sous-onglets
            initSubTabs();
            
            // Initialiser les √©v√©nements des boutons
            initButtons();
            
            // Initialiser les filtres
            initFilters();
            
            // Charger les donn√©es de session
            loadSessionData();
            
            // Initialiser les √©v√©nements
            initEvents();
            
            // Initialiser Pyodide
            await initPyodide();
            
            showNotification('Plateforme d\'analyse pr√™te', 'success');
        }

        // Initialisation de Pyodide
        async function initPyodide() {
            const statusElement = document.getElementById('pyodideStatus');
            if (statusElement) {
                statusElement.style.display = 'block';
            }
            
            showLoader(true);
            
            try {
                pyodide = await loadPyodide({
                    indexURL: "https://cdn.jsdelivr.net/pyodide/v0.24.1/full/"
                });
                
                // Charger les packages n√©cessaires
                await pyodide.loadPackage(['micropip', 'numpy', 'pandas']);
                
                pyodideLoaded = true;
                
                if (statusElement) {
                    statusElement.innerHTML = `
                        <h4><i class="fas fa-check-circle" style="color: #2ecc71;"></i> Pyodide charg√© avec succ√®s</h4>
                        <p>Environnement Python pr√™t pour l'analyse des donn√©es</p>
                    `;
                }
                
                console.log('Pyodide charg√© avec succ√®s');
                showNotification('Environnement Python pr√™t pour l\'analyse', 'success');
                
                // Cacher le statut apr√®s 3 secondes
                setTimeout(() => {
                    if (statusElement) {
                        statusElement.style.display = 'none';
                    }
                }, 3000);
                
            } catch (error) {
                console.error('Erreur lors du chargement de Pyodide:', error);
                if (statusElement) {
                    statusElement.innerHTML = `
                        <h4><i class="fas fa-exclamation-triangle" style="color: #f39c12;"></i> Pyodide non disponible</h4>
                        <p>L'analyse Python est limit√©e. Certaines fonctionnalit√©s peuvent ne pas √™tre disponibles.</p>
                    `;
                }
                showNotification('Pyodide non disponible - analyse Python limit√©e', 'warning');
            } finally {
                showLoader(false);
            }
        }

        // Initialiser les onglets
        function initTabs() {
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    switchTab(tabId);
                });
            });
        }

        function initSubTabs() {
            const subTabs = document.querySelectorAll('.sub-tab');
            subTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const subtabId = this.getAttribute('data-subtab');
                    switchSubTab(subtabId);
                });
            });
        }

        function initButtons() {
            // Boutons d'importation
            document.getElementById('singleFileBtn').addEventListener('click', function() {
                document.getElementById('singleFileInput').click();
            });
            
            document.getElementById('multiFileBtn').addEventListener('click', function() {
                document.getElementById('multiFileInput').click();
            });
            
            document.getElementById('completeFileBtn').addEventListener('click', function() {
                document.getElementById('completeFileInput').click();
            });
            
            // Gestion des inputs de fichiers
            document.getElementById('singleFileInput').addEventListener('change', handleSingleFileImport);
            document.getElementById('multiFileInput').addEventListener('change', handleMultiFileImport);
            document.getElementById('completeFileInput').addEventListener('change', handleCompleteFileImport);
        }

        function initFilters() {
            // Initialiser les filtres avec les donn√©es disponibles
            updateFilterOptions();
        }

        function initEvents() {
            // Recherche
            const dashboardSearch = document.getElementById('dashboardSearch');
            if (dashboardSearch) {
                dashboardSearch.addEventListener('input', filterDashboard);
            }
            
            const teacherSearch = document.getElementById('teacherSearch');
            if (teacherSearch) {
                teacherSearch.addEventListener('input', filterTeachers);
            }
            
            const evaluationSearch = document.getElementById('evaluationSearch');
            if (evaluationSearch) {
                evaluationSearch.addEventListener('input', filterEvaluations);
            }
            
            const projectSearch = document.getElementById('projectSearch');
            if (projectSearch) {
                projectSearch.addEventListener('input', filterProjects);
            }
            
            const retirementSearch = document.getElementById('retirementSearch');
            if (retirementSearch) {
                retirementSearch.addEventListener('input', filterRetirement);
            }
            
            // Pr√©visualisation des donn√©es
            const dataPreviewSelect = document.getElementById('dataPreviewSelect');
            if (dataPreviewSelect) {
                dataPreviewSelect.addEventListener('change', function() {
                    previewTeacherData(this.value);
                });
            }
        }

        function switchTab(tabId) {
            // D√©sactiver tous les onglets
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            // Activer l'onglet s√©lectionn√©
            const tabElement = document.querySelector(`[data-tab="${tabId}"]`);
            const tabContent = document.getElementById(tabId);
            
            if (tabElement) tabElement.classList.add('active');
            if (tabContent) tabContent.classList.add('active');
            
            // Mettre √† jour l'interface sp√©cifique
            updateTabUI(tabId);
        }

        function switchSubTab(subtabId) {
            // D√©sactiver tous les sous-onglets
            document.querySelectorAll('.sub-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.sub-tab-content').forEach(c => c.classList.remove('active'));
            
            // Activer le sous-onglet s√©lectionn√©
            const subTabElement = document.querySelector(`.sub-tab[data-subtab="${subtabId}"]`);
            const subTabContent = document.querySelector(`.sub-tab-content[data-subtab="${subtabId}"]`);
            
            if (subTabElement) subTabElement.classList.add('active');
            if (subTabContent) subTabContent.classList.add('active');
            
            // Mettre √† jour le contenu sp√©cifique
            updateSubTabUI(subtabId);
        }

        function updateTabUI(tabId) {
            switch(tabId) {
                case 'tab-dashboard':
                    updateDashboard();
                    break;
                case 'tab-teachers':
                    updateTeachersList();
                    break;
                case 'tab-python':
                    updatePythonStats();
                    break;
                case 'tab-pedagogy':
                    updatePedagogyOverview();
                    break;
                case 'tab-evaluations':
                    updateEvaluationsOverview();
                    break;
                case 'tab-projects':
                    updateProjectsOverview();
                    break;
                case 'tab-retirement':
                    updateRetirementOverview();
                    break;
                case 'tab-export':
                    updateExportPreview();
                    break;
            }
        }

        function updateSubTabUI(subtabId) {
            // Mettre √† jour le contenu sp√©cifique du sous-onglet
            switch(subtabId) {
                case 'pedagogy-overview':
                    updatePedagogyOverview();
                    break;
                case 'pedagogy-subjects':
                    updateSubjectsAnalysis();
                    break;
                case 'pedagogy-lessons':
                    updateLessonsAnalysis();
                    break;
                case 'pedagogy-tp':
                    updateTPAnalysis();
                    break;
                case 'pedagogy-resources':
                    updateResourcesAnalysis();
                    break;
            }
        }

        // Mettre √† jour les options des filtres
        function updateFilterOptions() {
            updateEstablishmentFilter();
            updateSubjectFilter();
            updateRetirementYearFilter();
        }

        function updateEstablishmentFilter() {
            const establishmentSelect = document.getElementById('dashboardFilterEstablishment');
            if (!establishmentSelect) return;
            
            // Sauvegarder la valeur s√©lectionn√©e
            const currentValue = establishmentSelect.value;
            
            // Nettoyer les options (garder la premi√®re)
            while (establishmentSelect.options.length > 1) {
                establishmentSelect.remove(1);
            }
            
            // R√©cup√©rer les √©tablissements uniques
            const establishments = [...new Set(teachersData.map(t => t.establishment).filter(Boolean))].sort();
            
            // Ajouter les options
            establishments.forEach(etab => {
                const option = document.createElement('option');
                option.value = etab;
                option.textContent = etab;
                establishmentSelect.appendChild(option);
            });
            
            // Restaurer la valeur s√©lectionn√©e si elle existe encore
            if (establishments.includes(currentValue)) {
                establishmentSelect.value = currentValue;
            }
        }

        function updateSubjectFilter() {
            const subjectSelect = document.getElementById('dashboardFilterSubject');
            if (!subjectSelect) return;
            
            // Sauvegarder la valeur s√©lectionn√©e
            const currentValue = subjectSelect.value;
            
            // Nettoyer les options (garder la premi√®re)
            while (subjectSelect.options.length > 1) {
                subjectSelect.remove(1);
            }
            
            // R√©cup√©rer les mati√®res uniques
            const subjects = new Set();
            teachersData.forEach(teacher => {
                if (teacher.data && teacher.data.subjects) {
                    teacher.data.subjects.forEach(subject => {
                        if (subject && subject.name) {
                            subjects.add(subject.name);
                        }
                    });
                }
            });
            
            // Ajouter les options
            Array.from(subjects).sort().forEach(subject => {
                const option = document.createElement('option');
                option.value = subject;
                option.textContent = subject;
                subjectSelect.appendChild(option);
            });
            
            // Restaurer la valeur s√©lectionn√©e si elle existe encore
            if (subjects.has(currentValue)) {
                subjectSelect.value = currentValue;
            }
        }

        function updateRetirementYearFilter() {
            const yearSelect = document.getElementById('retirementYearFilter');
            if (!yearSelect) return;
            
            // Sauvegarder la valeur s√©lectionn√©e
            const currentValue = yearSelect.value;
            
            // Nettoyer les options (garder la premi√®re)
            while (yearSelect.options.length > 1) {
                yearSelect.remove(1);
            }
            
            // R√©cup√©rer les ann√©es de retraite uniques
            const years = new Set();
            teachersData.forEach(teacher => {
                if (teacher.data && teacher.data.professional && teacher.data.professional.retirement_date) {
                    try {
                        const date = new Date(teacher.data.professional.retirement_date);
                        years.add(date.getFullYear());
                    } catch (error) {
                        console.error('Erreur lors de l\'extraction de l\'ann√©e de retraite:', error);
                    }
                }
            });
            
            // Ajouter les options
            Array.from(years).sort().forEach(year => {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = year;
                yearSelect.appendChild(option);
            });
            
            // Restaurer la valeur s√©lectionn√©e si elle existe encore
            if (years.has(parseInt(currentValue))) {
                yearSelect.value = currentValue;
            }
        }

        // ============================================
        // FONCTIONS D'IMPORTATION COMPL√àTES
        // ============================================

        async function handleSingleFileImport(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            showLoader(true);
            
            try {
                const text = await file.text();
                const data = JSON.parse(text);
                
                // Traiter le fichier unique
                processImportedFile(file.name, data, 'single');
                
                showNotification(`Fichier ${file.name} import√© avec succ√®s`, 'success');
                
            } catch (error) {
                console.error('Erreur lors de l\'importation:', error);
                showNotification(`Erreur lors de l'importation: ${error.message}`, 'error');
            } finally {
                showLoader(false);
                event.target.value = ''; // R√©initialiser l'input
            }
        }

        async function handleMultiFileImport(event) {
            const files = event.target.files;
            if (!files || files.length === 0) return;
            
            showLoader(true);
            
            try {
                for (let i = 0; i < files.length; i++) {
                    const file = files[i];
                    const text = await file.text();
                    const data = JSON.parse(text);
                    
                    // Traiter chaque fichier
                    processImportedFile(file.name, data, 'multi');
                }
                
                showNotification(`${files.length} fichiers import√©s avec succ√®s`, 'success');
                
            } catch (error) {
                console.error('Erreur lors de l\'importation multiple:', error);
                showNotification(`Erreur lors de l'importation multiple: ${error.message}`, 'error');
            } finally {
                showLoader(false);
                event.target.value = ''; // R√©initialiser l'input
            }
        }

        async function handleCompleteFileImport(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            showLoader(true);
            
            try {
                const text = await file.text();
                const data = JSON.parse(text);
                
                // Traiter le fichier complet
                processCompleteFile(file.name, data);
                
                showNotification(`Fichier complet ${file.name} import√© avec succ√®s`, 'success');
                
            } catch (error) {
                console.error('Erreur lors de l\'importation compl√®te:', error);
                showNotification(`Erreur lors de l'importation compl√®te: ${error.message}`, 'error');
            } finally {
                showLoader(false);
                event.target.value = ''; // R√©initialiser l'input
            }
        }

        function processImportedFile(filename, data, importType) {
            // D√©terminer le type de fichier bas√© sur le nom
            let fileType = 'unknown';
            if (filename.includes('tab1')) fileType = 'tab1';
            else if (filename.includes('tab2')) fileType = 'tab2';
            else if (filename.includes('tab3')) fileType = 'tab3';
            else if (filename.includes('tab4')) fileType = 'tab4';
            else if (filename.includes('tab5')) fileType = 'tab5';
            else if (filename.includes('complete')) fileType = 'complete';
            
            // Cr√©er ou mettre √† jour un enseignant
            const teacherId = generateTeacherId(data);
            let teacherIndex = teachersData.findIndex(t => t.id === teacherId);
            
            if (teacherIndex === -1) {
                // Cr√©er un nouvel enseignant
                const newTeacher = createTeacherFromData(data, fileType);
                newTeacher.id = teacherId;
                teachersData.push(newTeacher);
                teacherIndex = teachersData.length - 1;
            } else {
                // Mettre √† jour l'enseignant existant
                updateTeacherData(teachersData[teacherIndex], data, fileType);
            }
            
            // Ajouter le fichier √† la liste des fichiers de l'enseignant
            if (!teachersData[teacherIndex].files) {
                teachersData[teacherIndex].files = [];
            }
            
            teachersData[teacherIndex].files.push({
                name: filename,
                type: fileType,
                importDate: new Date().toISOString(),
                importType: importType
            });
            
            // Marquer comme complet si toutes les donn√©es sont pr√©sentes
            checkTeacherCompleteness(teachersData[teacherIndex]);
            
            // Mettre √† jour l'interface
            updateUIAfterImport();
        }

        function processCompleteFile(filename, data) {
            if (Array.isArray(data)) {
                // Si c'est un tableau d'enseignants
                data.forEach(teacherData => {
                    processImportedFile(filename, teacherData, 'complete');
                });
            } else if (typeof data === 'object') {
                // Si c'est un objet unique
                processImportedFile(filename, data, 'complete');
            }
        }

        function generateTeacherId(data) {
            // Utiliser le matricule si disponible
            if (data.matricule) {
                return `teacher_${data.matricule}`;
            }
            
            // Sinon, utiliser le nom et pr√©nom
            if (data.lastName && data.firstName) {
                return `teacher_${data.lastName}_${data.firstName}`;
            }
            
            // Sinon, g√©n√©rer un ID bas√© sur le timestamp
            return `teacher_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
        }

        function createTeacherFromData(data, fileType) {
            const teacher = {
                id: generateTeacherId(data),
                lastName: data.lastName || data.last_name || '',
                firstName: data.firstName || data.first_name || '',
                fullName: data.fullName || `${data.firstName || data.first_name || ''} ${data.lastName || data.last_name || ''}`.trim(),
                matricule: data.matricule || '',
                establishment: data.establishment || data.establishment_name || '',
                age: calculateAge(data.birthDate || data.birth_date),
                serviceYears: calculateServiceYears(data.engagementDate || data.engagement_date),
                yearsToRetirement: calculateYearsToRetirement(data.retirementDate || data.retirement_date),
                complete: false,
                files: [],
                data: {}
            };
            
            // Organiser les donn√©es par type
            organizeTeacherData(teacher, data, fileType);
            
            return teacher;
        }

        function updateTeacherData(teacher, data, fileType) {
            // Mettre √† jour les informations de base
            teacher.lastName = teacher.lastName || data.lastName || data.last_name || '';
            teacher.firstName = teacher.firstName || data.firstName || data.first_name || '';
            teacher.fullName = teacher.fullName || data.fullName || `${teacher.firstName} ${teacher.lastName}`.trim();
            teacher.matricule = teacher.matricule || data.matricule || '';
            teacher.establishment = teacher.establishment || data.establishment || data.establishment_name || '';
            
            // Calculer les √¢ges et ann√©es
            if (data.birthDate || data.birth_date) {
                teacher.age = calculateAge(data.birthDate || data.birth_date);
            }
            
            if (data.engagementDate || data.engagement_date) {
                teacher.serviceYears = calculateServiceYears(data.engagementDate || data.engagement_date);
            }
            
            if (data.retirementDate || data.retirement_date) {
                teacher.yearsToRetirement = calculateYearsToRetirement(data.retirementDate || data.retirement_date);
            }
            
            // Organiser les donn√©es
            organizeTeacherData(teacher, data, fileType);
        }

        function organizeTeacherData(teacher, data, fileType) {
            if (!teacher.data) teacher.data = {};
            
            switch(fileType) {
                case 'tab1':
                    teacher.data.establishment = data.establishment || {};
                    teacher.data.personal = data.personal || {};
                    teacher.data.professional = data.professional || {};
                    break;
                case 'tab2':
                    teacher.data.subjects = data.subjects || [];
                    teacher.data.lessons = data.lessons || [];
                    teacher.data.timetable = data.timetable || {};
                    teacher.data.resources = data.resources || [];
                    break;
                case 'tab3':
                    teacher.data.evaluations = data.evaluations || [];
                    teacher.data.statistics = data.statistics || {};
                    break;
                case 'tab4':
                    teacher.data.projects = data.projects || [];
                    teacher.data.activities = data.activities || [];
                    break;
                case 'tab5':
                    teacher.data.archives = data.archives || [];
                    teacher.data.logs = data.logs || [];
                    break;
                case 'complete':
                    // Si c'est un fichier complet, copier toutes les donn√©es
                    teacher.data = { ...teacher.data, ...data };
                    break;
                default:
                    // Pour les fichiers inconnus, essayer de d√©terminer le type
                    if (data.subjects) teacher.data.subjects = data.subjects;
                    if (data.evaluations) teacher.data.evaluations = data.evaluations;
                    if (data.projects) teacher.data.projects = data.projects;
                    break;
            }
        }

        function checkTeacherCompleteness(teacher) {
            const requiredData = [
                teacher.lastName && teacher.firstName,
                teacher.matricule,
                teacher.establishment,
                teacher.data.personal,
                teacher.data.professional,
                teacher.data.subjects && teacher.data.subjects.length > 0
            ];
            
            teacher.complete = requiredData.every(Boolean);
            return teacher.complete;
        }

        function calculateAge(birthDate) {
            if (!birthDate) return null;
            
            try {
                const birth = new Date(birthDate);
                const today = new Date();
                let age = today.getFullYear() - birth.getFullYear();
                const monthDiff = today.getMonth() - birth.getMonth();
                
                if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birth.getDate())) {
                    age--;
                }
                
                return age;
            } catch (error) {
                console.error('Erreur lors du calcul de l\'√¢ge:', error);
                return null;
            }
        }

        function calculateServiceYears(engagementDate) {
            if (!engagementDate) return null;
            
            try {
                const engagement = new Date(engagementDate);
                const today = new Date();
                let years = today.getFullYear() - engagement.getFullYear();
                const monthDiff = today.getMonth() - engagement.getMonth();
                
                if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < engagement.getDate())) {
                    years--;
                }
                
                return years;
            } catch (error) {
                console.error('Erreur lors du calcul des ann√©es de service:', error);
                return null;
            }
        }

        function calculateYearsToRetirement(retirementDate) {
            if (!retirementDate) return null;
            
            try {
                const retirement = new Date(retirementDate);
                const today = new Date();
                let years = retirement.getFullYear() - today.getFullYear();
                const monthDiff = retirement.getMonth() - today.getMonth();
                
                if (monthDiff < 0 || (monthDiff === 0 && retirement.getDate() < today.getDate())) {
                    years--;
                }
                
                return Math.max(0, years);
            } catch (error) {
                console.error('Erreur lors du calcul des ann√©es avant retraite:', error);
                return null;
            }
        }

        function updateUIAfterImport() {
            // Mettre √† jour la liste des fichiers import√©s
            updateImportedFilesList();
            
            // Mettre √† jour les statistiques d'aper√ßu
            updateOverviewStats();
            
            // Mettre √† jour la liste des enseignants pour pr√©visualisation
            updateDataPreviewSelect();
            
            // Mettre √† jour les statistiques Python
            updatePythonStats();
            
            // Mettre √† jour les options des filtres
            updateFilterOptions();
            
            // Afficher les sections si des donn√©es sont pr√©sentes
            if (teachersData.length > 0) {
                document.getElementById('importedFilesSection').style.display = 'block';
                document.getElementById('overviewSection').style.display = 'block';
                document.getElementById('dataPreviewSection').style.display = 'block';
            }
            
            // Sauvegarder les donn√©es dans le localStorage
            if (appSettings.autoSave) {
                saveSessionData();
            }
        }

        function updateImportedFilesList() {
            const container = document.getElementById('importedFilesList');
            if (!container) return;
            
            if (teachersData.length === 0) {
                container.innerHTML = '<p class="text-center">Aucun fichier import√©</p>';
                return;
            }
            
            let html = '<div class="files-by-type">';
            
            // Grouper les fichiers par type
            const filesByType = {};
            teachersData.forEach(teacher => {
                if (teacher.files) {
                    teacher.files.forEach(file => {
                        if (!filesByType[file.type]) {
                            filesByType[file.type] = [];
                        }
                        filesByType[file.type].push({
                            name: file.name,
                            teacher: teacher.fullName,
                            date: file.importDate
                        });
                    });
                }
            });
            
            // Afficher les fichiers par type
            Object.keys(filesByType).forEach(type => {
                const fileTypeInfo = FILE_TYPES[type] || { name: type, icon: 'fa-file', description: '' };
                html += `
                    <div class="file-type-group">
                        <h4><i class="fas ${fileTypeInfo.icon}"></i> ${fileTypeInfo.name} (${filesByType[type].length})</h4>
                        <p>${fileTypeInfo.description}</p>
                        <div class="file-list">
                `;
                
                filesByType[type].forEach(file => {
                    const date = new Date(file.date).toLocaleString();
                    html += `
                        <div class="file-item">
                            <span><i class="fas fa-file"></i> ${file.name}</span>
                            <span class="badge badge-primary">${file.teacher}</span>
                            <span style="color: var(--gray-color); font-size: 0.9em;">${date}</span>
                        </div>
                    `;
                });
                
                html += `</div></div>`;
            });
            
            html += '</div>';
            container.innerHTML = html;
        }

        function updateOverviewStats() {
            const container = document.getElementById('overviewStats');
            if (!container) return;
            
            const totalTeachers = teachersData.length;
            const completeTeachers = teachersData.filter(t => t.complete).length;
            const totalFiles = teachersData.reduce((sum, teacher) => sum + (teacher.files ? teacher.files.length : 0), 0);
            
            // Compter les √©tablissements uniques
            const establishments = [...new Set(teachersData.map(t => t.establishment).filter(Boolean))];
            
            // Calculer l'√¢ge moyen
            const ages = teachersData.map(t => t.age).filter(age => age !== null);
            const averageAge = ages.length > 0 ? (ages.reduce((a, b) => a + b, 0) / ages.length).toFixed(1) : 0;
            
            container.innerHTML = `
                <div class="stat-card">
                    <div><i class="fas fa-users"></i> Enseignants</div>
                    <div class="stat-value">${totalTeachers}</div>
                    <div>Total import√©s</div>
                </div>
                <div class="stat-card">
                    <div><i class="fas fa-check-circle"></i> Fiches compl√®tes</div>
                    <div class="stat-value">${completeTeachers}</div>
                    <div>${totalTeachers > 0 ? ((completeTeachers / totalTeachers) * 100).toFixed(1) : 0}%</div>
                </div>
                <div class="stat-card">
                    <div><i class="fas fa-file"></i> Fichiers</div>
                    <div class="stat-value">${totalFiles}</div>
                    <div>Import√©s</div>
                </div>
                <div class="stat-card">
                    <div><i class="fas fa-school"></i> √âtablissements</div>
                    <div class="stat-value">${establishments.length}</div>
                    <div>Diff√©rents</div>
                </div>
                <div class="stat-card">
                    <div><i class="fas fa-birthday-cake"></i> √Çge moyen</div>
                    <div class="stat-value">${averageAge}</div>
                    <div>Ans</div>
                </div>
                <div class="stat-card">
                    <div><i class="fas fa-chart-bar"></i> Mati√®res</div>
                    <div class="stat-value">${countUniqueSubjects()}</div>
                    <div>Diff√©rentes</div>
                </div>
            `;
        }

        function countUniqueSubjects() {
            const subjects = new Set();
            teachersData.forEach(teacher => {
                if (teacher.data && teacher.data.subjects) {
                    teacher.data.subjects.forEach(subject => {
                        if (subject && subject.name) {
                            subjects.add(subject.name);
                        }
                    });
                }
            });
            return subjects.size;
        }

        function updateDataPreviewSelect() {
            const select = document.getElementById('dataPreviewSelect');
            if (!select) return;
            
            select.innerHTML = '<option value="">S√©lectionner un enseignant pour pr√©visualiser...</option>';
            
            teachersData.forEach((teacher, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = `${teacher.fullName} (${teacher.matricule || 'Pas de matricule'}) - ${teacher.establishment || '√âtablissement inconnu'}`;
                select.appendChild(option);
            });
        }

        function previewTeacherData(teacherIndex) {
            const container = document.getElementById('dataPreviewContent');
            if (!container) return;
            
            if (teacherIndex === '' || teacherIndex === null || teacherIndex === undefined) {
                container.innerHTML = '<p class="text-center">S√©lectionnez un enseignant pour voir ses donn√©es.</p>';
                return;
            }
            
            const index = parseInt(teacherIndex);
            if (isNaN(index) || index < 0 || index >= teachersData.length) {
                container.innerHTML = '<p class="text-center">Enseignant non trouv√©.</p>';
                return;
            }
            
            const teacher = teachersData[index];
            let html = `
                <div style="background: white; padding: 20px; border-radius: 8px; border: 1px solid #ddd;">
                    <h3 style="margin-bottom: 20px; color: var(--primary-color);">
                        <i class="fas fa-user-tie"></i> ${teacher.fullName}
                    </h3>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-bottom: 20px;">
                        <div>
                            <strong><i class="fas fa-id-card"></i> Informations personnelles</strong>
                            <div style="margin-top: 10px;">
                                <div>Matricule: <strong>${teacher.matricule || 'Non sp√©cifi√©'}</strong></div>
                                <div>√âtablissement: <strong>${teacher.establishment || 'Non sp√©cifi√©'}</strong></div>
                                <div>√Çge: <strong>${teacher.age || 'Non calcul√©'} ans</strong></div>
                                <div>Service: <strong>${teacher.serviceYears || 'Non calcul√©'} ans</strong></div>
                                <div>Retraite dans: <strong>${teacher.yearsToRetirement !== null ? teacher.yearsToRetirement + ' ans' : 'Non d√©finie'}</strong></div>
                                <div>Fiche: <span class="badge ${teacher.complete ? 'badge-success' : 'badge-warning'}">${teacher.complete ? 'Compl√®te' : 'Incompl√®te'}</span></div>
                            </div>
                        </div>
                        
                        <div>
                            <strong><i class="fas fa-file"></i> Fichiers import√©s</strong>
                            <div style="margin-top: 10px;">
            `;
            
            if (teacher.files && teacher.files.length > 0) {
                teacher.files.forEach(file => {
                    const date = new Date(file.importDate).toLocaleString();
                    html += `<div><i class="fas fa-file"></i> ${file.name} <small>(${date})</small></div>`;
                });
            } else {
                html += '<div>Aucun fichier</div>';
            }
            
            html += `
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <strong><i class="fas fa-database"></i> Donn√©es structur√©es</strong>
                        <div style="margin-top: 10px;">
            `;
            
            // Afficher les donn√©es structur√©es
            if (teacher.data) {
                Object.keys(teacher.data).forEach(key => {
                    const dataSection = teacher.data[key];
                    if (dataSection && Object.keys(dataSection).length > 0) {
                        html += `<div style="margin-bottom: 10px;"><strong>${key}:</strong> <pre style="background: #f5f5f5; padding: 10px; border-radius: 5px; overflow: auto; font-size: 0.85rem;">${JSON.stringify(dataSection, null, 2)}</pre></div>`;
                    }
                });
            } else {
                html += '<div>Aucune donn√©e structur√©e</div>';
            }
            
            html += `
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px; text-align: center;">
                        <button class="btn btn-primary btn-sm" onclick="viewTeacherDetail(${index})">
                            <i class="fas fa-eye"></i> Voir les d√©tails complets
                        </button>
                        <button class="btn btn-warning btn-sm" onclick="editTeacherData(${index})">
                            <i class="fas fa-edit"></i> Modifier
                        </button>
                    </div>
                </div>
            `;
            
            container.innerHTML = html;
        }

        // ============================================
        // FONCTIONS DU TABLEAU DE BORD COMPL√àTES
        // ============================================

        function updateDashboard() {
            if (teachersData.length === 0) {
                document.getElementById('globalStats').innerHTML = '<p class="text-center">Aucune donn√©e disponible. Importez des donn√©es d\'abord.</p>';
                document.getElementById('recentActivities').innerHTML = '<p class="text-center">Aucune activit√© r√©cente</p>';
                document.getElementById('alertsContainer').innerHTML = '<p class="text-center">Aucune alerte</p>';
                return;
            }
            
            updateGlobalStats();
            updateDashboardCharts();
            updateRecentActivities();
            updateAlerts();
        }

        function updateGlobalStats() {
            const container = document.getElementById('globalStats');
            if (!container) return;
            
            const totalTeachers = teachersData.length;
            const completeTeachers = teachersData.filter(t => t.complete).length;
            const averageAge = calculateAverage(teachersData.map(t => t.age).filter(age => age !== null));
            const averageService = calculateAverage(teachersData.map(t => t.serviceYears).filter(years => years !== null));
            
            // Compter par mati√®re
            const subjectCount = countUniqueSubjects();
            
            // Compter par √©tablissement
            const establishmentCount = [...new Set(teachersData.map(t => t.establishment).filter(Boolean))].length;
            
            // Compter les retraites √† venir (moins de 5 ans)
            const upcomingRetirements = teachersData.filter(t => {
                return t.yearsToRetirement !== null && t.yearsToRetirement <= 5;
            }).length;
            
            // Compter les √©valuations
            const totalEvaluations = countDataRecords('evaluations');
            
            // Compter les projets
            const totalProjects = countDataRecords('projects');
            
            container.innerHTML = `
                <div class="stat-card">
                    <div><i class="fas fa-users"></i> Total enseignants</div>
                    <div class="stat-value">${totalTeachers}</div>
                    <div>Import√©s</div>
                </div>
                <div class="stat-card">
                    <div><i class="fas fa-check-circle"></i> Fiches compl√®tes</div>
                    <div class="stat-value">${completeTeachers}</div>
                    <div>${totalTeachers > 0 ? ((completeTeachers / totalTeachers) * 100).toFixed(1) : 0}%</div>
                </div>
                <div class="stat-card">
                    <div><i class="fas fa-birthday-cake"></i> √Çge moyen</div>
                    <div class="stat-value">${averageAge.toFixed(1)}</div>
                    <div>Ans</div>
                </div>
                <div class="stat-card">
                    <div><i class="fas fa-clock"></i> Service moyen</div>
                    <div class="stat-value">${averageService.toFixed(1)}</div>
                    <div>Ans</div>
                </div>
                <div class="stat-card">
                    <div><i class="fas fa-book"></i> Mati√®res</div>
                    <div class="stat-value">${subjectCount}</div>
                    <div>Diff√©rentes</div>
                </div>
                <div class="stat-card">
                    <div><i class="fas fa-school"></i> √âtablissements</div>
                    <div class="stat-value">${establishmentCount}</div>
                    <div>Diff√©rents</div>
                </div>
                <div class="stat-card">
                    <div><i class="fas fa-umbrella-beach"></i> Retraites proches</div>
                    <div class="stat-value">${upcomingRetirements}</div>
                    <div>Dans ‚â§ 5 ans</div>
                </div>
                <div class="stat-card">
                    <div><i class="fas fa-chart-line"></i> √âvaluations</div>
                    <div class="stat-value">${totalEvaluations}</div>
                    <div>Enregistr√©es</div>
                </div>
            `;
        }

        function calculateAverage(values) {
            const validValues = values.filter(v => v !== null && v !== undefined);
            if (validValues.length === 0) return 0;
            return validValues.reduce((a, b) => a + b, 0) / validValues.length;
        }

        function countDataRecords(dataType) {
            return teachersData.reduce((sum, teacher) => {
                if (teacher.data && teacher.data[dataType]) {
                    return sum + (Array.isArray(teacher.data[dataType]) ? teacher.data[dataType].length : 1);
                }
                return sum;
            }, 0);
        }

        function updateDashboardCharts() {
            // Graphique des mati√®res
            updateSubjectChart();
            
            // Graphique des retraites
            updateRetirementChart();
            
            // Graphique des heures
            updateHoursChart();
            
            // Graphique des √¢ges
            updateAgeChart();
        }

        function updateSubjectChart() {
            const ctx = document.getElementById('subjectChart');
            if (!ctx) return;
            
            // Compter les mati√®res
            const subjectCounts = {};
            teachersData.forEach(teacher => {
                if (teacher.data && teacher.data.subjects) {
                    teacher.data.subjects.forEach(subject => {
                        if (subject && subject.name) {
                            subjectCounts[subject.name] = (subjectCounts[subject.name] || 0) + 1;
                        }
                    });
                }
            });
            
            // Trier et prendre les 10 premi√®res
            const sortedSubjects = Object.entries(subjectCounts)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 10);
            
            const labels = sortedSubjects.map(s => s[0]);
            const data = sortedSubjects.map(s => s[1]);
            
            // D√©truire le graphique existant
            if (charts.subjectChart) {
                charts.subjectChart.destroy();
            }
            
            // Cr√©er un nouveau graphique
            charts.subjectChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: [
                            '#3498db', '#2ecc71', '#e74c3c', '#f39c12', '#9b59b6',
                            '#1abc9c', '#d35400', '#c0392b', '#16a085', '#8e44ad'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right'
                        }
                    }
                }
            });
        }

        function updateRetirementChart() {
            const ctx = document.getElementById('retirementChart');
            if (!ctx) return;
            
            // Compter les retraites par ann√©e
            const retirementCounts = {};
            teachersData.forEach(teacher => {
                if (teacher.data && teacher.data.professional && teacher.data.professional.retirement_date) {
                    try {
                        const date = new Date(teacher.data.professional.retirement_date);
                        const year = date.getFullYear();
                        retirementCounts[year] = (retirementCounts[year] || 0) + 1;
                    } catch (error) {
                        console.error('Erreur lors du traitement de la date de retraite:', error);
                    }
                }
            });
            
            // Trier par ann√©e
            const sortedYears = Object.keys(retirementCounts).sort();
            const labels = sortedYears;
            const data = sortedYears.map(year => retirementCounts[year]);
            
            // D√©truire le graphique existant
            if (charts.retirementChart) {
                charts.retirementChart.destroy();
            }
            
            // Cr√©er un nouveau graphique
            charts.retirementChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Nombre de retraites',
                        data: data,
                        borderColor: '#3498db',
                        backgroundColor: 'rgba(52, 152, 219, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Nombre de retraites'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Ann√©e'
                            }
                        }
                    }
                }
            });
        }

        function updateHoursChart() {
            const ctx = document.getElementById('hoursChart');
            if (!ctx) return;
            
            // Calculer les heures totales par enseignant
            const teacherHours = teachersData.map(teacher => {
                let totalHours = 0;
                if (teacher.data && teacher.data.subjects) {
                    teacher.data.subjects.forEach(subject => {
                        if (subject && subject.hours) {
                            totalHours += parseFloat(subject.hours) || 0;
                        }
                    });
                }
                return totalHours;
            }).filter(hours => hours > 0);
            
            // Cr√©er des tranches d'heures
            const bins = [0, 10, 15, 20, 25, 30];
            const labels = bins.slice(1).map((bin, i) => `${bins[i]}-${bin}h`);
            const data = new Array(bins.length - 1).fill(0);
            
            teacherHours.forEach(hours => {
                for (let i = 0; i < bins.length - 1; i++) {
                    if (hours >= bins[i] && hours < bins[i + 1]) {
                        data[i]++;
                        break;
                    }
                }
            });
            
            // D√©truire le graphique existant
            if (charts.hoursChart) {
                charts.hoursChart.destroy();
            }
            
            // Cr√©er un nouveau graphique
            charts.hoursChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Nombre d\'enseignants',
                        data: data,
                        backgroundColor: '#2ecc71'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Nombre d\'enseignants'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Heures d\'enseignement par semaine'
                            }
                        }
                    }
                }
            });
        }

        function updateAgeChart() {
            const ctx = document.getElementById('ageChart');
            if (!ctx) return;
            
            // Cr√©er des tranches d'√¢ge
            const ageBins = [20, 30, 40, 50, 60, 70];
            const labels = ageBins.slice(1).map((bin, i) => `${ageBins[i]}-${bin} ans`);
            const data = new Array(ageBins.length - 1).fill(0);
            
            teachersData.forEach(teacher => {
                if (teacher.age !== null) {
                    for (let i = 0; i < ageBins.length - 1; i++) {
                        if (teacher.age >= ageBins[i] && teacher.age < ageBins[i + 1]) {
                            data[i]++;
                            break;
                        }
                    }
                }
            });
            
            // D√©truire le graphique existant
            if (charts.ageChart) {
                charts.ageChart.destroy();
            }
            
            // Cr√©er un nouveau graphique
            charts.ageChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Nombre d\'enseignants',
                        data: data,
                        backgroundColor: '#9b59b6'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Nombre d\'enseignants'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Tranche d\'√¢ge'
                            }
                        }
                    }
                }
            });
        }

        function updateRecentActivities() {
            const container = document.getElementById('recentActivities');
            if (!container) return;
            
            if (teachersData.length === 0) {
                container.innerHTML = '<p class="text-center">Aucune activit√© r√©cente</p>';
                return;
            }
            
            // R√©cup√©rer les fichiers r√©cemment import√©s
            const allFiles = [];
            teachersData.forEach(teacher => {
                if (teacher.files) {
                    teacher.files.forEach(file => {
                        allFiles.push({
                            teacher: teacher.fullName,
                            filename: file.name,
                            date: new Date(file.importDate),
                            type: file.type
                        });
                    });
                }
            });
            
            // Trier par date (plus r√©cent d'abord)
            allFiles.sort((a, b) => b.date - a.date);
            
            // Prendre les 10 plus r√©cents
            const recentFiles = allFiles.slice(0, 10);
            
            let html = '<div style="background: white; padding: 20px; border-radius: 8px;">';
            
            if (recentFiles.length === 0) {
                html += '<p class="text-center">Aucune activit√© r√©cente</p>';
            } else {
                html += '<table class="data-table">';
                html += '<thead><tr><th>Date</th><th>Enseignant</th><th>Fichier</th><th>Type</th></tr></thead><tbody>';
                
                recentFiles.forEach(file => {
                    const fileTypeInfo = FILE_TYPES[file.type] || { name: file.type, icon: 'fa-file' };
                    html += `
                        <tr>
                            <td>${file.date.toLocaleString()}</td>
                            <td>${file.teacher}</td>
                            <td><i class="fas ${fileTypeInfo.icon}"></i> ${file.filename}</td>
                            <td><span class="badge badge-primary">${fileTypeInfo.name}</span></td>
                        </tr>
                    `;
                });
                
                html += '</tbody></table>';
            }
            
            html += '</div>';
            container.innerHTML = html;
        }

        function updateAlerts() {
            const container = document.getElementById('alertsContainer');
            if (!container) return;
            
            if (teachersData.length === 0) {
                container.innerHTML = '<p class="text-center">Aucune alerte</p>';
                return;
            }
            
            const alerts = [];
            
            // V√©rifier les fiches incompl√®tes
            const incompleteTeachers = teachersData.filter(t => !t.complete).length;
            if (incompleteTeachers > 0) {
                alerts.push({
                    type: 'warning',
                    icon: 'fa-exclamation-triangle',
                    title: 'Fiches incompl√®tes',
                    message: `${incompleteTeachers} enseignant(s) ont des fiches incompl√®tes`,
                    action: () => showIncompleteTeachers()
                });
            }
            
            // V√©rifier les retraites √† venir
            const upcomingRetirements = teachersData.filter(t => 
                t.yearsToRetirement !== null && t.yearsToRetirement <= 1
            ).length;
            
            if (upcomingRetirements > 0) {
                alerts.push({
                    type: 'danger',
                    icon: 'fa-calendar-times',
                    title: 'Retraites imminentes',
                    message: `${upcomingRetirements} enseignant(s) partent √† la retraite dans moins d'un an`,
                    action: () => showUpcomingRetirements()
                });
            }
            
            // V√©rifier les enseignants sans mati√®re
            const teachersWithoutSubjects = teachersData.filter(t => 
                !t.data || !t.data.subjects || t.data.subjects.length === 0
            ).length;
            
            if (teachersWithoutSubjects > 0) {
                alerts.push({
                    type: 'info',
                    icon: 'fa-book',
                    title: 'Mati√®res manquantes',
                    message: `${teachersWithoutSubjects} enseignant(s) n'ont pas de mati√®re enseign√©e`,
                    action: () => showTeachersWithoutSubjects()
                });
            }
            
            // V√©rifier les donn√©es manquantes
            const teachersWithoutBirthDate = teachersData.filter(t => 
                !t.data || !t.data.personal || !t.data.personal.birth_date
            ).length;
            
            if (teachersWithoutBirthDate > 0) {
                alerts.push({
                    type: 'warning',
                    icon: 'fa-birthday-cake',
                    title: 'Dates de naissance manquantes',
                    message: `${teachersWithoutBirthDate} enseignant(s) n'ont pas de date de naissance`,
                    action: () => showTeachersWithoutBirthDate()
                });
            }
            
            // Afficher les alertes
            if (alerts.length === 0) {
                container.innerHTML = '<p class="text-center" style="color: var(--success-color);"><i class="fas fa-check-circle"></i> Aucune alerte - Toutes les donn√©es sont √† jour</p>';
            } else {
                let html = '<div class="analysis-grid">';
                alerts.forEach(alert => {
                    html += `
                        <div class="analysis-card" style="border-left: 4px solid var(--${alert.type}-color); cursor: pointer;" onclick="${alert.action.name ? alert.action.name + '()' : ''}">
                            <h4><i class="fas ${alert.icon}" style="color: var(--${alert.type}-color);"></i> ${alert.title}</h4>
                            <p>${alert.message}</p>
                            <div style="text-align: right; margin-top: 10px;">
                                <span class="badge badge-${alert.type}">Action requise</span>
                            </div>
                        </div>
                    `;
                });
                html += '</div>';
                container.innerHTML = html;
            }
        }

        function showIncompleteTeachers() {
            // Filtrer pour ne montrer que les enseignants incomplets
            showCompleteOnly = false;
            filteredTeachers = teachersData.filter(t => !t.complete);
            currentTeacherPage = 1;
            updateTeachersList();
            switchTab('tab-teachers');
        }

        function showUpcomingRetirements() {
            // Filtrer pour ne montrer que les retraites imminentes
            filteredTeachers = teachersData.filter(t => 
                t.yearsToRetirement !== null && t.yearsToRetirement <= 1
            );
            currentTeacherPage = 1;
            updateTeachersList();
            switchTab('tab-teachers');
        }

        function showTeachersWithoutSubjects() {
            // Filtrer pour ne montrer que les enseignants sans mati√®re
            filteredTeachers = teachersData.filter(t => 
                !t.data || !t.data.subjects || t.data.subjects.length === 0
            );
            currentTeacherPage = 1;
            updateTeachersList();
            switchTab('tab-teachers');
        }

        function showTeachersWithoutBirthDate() {
            // Filtrer pour ne montrer que les enseignants sans date de naissance
            filteredTeachers = teachersData.filter(t => 
                !t.data || !t.data.personal || !t.data.personal.birth_date
            );
            currentTeacherPage = 1;
            updateTeachersList();
            switchTab('tab-teachers');
        }

        function applyDashboardFilters() {
            const searchTerm = document.getElementById('dashboardSearch').value.toLowerCase();
            const subjectFilter = document.getElementById('dashboardFilterSubject').value;
            const categoryFilter = document.getElementById('dashboardFilterCategory').value;
            const establishmentFilter = document.getElementById('dashboardFilterEstablishment').value;
            
            // Filtrer les enseignants
            filteredTeachers = teachersData.filter(teacher => {
                // Filtre de recherche
                const matchesSearch = searchTerm === '' || 
                    teacher.fullName.toLowerCase().includes(searchTerm) ||
                    teacher.matricule.toLowerCase().includes(searchTerm) ||
                    teacher.establishment.toLowerCase().includes(searchTerm);
                
                // Filtre par mati√®re
                const matchesSubject = subjectFilter === '' || 
                    (teacher.data && teacher.data.subjects && 
                     teacher.data.subjects.some(s => s.name === subjectFilter));
                
                // Filtre par √©tablissement
                const matchesEstablishment = establishmentFilter === '' || 
                    teacher.establishment === establishmentFilter;
                
                // Filtre par cat√©gorie
                const matchesCategory = categoryFilter === '' || 
                    (teacher.data && teacher.data.professional && 
                     teacher.data.professional.professional_category === categoryFilter);
                
                return matchesSearch && matchesSubject && matchesEstablishment && matchesCategory;
            });
            
            // Mettre √† jour les graphiques avec les donn√©es filtr√©es
            updateDashboardCharts();
            updateGlobalStats();
            
            showNotification(`Filtres appliqu√©s: ${filteredTeachers.length} enseignant(s) trouv√©(s)`, 'info');
        }

        // ============================================
        // FONCTIONS DE GESTION DES ENSEIGNANTS COMPL√àTES
        // ============================================

        function updateTeachersList() {
            const container = document.getElementById('teachersCards');
            if (!container) return;
            
            if (teachersData.length === 0) {
                container.innerHTML = '<p class="text-center" style="grid-column: 1 / -1; padding: 40px; color: var(--gray-color);">Aucun enseignant import√©. Utilisez l\'onglet "Importation" pour importer des donn√©es.</p>';
                document.getElementById('teachersPagination').style.display = 'none';
                return;
            }
            
            // Filtrer les enseignants
            filteredTeachers = [...teachersData];
            
            if (showCompleteOnly) {
                filteredTeachers = filteredTeachers.filter(teacher => teacher.complete);
            }
            
            // Appliquer la recherche
            const searchTerm = document.getElementById('teacherSearch').value.toLowerCase();
            if (searchTerm) {
                filteredTeachers = filteredTeachers.filter(teacher => {
                    return (
                        teacher.fullName.toLowerCase().includes(searchTerm) ||
                        teacher.matricule.toLowerCase().includes(searchTerm) ||
                        teacher.establishment.toLowerCase().includes(searchTerm) ||
                        (teacher.data && teacher.data.subjects && 
                         teacher.data.subjects.some(s => s.name.toLowerCase().includes(searchTerm)))
                    );
                });
            }
            
            // Trier les enseignants
            filteredTeachers.sort((a, b) => {
                let aValue, bValue;
                
                switch(currentSort.field) {
                    case 'name':
                        aValue = (a.lastName + a.firstName).toLowerCase();
                        bValue = (b.lastName + b.firstName).toLowerCase();
                        break;
                    case 'retirement':
                        aValue = a.yearsToRetirement !== null ? a.yearsToRetirement : Infinity;
                        bValue = b.yearsToRetirement !== null ? b.yearsToRetirement : Infinity;
                        break;
                    default:
                        aValue = a[currentSort.field] || '';
                        bValue = b[currentSort.field] || '';
                }
                
                if (currentSort.direction === 'asc') {
                    return aValue > bValue ? 1 : -1;
                } else {
                    return aValue < bValue ? 1 : -1;
                }
            });
            
            // Calculer la pagination
            const totalPages = Math.ceil(filteredTeachers.length / teachersPerPage);
            const startIndex = (currentTeacherPage - 1) * teachersPerPage;
            const endIndex = Math.min(startIndex + teachersPerPage, filteredTeachers.length);
            const pageTeachers = filteredTeachers.slice(startIndex, endIndex);
            
            // Afficher les enseignants
            let html = '';
            pageTeachers.forEach((teacher, index) => {
                const originalIndex = teachersData.indexOf(teacher);
                html += `
                    <div class="teacher-card" onclick="viewTeacherDetail(${originalIndex})">
                        <div class="teacher-header">
                            <div class="teacher-name">${teacher.fullName}</div>
                            <div class="teacher-matricule">${teacher.matricule || 'Pas de matricule'}</div>
                        </div>
                        
                        <div class="teacher-info">
                            <div class="teacher-info-item">
                                <i class="fas fa-school"></i>
                                <span>${teacher.establishment || 'Non sp√©cifi√©'}</span>
                            </div>
                            <div class="teacher-info-item">
                                <i class="fas fa-birthday-cake"></i>
                                <span>${teacher.age || '?'} ans</span>
                            </div>
                            <div class="teacher-info-item">
                                <i class="fas fa-clock"></i>
                                <span>${teacher.serviceYears || '?'} ans de service</span>
                            </div>
                            <div class="teacher-info-item">
                                <i class="fas fa-umbrella-beach"></i>
                                <span>Retraite: ${teacher.yearsToRetirement !== null ? `dans ${teacher.yearsToRetirement} ans` : 'Non d√©finie'}</span>
                            </div>
                        </div>
                        
                        <div style="margin-top: 15px; display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                ${teacher.data && teacher.data.subjects && teacher.data.subjects.length > 0 ? 
                                    `<span class="badge badge-info">${teacher.data.subjects.length} mati√®re(s)</span>` : 
                                    '<span class="badge badge-warning">Aucune mati√®re</span>'
                                }
                                <span class="badge ${teacher.complete ? 'badge-success' : 'badge-warning'}">
                                    ${teacher.complete ? 'Complet' : 'Incomplet'}
                                </span>
                            </div>
                            <div>
                                <button class="btn btn-xs btn-primary" onclick="event.stopPropagation(); editTeacherData(${originalIndex})">
                                    <i class="fas fa-edit"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
            
            // Mettre √† jour la pagination
            updatePagination(totalPages);
        }

        function updatePagination(totalPages) {
            const paginationContainer = document.getElementById('teachersPagination');
            const pageInfo = document.getElementById('teacherPageInfo');
            
            if (filteredTeachers.length > teachersPerPage) {
                paginationContainer.style.display = 'flex';
                pageInfo.textContent = `Page ${currentTeacherPage} / ${totalPages} (${filteredTeachers.length} enseignants)`;
            } else {
                paginationContainer.style.display = 'none';
            }
        }

        function changeTeacherPage(delta) {
            const totalPages = Math.ceil(filteredTeachers.length / teachersPerPage);
            const newPage = currentTeacherPage + delta;
            
            if (newPage >= 1 && newPage <= totalPages) {
                currentTeacherPage = newPage;
                updateTeachersList();
            }
        }

        function sortTeachers(field) {
            if (currentSort.field === field) {
                currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
            } else {
                currentSort.field = field;
                currentSort.direction = 'asc';
            }
            
            currentTeacherPage = 1;
            updateTeachersList();
            
            // Mettre √† jour le texte du bouton
            const button = document.querySelector(`button[onclick="sortTeachers('${field}')"]`);
            if (button) {
                const icon = currentSort.direction === 'asc' ? 'fa-sort-alpha-down' : 'fa-sort-alpha-up';
                button.innerHTML = `<i class="fas ${icon}"></i> Trier par ${field === 'name' ? 'nom' : 'retraite'}`;
            }
        }

        function filterCompleteOnly() {
            showCompleteOnly = !showCompleteOnly;
            currentTeacherPage = 1;
            updateTeachersList();
            
            // Mettre √† jour le bouton
            const button = document.querySelector('button[onclick="filterCompleteOnly()"]');
            if (button) {
                if (showCompleteOnly) {
                    button.innerHTML = '<i class="fas fa-check-circle"></i> Toutes les fiches';
                    button.classList.remove('btn-light');
                    button.classList.add('btn-success');
                } else {
                    button.innerHTML = '<i class="fas fa-check-circle"></i> Fiches compl√®tes';
                    button.classList.remove('btn-success');
                    button.classList.add('btn-light');
                }
            }
        }

        function filterTeachers() {
            currentTeacherPage = 1;
            updateTeachersList();
        }

        function addNewTeacher() {
            const teacher = {
                id: `teacher_new_${Date.now()}`,
                lastName: '',
                firstName: '',
                fullName: '',
                matricule: '',
                establishment: '',
                age: null,
                serviceYears: null,
                yearsToRetirement: null,
                complete: false,
                files: [],
                data: {
                    personal: {},
                    professional: {},
                    subjects: [],
                    lessons: [],
                    evaluations: [],
                    projects: []
                }
            };
            
            teachersData.push(teacher);
            const teacherIndex = teachersData.length - 1;
            
            editTeacherData(teacherIndex);
        }

        function viewTeacherDetail(index) {
            const teacher = teachersData[index];
            if (!teacher) return;
            
            let html = `
                <div class="edit-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Nom</label>
                            <input type="text" class="form-control" id="editLastName" value="${teacher.lastName || ''}" disabled>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Pr√©nom</label>
                            <input type="text" class="form-control" id="editFirstName" value="${teacher.firstName || ''}" disabled>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Matricule</label>
                            <input type="text" class="form-control" id="editMatricule" value="${teacher.matricule || ''}" disabled>
                        </div>
                        <div class="form-group">
                            <label class="form-label">√âtablissement</label>
                            <input type="text" class="form-control" id="editEstablishment" value="${teacher.establishment || ''}" disabled>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">√Çge</label>
                            <input type="text" class="form-control" value="${teacher.age || 'Non calcul√©'}" disabled>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ann√©es de service</label>
                            <input type="text" class="form-control" value="${teacher.serviceYears || 'Non calcul√©'}" disabled>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Ann√©es avant retraite</label>
                        <input type="text" class="form-control" value="${teacher.yearsToRetirement !== null ? teacher.yearsToRetirement + ' ans' : 'Non d√©finie'}" disabled>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Statut de la fiche</label>
                        <div>
                            <span class="badge ${teacher.complete ? 'badge-success' : 'badge-warning'}">
                                ${teacher.complete ? 'Compl√®te' : 'Incompl√®te'}
                            </span>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Fichiers import√©s</label>
                        <div style="background: #f8f9fa; padding: 10px; border-radius: 5px;">
            `;
            
            if (teacher.files && teacher.files.length > 0) {
                teacher.files.forEach(file => {
                    const date = new Date(file.importDate).toLocaleString();
                    const fileTypeInfo = FILE_TYPES[file.type] || { name: file.type, icon: 'fa-file' };
                    html += `
                        <div style="margin-bottom: 5px;">
                            <i class="fas ${fileTypeInfo.icon}"></i> ${file.name} 
                            <small style="color: var(--gray-color);">(${date})</small>
                        </div>
                    `;
                });
            } else {
                html += '<div>Aucun fichier import√©</div>';
            }
            
            html += `
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Mati√®res enseign√©es</label>
                        <div style="background: #f8f9fa; padding: 10px; border-radius: 5px;">
            `;
            
            if (teacher.data && teacher.data.subjects && teacher.data.subjects.length > 0) {
                teacher.data.subjects.forEach(subject => {
                    html += `
                        <div style="margin-bottom: 5px;">
                            <strong>${subject.name || 'Sans nom'}</strong>
                            ${subject.type ? `(${subject.type})` : ''}
                            ${subject.hours ? `- ${subject.hours} heures` : ''}
                        </div>
                    `;
                });
            } else {
                html += '<div>Aucune mati√®re enseign√©e</div>';
            }
            
            html += `
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Donn√©es d√©taill√©es</label>
                        <div style="background: #f8f9fa; padding: 10px; border-radius: 5px; max-height: 300px; overflow-y: auto;">
                            <pre style="margin: 0; font-size: 0.85rem;">${JSON.stringify(teacher.data, null, 2)}</pre>
                        </div>
                    </div>
                    
                    <div style="margin-top: 30px; display: flex; gap: 10px; justify-content: center;">
                        <button class="btn btn-primary" onclick="editTeacherData(${index})">
                            <i class="fas fa-edit"></i> Modifier
                        </button>
                        <button class="btn btn-danger" onclick="deleteTeacher(${index})">
                            <i class="fas fa-trash"></i> Supprimer
                        </button>
                        <button class="btn btn-light" onclick="closeTeacherEdit()">
                            <i class="fas fa-times"></i> Fermer
                        </button>
                    </div>
                </div>
            `;
            
            document.getElementById('teacherEditTitle').textContent = `D√©tails: ${teacher.fullName || 'Nouvel enseignant'}`;
            document.getElementById('teacherEditContent').innerHTML = html;
            document.getElementById('teacherEditModal').classList.add('active');
        }

        function editTeacherData(index) {
            const teacher = teachersData[index];
            if (!teacher) return;
            
            let html = `
                <div class="edit-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Nom *</label>
                            <input type="text" class="form-control" id="editLastName" value="${teacher.lastName || ''}" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Pr√©nom *</label>
                            <input type="text" class="form-control" id="editFirstName" value="${teacher.firstName || ''}" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Matricule *</label>
                            <input type="text" class="form-control" id="editMatricule" value="${teacher.matricule || ''}" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">√âtablissement *</label>
                            <input type="text" class="form-control" id="editEstablishment" value="${teacher.establishment || ''}" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Date de naissance</label>
                            <input type="date" class="form-control" id="editBirthDate" value="${teacher.data && teacher.data.personal && teacher.data.personal.birth_date || ''}">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Date d'engagement</label>
                            <input type="date" class="form-control" id="editEngagementDate" value="${teacher.data && teacher.data.professional && teacher.data.professional.engagement_date || ''}">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Date de retraite</label>
                        <input type="date" class="form-control" id="editRetirementDate" value="${teacher.data && teacher.data.professional && teacher.data.professional.retirement_date || ''}">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Cat√©gorie professionnelle</label>
                        <select class="form-control" id="editProfessionalCategory">
                            <option value="">S√©lectionner...</option>
                            <option value="A1" ${teacher.data && teacher.data.professional && teacher.data.professional.professional_category === 'A1' ? 'selected' : ''}>A1</option>
                            <option value="A2" ${teacher.data && teacher.data.professional && teacher.data.professional.professional_category === 'A2' ? 'selected' : ''}>A2</option>
                            <option value="B" ${teacher.data && teacher.data.professional && teacher.data.professional.professional_category === 'B' ? 'selected' : ''}>B</option>
                            <option value="C" ${teacher.data && teacher.data.professional && teacher.data.professional.professional_category === 'C' ? 'selected' : ''}>C</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Grade</label>
                        <input type="text" class="form-control" id="editGrade" value="${teacher.data && teacher.data.professional && teacher.data.professional.grade || ''}">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Heures hebdomadaires</label>
                        <input type="number" class="form-control" id="editWeeklyHours" value="${teacher.data && teacher.data.professional && teacher.data.professional.weekly_hours || ''}" min="0" max="40">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Mati√®res enseign√©es</label>
                        <div id="subjectsContainer" style="margin-bottom: 10px;">
            `;
            
            // Afficher les mati√®res existantes
            if (teacher.data && teacher.data.subjects) {
                teacher.data.subjects.forEach((subject, i) => {
                    html += `
                        <div class="form-row" style="margin-bottom: 10px;">
                            <div class="form-group">
                                <input type="text" class="form-control" placeholder="Nom de la mati√®re" value="${subject.name || ''}" onchange="updateSubject(${index}, ${i}, 'name', this.value)">
                            </div>
                            <div class="form-group">
                                <input type="text" class="form-control" placeholder="Type" value="${subject.type || ''}" onchange="updateSubject(${index}, ${i}, 'type', this.value)">
                            </div>
                            <div class="form-group">
                                <input type="number" class="form-control" placeholder="Heures" value="${subject.hours || ''}" onchange="updateSubject(${index}, ${i}, 'hours', this.value)">
                            </div>
                            <div class="form-group">
                                <button class="btn btn-danger btn-sm" onclick="removeSubject(${index}, ${i})">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    `;
                });
            }
            
            html += `
                        </div>
                        <button type="button" class="btn btn-secondary btn-sm" onclick="addSubject(${index})">
                            <i class="fas fa-plus"></i> Ajouter une mati√®re
                        </button>
                    </div>
                    
                    <div style="margin-top: 30px; display: flex; gap: 10px; justify-content: center;">
                        <button class="btn btn-success" onclick="saveTeacher(${index})">
                            <i class="fas fa-save"></i> Sauvegarder
                        </button>
                        <button class="btn btn-light" onclick="closeTeacherEdit()">
                            <i class="fas fa-times"></i> Annuler
                        </button>
                    </div>
                </div>
            `;
            
            document.getElementById('teacherEditTitle').textContent = teacher.fullName ? `√âditer: ${teacher.fullName}` : 'Nouvel enseignant';
            document.getElementById('teacherEditContent').innerHTML = html;
            document.getElementById('teacherEditModal').classList.add('active');
        }

        function addSubject(teacherIndex) {
            const teacher = teachersData[teacherIndex];
            if (!teacher.data) teacher.data = {};
            if (!teacher.data.subjects) teacher.data.subjects = [];
            
            teacher.data.subjects.push({
                name: '',
                type: '',
                hours: ''
            });
            
            editTeacherData(teacherIndex);
        }

        function removeSubject(teacherIndex, subjectIndex) {
            const teacher = teachersData[teacherIndex];
            if (teacher.data && teacher.data.subjects) {
                teacher.data.subjects.splice(subjectIndex, 1);
                editTeacherData(teacherIndex);
            }
        }

        function updateSubject(teacherIndex, subjectIndex, field, value) {
            const teacher = teachersData[teacherIndex];
            if (teacher.data && teacher.data.subjects && teacher.data.subjects[subjectIndex]) {
                teacher.data.subjects[subjectIndex][field] = value;
            }
        }

        function saveTeacher(index) {
            const teacher = teachersData[index];
            
            // R√©cup√©rer les valeurs du formulaire
            teacher.lastName = document.getElementById('editLastName').value;
            teacher.firstName = document.getElementById('editFirstName').value;
            teacher.fullName = `${teacher.firstName} ${teacher.lastName}`.trim();
            teacher.matricule = document.getElementById('editMatricule').value;
            teacher.establishment = document.getElementById('editEstablishment').value;
            
            // Mettre √† jour les donn√©es personnelles
            if (!teacher.data) teacher.data = {};
            if (!teacher.data.personal) teacher.data.personal = {};
            
            teacher.data.personal.birth_date = document.getElementById('editBirthDate').value;
            teacher.age = calculateAge(teacher.data.personal.birth_date);
            
            // Mettre √† jour les donn√©es professionnelles
            if (!teacher.data.professional) teacher.data.professional = {};
            
            teacher.data.professional.engagement_date = document.getElementById('editEngagementDate').value;
            teacher.serviceYears = calculateServiceYears(teacher.data.professional.engagement_date);
            
            teacher.data.professional.retirement_date = document.getElementById('editRetirementDate').value;
            teacher.yearsToRetirement = calculateYearsToRetirement(teacher.data.professional.retirement_date);
            
            teacher.data.professional.professional_category = document.getElementById('editProfessionalCategory').value;
            teacher.data.professional.grade = document.getElementById('editGrade').value;
            teacher.data.professional.weekly_hours = document.getElementById('editWeeklyHours').value;
            
            // V√©rifier la compl√©tude
            checkTeacherCompleteness(teacher);
            
            // Mettre √† jour l'interface
            updateUIAfterImport();
            updateTeachersList();
            
            // Fermer le modal
            closeTeacherEdit();
            
            showNotification('Enseignant sauvegard√© avec succ√®s', 'success');
        }

        function deleteTeacher(index) {
            if (confirm('√ätes-vous s√ªr de vouloir supprimer cet enseignant ? Cette action est irr√©versible.')) {
                teachersData.splice(index, 1);
                updateUIAfterImport();
                updateTeachersList();
                closeTeacherEdit();
                showNotification('Enseignant supprim√© avec succ√®s', 'success');
            }
        }

        function closeTeacherEdit() {
            document.getElementById('teacherEditModal').classList.remove('active');
        }

        // ============================================
        // FONCTIONS P√âDAGOGIQUES COMPL√àTES
        // ============================================

        function updatePedagogyOverview() {
            updatePedagogyStats();
            updatePedagogyCharts();
        }

        function updatePedagogyStats() {
            const container = document.getElementById('pedagogyStats');
            if (!container) return;
            
            if (teachersData.length === 0) {
                container.innerHTML = '<p class="text-center">Aucune donn√©e p√©dagogique disponible</p>';
                return;
            }
            
            const totalSubjects = countDataRecords('subjects');
            const totalLessons = countDataRecords('lessons');
            const totalResources = countDataRecords('resources');
            const totalTP = countDataRecords('tps');
            
            const teachersWithSubjects = teachersData.filter(t => t.data && t.data.subjects && t.data.subjects.length > 0).length;
            const teachersWithLessons = teachersData.filter(t => t.data && t.data.lessons && t.data.lessons.length > 0).length;
            
            // Calculer le total des heures
            let totalHours = 0;
            teachersData.forEach(teacher => {
                if (teacher.data && teacher.data.subjects) {
                    teacher.data.subjects.forEach(subject => {
                        if (subject && subject.hours) {
                            totalHours += parseFloat(subject.hours) || 0;
                        }
                    });
                }
            });
            
            container.innerHTML = `
                <div class="stat-card">
                    <div><i class="fas fa-book"></i> Mati√®res enseign√©es</div>
                    <div class="stat-value">${totalSubjects}</div>
                    <div>Total</div>
                </div>
                <div class="stat-card">
                    <div><i class="fas fa-chalkboard"></i> Le√ßons enregistr√©es</div>
                    <div class="stat-value">${totalLessons}</div>
                    <div>Total</div>
                </div>
                <div class="stat-card">
                    <div><i class="fas fa-flask"></i> Travaux pratiques</div>
                    <div class="stat-value">${totalTP}</div>
                    <div>Total</div>
                </div>
                <div class="stat-card">
                    <div><i class="fas fa-file-alt"></i> Ressources</div>
                    <div class="stat-value">${totalResources}</div>
                    <div>Total</div>
                </div>
                <div class="stat-card">
                    <div><i class="fas fa-clock"></i> Heures totales</div>
                    <div class="stat-value">${totalHours}</div>
                    <div>Par semaine</div>
                </div>
                <div class="stat-card">
                    <div><i class="fas fa-users"></i> Enseignants avec mati√®res</div>
                    <div class="stat-value">${teachersWithSubjects}</div>
                    <div>${teachersData.length > 0 ? ((teachersWithSubjects / teachersData.length) * 100).toFixed(1) : 0}%</div>
                </div>
            `;
        }

        function updatePedagogyCharts() {
            // Graphique des mati√®res
            updatePedagogySubjectsChart();
            
            // Graphique des heures
            updatePedagogyHoursChart();
        }

        function updatePedagogySubjectsChart() {
            const ctx = document.getElementById('pedagogySubjectsChart');
            if (!ctx) return;
            
            // Compter les mati√®res par enseignant
            const subjectsPerTeacher = teachersData.map(teacher => {
                return teacher.data && teacher.data.subjects ? teacher.data.subjects.length : 0;
            }).filter(count => count > 0);
            
            // Cr√©er des tranches
            const bins = [0, 1, 3, 5, 10];
            const labels = bins.slice(1).map((bin, i) => `${bins[i]}-${bin} mati√®res`);
            const data = new Array(bins.length - 1).fill(0);
            
            subjectsPerTeacher.forEach(count => {
                for (let i = 0; i < bins.length - 1; i++) {
                    if (count >= bins[i] && count < bins[i + 1]) {
                        data[i]++;
                        break;
                    }
                }
            });
            
            // D√©truire le graphique existant
            if (charts.pedagogySubjectsChart) {
                charts.pedagogySubjectsChart.destroy();
            }
            
            // Cr√©er un nouveau graphique
            charts.pedagogySubjectsChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Nombre d\'enseignants',
                        data: data,
                        backgroundColor: '#3498db'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Nombre d\'enseignants'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Nombre de mati√®res enseign√©es'
                            }
                        }
                    }
                }
            });
        }

        function updatePedagogyHoursChart() {
            const ctx = document.getElementById('pedagogyHoursChart');
            if (!ctx) return;
            
            // Calculer les heures par mati√®re
            const hoursBySubject = {};
            teachersData.forEach(teacher => {
                if (teacher.data && teacher.data.subjects) {
                    teacher.data.subjects.forEach(subject => {
                        if (subject && subject.name && subject.hours) {
                            const hours = parseFloat(subject.hours) || 0;
                            hoursBySubject[subject.name] = (hoursBySubject[subject.name] || 0) + hours;
                        }
                    });
                }
            });
            
            // Trier et prendre les 10 premi√®res
            const sortedSubjects = Object.entries(hoursBySubject)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 10);
            
            const labels = sortedSubjects.map(s => s[0]);
            const data = sortedSubjects.map(s => s[1]);
            
            // D√©truire le graphique existant
            if (charts.pedagogyHoursChart) {
                charts.pedagogyHoursChart.destroy();
            }
            
            // Cr√©er un nouveau graphique
            charts.pedagogyHoursChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Heures par semaine',
                        data: data,
                        backgroundColor: '#2ecc71'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Heures totales par semaine'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Mati√®re'
                            }
                        }
                    }
                }
            });
        }

        function updateSubjectsAnalysis() {
            const container = document.getElementById('subjectsAnalysis');
            if (!container) return;
            
            if (teachersData.length === 0) {
                container.innerHTML = '<p class="text-center">Aucune donn√©e disponible. Importez des donn√©es d\'abord.</p>';
                return;
            }
            
            // Compter les mati√®res
            const subjectCounts = {};
            const hoursBySubject = {};
            
            teachersData.forEach(teacher => {
                if (teacher.data && teacher.data.subjects) {
                    teacher.data.subjects.forEach(subject => {
                        if (subject && subject.name) {
                            subjectCounts[subject.name] = (subjectCounts[subject.name] || 0) + 1;
                            
                            const hours = parseFloat(subject.hours) || 0;
                            hoursBySubject[subject.name] = (hoursBySubject[subject.name] || 0) + hours;
                        }
                    });
                }
            });
            
            // Trier par fr√©quence
            const sortedSubjects = Object.entries(subjectCounts)
                .sort((a, b) => b[1] - a[1]);
            
            let html = `
                <div style="background: white; padding: 20px; border-radius: 8px;">
                    <h4 style="margin-bottom: 20px;"><i class="fas fa-list-ol"></i> Classement des mati√®res</h4>
                    
                    <div style="margin-bottom: 20px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                            <strong>Mati√®re</strong>
                            <strong>Nombre d'enseignants</strong>
                            <strong>Heures totales</strong>
                        </div>
            `;
            
            sortedSubjects.forEach(([subject, count]) => {
                const hours = hoursBySubject[subject] || 0;
                const percentage = (count / teachersData.length * 100).toFixed(1);
                
                html += `
                    <div style="display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid #f0f0f0;">
                        <div>${subject}</div>
                        <div>${count} (${percentage}%)</div>
                        <div>${hours} h</div>
                    </div>
                `;
            });
            
            html += `
                    </div>
                    
                    <div class="analysis-grid">
                        <div class="analysis-card">
                            <h4><i class="fas fa-calculator"></i> Statistiques</h4>
                            <div style="margin-top: 10px;">
                                <div>Nombre total de mati√®res: <strong>${sortedSubjects.length}</strong></div>
                                <div>Mati√®re la plus enseign√©e: <strong>${sortedSubjects[0] ? sortedSubjects[0][0] : 'Aucune'}</strong></div>
                                <div>Enseignants par mati√®re (moyenne): <strong>${(teachersData.length / Math.max(sortedSubjects.length, 1)).toFixed(1)}</strong></div>
                            </div>
                        </div>
                        
                        <div class="analysis-card">
                            <h4><i class="fas fa-chart-pie"></i> R√©partition</h4>
                            <div style="margin-top: 10px;">
                                <div>Mati√®res avec 1 enseignant: <strong>${sortedSubjects.filter(s => s[1] === 1).length}</strong></div>
                                <div>Mati√®res avec 2-5 enseignants: <strong>${sortedSubjects.filter(s => s[1] >= 2 && s[1] <= 5).length}</strong></div>
                                <div>Mati√®res avec +5 enseignants: <strong>${sortedSubjects.filter(s => s[1] > 5).length}</strong></div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            container.innerHTML = html;
        }

        function updateLessonsAnalysis() {
            const container = document.getElementById('lessonsAnalysis');
            if (!container) return;
            
            if (teachersData.length === 0) {
                container.innerHTML = '<p class="text-center">Aucune donn√©e disponible. Importez des donn√©es d\'abord.</p>';
                return;
            }
            
            // Compiler les donn√©es des le√ßons
            const lessonsByMonth = {};
            const lessonsBySubject = {};
            const totalLessons = countDataRecords('lessons');
            
            teachersData.forEach(teacher => {
                if (teacher.data && teacher.data.lessons) {
                    teacher.data.lessons.forEach(lesson => {
                        // Par mois
                        if (lesson.date) {
                            try {
                                const date = new Date(lesson.date);
                                const monthKey = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
                                lessonsByMonth[monthKey] = (lessonsByMonth[monthKey] || 0) + 1;
                            } catch (error) {
                                // Date invalide, on ignore
                            }
                        }
                        
                        // Par mati√®re
                        if (lesson.subject) {
                            lessonsBySubject[lesson.subject] = (lessonsBySubject[lesson.subject] || 0) + 1;
                        }
                    });
                }
            });
            
            let html = `
                <div style="background: white; padding: 20px; border-radius: 8px;">
                    <h4 style="margin-bottom: 20px;"><i class="fas fa-chalkboard"></i> Analyse des le√ßons</h4>
                    
                    <div class="stats-grid" style="margin-bottom: 20px;">
                        <div class="stat-card">
                            <div>Le√ßons totales</div>
                            <div class="stat-value">${totalLessons}</div>
                        </div>
                        <div class="stat-card">
                            <div>Enseignants avec le√ßons</div>
                            <div class="stat-value">${teachersData.filter(t => t.data && t.data.lessons && t.data.lessons.length > 0).length}</div>
                        </div>
                        <div class="stat-card">
                            <div>Moyenne par enseignant</div>
                            <div class="stat-value">${(totalLessons / Math.max(teachersData.length, 1)).toFixed(1)}</div>
                        </div>
                    </div>
                    
                    <div class="analysis-grid">
                        <div class="analysis-card">
                            <h4><i class="fas fa-calendar-alt"></i> √âvolution mensuelle</h4>
                            <div style="margin-top: 10px; max-height: 200px; overflow-y: auto;">
            `;
            
            // Afficher les le√ßons par mois
            const sortedMonths = Object.keys(lessonsByMonth).sort();
            if (sortedMonths.length > 0) {
                sortedMonths.forEach(month => {
                    html += `<div style="padding: 5px 0; border-bottom: 1px solid #f0f0f0;">${month}: ${lessonsByMonth[month]} le√ßons</div>`;
                });
            } else {
                html += '<div>Aucune donn√©e temporelle disponible</div>';
            }
            
            html += `
                            </div>
                        </div>
                        
                        <div class="analysis-card">
                            <h4><i class="fas fa-book"></i> R√©partition par mati√®re</h4>
                            <div style="margin-top: 10px; max-height: 200px; overflow-y: auto;">
            `;
            
            // Afficher les le√ßons par mati√®re
            const sortedSubjects = Object.entries(lessonsBySubject)
                .sort((a, b) => b[1] - a[1]);
            
            if (sortedSubjects.length > 0) {
                sortedSubjects.forEach(([subject, count]) => {
                    html += `<div style="padding: 5px 0; border-bottom: 1px solid #f0f0f0;">${subject}: ${count} le√ßons</div>`;
                });
            } else {
                html += '<div>Aucune donn√©e par mati√®re disponible</div>';
            }
            
            html += `
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px;">
                        <h4><i class="fas fa-lightbulb"></i> Recommandations</h4>
                        <div style="background: #e8f5e9; padding: 15px; border-radius: 5px; margin-top: 10px;">
                            <p><i class="fas fa-check-circle" style="color: #2ecc71;"></i> Encouragez les enseignants √† enregistrer leurs le√ßons r√©guli√®rement</p>
                            <p><i class="fas fa-check-circle" style="color: #2ecc71;"></i> Assurez-vous que les mati√®res sont correctement attribu√©es</p>
                            <p><i class="fas fa-check-circle" style="color: #2ecc71;"></i> Utilisez ces donn√©es pour planifier les formations</p>
                        </div>
                    </div>
                </div>
            `;
            
            container.innerHTML = html;
        }

        function updateTPAnalysis() {
            const container = document.getElementById('tpAnalysis');
            if (!container) return;
            
            container.innerHTML = `
                <div style="background: white; padding: 20px; border-radius: 8px;">
                    <h4 style="margin-bottom: 20px;"><i class="fas fa-flask"></i> Analyse des travaux pratiques</h4>
                    <p>Cette fonctionnalit√© est en cours de d√©veloppement. Elle permettra d'analyser :</p>
                    <ul style="margin-top: 10px; padding-left: 20px;">
                        <li>Le nombre de TP par mati√®re</li>
                        <li>La fr√©quence des TP</li>
                        <li>Les √©quipements utilis√©s</li>
                        <li>Les comp√©tences d√©velopp√©es</li>
                        <li>Les r√©sultats des √©l√®ves</li>
                    </ul>
                    <div style="margin-top: 20px; padding: 15px; background: #fff3cd; border-radius: 5px; border-left: 4px solid #f39c12;">
                        <p><i class="fas fa-exclamation-triangle" style="color: #f39c12;"></i> Cette section sera disponible dans la prochaine mise √† jour.</p>
                    </div>
                </div>
            `;
        }

        function updateResourcesAnalysis() {
            const container = document.getElementById('resourcesAnalysis');
            if (!container) return;
            
            container.innerHTML = `
                <div style="background: white; padding: 20px; border-radius: 8px;">
                    <h4 style="margin-bottom: 20px;"><i class="fas fa-file-alt"></i> Analyse des ressources p√©dagogiques</h4>
                    <p>Cette fonctionnalit√© est en cours de d√©veloppement. Elle permettra d'analyser :</p>
                    <ul style="margin-top: 10px; padding-left: 20px;">
                        <li>Les types de ressources utilis√©es (PDF, vid√©os, pr√©sentations...)</li>
                        <li>La r√©partition par mati√®re</li>
                        <li>La qualit√© des ressources</li>
                        <li>Le partage entre enseignants</li>
                        <li>Les besoins en ressources</li>
                    </ul>
                    <div style="margin-top: 20px; padding: 15px; background: #fff3cd; border-radius: 5px; border-left: 4px solid #f39c12;">
                        <p><i class="fas fa-exclamation-triangle" style="color: #f39c12;"></i> Cette section sera disponible dans la prochaine mise √† jour.</p>
                    </div>
                </div>
            `;
        }

        // ============================================
        // FONCTIONS D'√âVALUATIONS COMPL√àTES
        // ============================================

        function updateEvaluationsOverview() {
            updateEvaluationStats();
            updateEvaluationCharts();
            updateEvaluationsAnalysis();
        }

        function updateEvaluationStats() {
            const container = document.getElementById('evaluationStats');
            if (!container) return;
            
            if (teachersData.length === 0) {
                container.innerHTML = '<p class="text-center">Aucune donn√©e d\'√©valuation disponible</p>';
                return;
            }
            
            const totalEvaluations = countDataRecords('evaluations');
            const teachersWithEvaluations = teachersData.filter(t => t.data && t.data.evaluations && t.data.evaluations.length > 0).length;
            
            // Calculer les statistiques des notes
            const allGrades = [];
            teachersData.forEach(teacher => {
                if (teacher.data && teacher.data.evaluations) {
                    teacher.data.evaluations.forEach(evaluation => {
                        if (evaluation.average) {
                            const grade = parseFloat(evaluation.average);
                            if (!isNaN(grade)) {
                                allGrades.push(grade);
                            }
                        }
                    });
                }
            });
            
            let averageGrade = 0;
            let maxGrade = 0;
            let minGrade = 20;
            
            if (allGrades.length > 0) {
                averageGrade = allGrades.reduce((a, b) => a + b, 0) / allGrades.length;
                maxGrade = Math.max(...allGrades);
                minGrade = Math.min(...allGrades);
            }
            
            container.innerHTML = `
                <div class="stat-card">
                    <div><i class="fas fa-chart-line"></i> √âvaluations totales</div>
                    <div class="stat-value">${totalEvaluations}</div>
                    <div>Enregistr√©es</div>
                </div>
                <div class="stat-card">
                    <div><i class="fas fa-users"></i> Enseignants avec √©valuations</div>
                    <div class="stat-value">${teachersWithEvaluations}</div>
                    <div>${teachersData.length > 0 ? ((teachersWithEvaluations / teachersData.length) * 100).toFixed(1) : 0}%</div>
                </div>
                <div class="stat-card">
                    <div><i class="fas fa-calculator"></i> Moyenne g√©n√©rale</div>
                    <div class="stat-value">${averageGrade.toFixed(2)}</div>
                    <div>/20</div>
                </div>
                <div class="stat-card">
                    <div><i class="fas fa-angle-up"></i> Meilleure moyenne</div>
                    <div class="stat-value">${maxGrade.toFixed(2)}</div>
                    <div>/20</div>
                </div>
                <div class="stat-card">
                    <div><i class="fas fa-angle-down"></i> Plus basse moyenne</div>
                    <div class="stat-value">${minGrade.toFixed(2)}</div>
                    <div>/20</div>
                </div>
                <div class="stat-card">
                    <div><i class="fas fa-chart-bar"></i> √âcart-type</div>
                    <div class="stat-value">${calculateStandardDeviation(allGrades).toFixed(2)}</div>
                    <div>/20</div>
                </div>
            `;
        }

        function calculateStandardDeviation(values) {
            if (values.length === 0) return 0;
            const avg = values.reduce((a, b) => a + b, 0) / values.length;
            const squareDiffs = values.map(value => Math.pow(value - avg, 2));
            const avgSquareDiff = squareDiffs.reduce((a, b) => a + b, 0) / squareDiffs.length;
            return Math.sqrt(avgSquareDiff);
        }

        function updateEvaluationCharts() {
            // Graphique de distribution des notes
            updateGradesDistributionChart();
            
            // Graphique d'√©volution des notes
            updateGradesEvolutionChart();
        }

        function updateGradesDistributionChart() {
            const ctx = document.getElementById('gradesDistributionChart');
            if (!ctx) return;
            
            // Compiler toutes les notes
            const allGrades = [];
            teachersData.forEach(teacher => {
                if (teacher.data && teacher.data.evaluations) {
                    teacher.data.evaluations.forEach(evaluation => {
                        if (evaluation.average) {
                            const grade = parseFloat(evaluation.average);
                            if (!isNaN(grade)) {
                                allGrades.push(grade);
                            }
                        }
                    });
                }
            });
            
            // Cr√©er des tranches de notes
            const bins = [0, 5, 10, 12, 14, 16, 18, 20];
            const labels = bins.slice(1).map((bin, i) => `${bins[i]}-${bin}`);
            const data = new Array(bins.length - 1).fill(0);
            
            allGrades.forEach(grade => {
                for (let i = 0; i < bins.length - 1; i++) {
                    if (grade >= bins[i] && grade < bins[i + 1]) {
                        data[i]++;
                        break;
                    } else if (i === bins.length - 2 && grade === bins[i + 1]) {
                        data[i]++;
                        break;
                    }
                }
            });
            
            // D√©truire le graphique existant
            if (charts.gradesDistributionChart) {
                charts.gradesDistributionChart.destroy();
            }
            
            // Cr√©er un nouveau graphique
            charts.gradesDistributionChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Nombre d\'√©valuations',
                        data: data,
                        backgroundColor: '#e74c3c'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Nombre d\'√©valuations'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Tranche de notes (/20)'
                            }
                        }
                    }
                }
            });
        }

        function updateGradesEvolutionChart() {
            const ctx = document.getElementById('gradesEvolutionChart');
            if (!ctx) return;
            
            // Compiler les notes par mois
            const gradesByMonth = {};
            const countByMonth = {};
            
            teachersData.forEach(teacher => {
                if (teacher.data && teacher.data.evaluations) {
                    teacher.data.evaluations.forEach(evaluation => {
                        if (evaluation.date && evaluation.average) {
                            try {
                                const date = new Date(evaluation.date);
                                const monthKey = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
                                const grade = parseFloat(evaluation.average);
                                
                                if (!isNaN(grade)) {
                                    gradesByMonth[monthKey] = (gradesByMonth[monthKey] || 0) + grade;
                                    countByMonth[monthKey] = (countByMonth[monthKey] || 0) + 1;
                                }
                            } catch (error) {
                                // Date invalide, on ignore
                            }
                        }
                    });
                }
            });
            
            // Calculer les moyennes par mois
            const sortedMonths = Object.keys(gradesByMonth).sort();
            const labels = sortedMonths;
            const data = sortedMonths.map(month => {
                return (gradesByMonth[month] / countByMonth[month]).toFixed(2);
            });
            
            // D√©truire le graphique existant
            if (charts.gradesEvolutionChart) {
                charts.gradesEvolutionChart.destroy();
            }
            
            // Cr√©er un nouveau graphique
            charts.gradesEvolutionChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Moyenne des notes',
                        data: data,
                        borderColor: '#9b59b6',
                        backgroundColor: 'rgba(155, 89, 182, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            min: 0,
                            max: 20,
                            title: {
                                display: true,
                                text: 'Moyenne (/20)'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Mois'
                            }
                        }
                    }
                }
            });
        }

        function updateEvaluationsAnalysis() {
            const container = document.getElementById('evaluationsAnalysis');
            if (!container) return;
            
            if (teachersData.length === 0) {
                container.innerHTML = '<p class="text-center">Aucune donn√©e disponible. Importez des donn√©es d\'abord.</p>';
                return;
            }
            
            // Compiler les √©valuations
            const evaluationsByType = {};
            const evaluationsBySubject = {};
            const evaluationsByTeacher = {};
            
            teachersData.forEach(teacher => {
                if (teacher.data && teacher.data.evaluations) {
                    evaluationsByTeacher[teacher.fullName] = teacher.data.evaluations.length;
                    
                    teacher.data.evaluations.forEach(evaluation => {
                        // Par type
                        const type = evaluation.type || 'Non sp√©cifi√©';
                        evaluationsByType[type] = (evaluationsByType[type] || 0) + 1;
                        
                        // Par mati√®re
                        const subject = evaluation.subject || 'Non sp√©cifi√©';
                        evaluationsBySubject[subject] = (evaluationsBySubject[subject] || 0) + 1;
                    });
                }
            });
            
            let html = `
                <div style="background: white; padding: 20px; border-radius: 8px;">
                    <h4 style="margin-bottom: 20px;"><i class="fas fa-table"></i> D√©tail des √©valuations</h4>
                    
                    <div class="analysis-grid">
                        <div class="analysis-card">
                            <h4><i class="fas fa-tag"></i> Par type d'√©valuation</h4>
                            <ul class="analysis-list">
            `;
            
            // Afficher par type
            const sortedTypes = Object.entries(evaluationsByType)
                .sort((a, b) => b[1] - a[1]);
            
            sortedTypes.forEach(([type, count]) => {
                const percentage = (count / countDataRecords('evaluations') * 100).toFixed(1);
                html += `<li>${type}: <strong>${count}</strong> (${percentage}%)</li>`;
            });
            
            html += `
                            </ul>
                        </div>
                        
                        <div class="analysis-card">
                            <h4><i class="fas fa-book"></i> Par mati√®re</h4>
                            <ul class="analysis-list">
            `;
            
            // Afficher par mati√®re (top 10)
            const sortedSubjects = Object.entries(evaluationsBySubject)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 10);
            
            sortedSubjects.forEach(([subject, count]) => {
                const percentage = (count / countDataRecords('evaluations') * 100).toFixed(1);
                html += `<li>${subject}: <strong>${count}</strong> (${percentage}%)</li>`;
            });
            
            html += `
                            </ul>
                        </div>
                        
                        <div class="analysis-card">
                            <h4><i class="fas fa-user-tie"></i> Par enseignant</h4>
                            <ul class="analysis-list">
            `;
            
            // Afficher par enseignant (top 10)
            const sortedTeachers = Object.entries(evaluationsByTeacher)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 10);
            
            sortedTeachers.forEach(([teacher, count]) => {
                html += `<li>${teacher}: <strong>${count}</strong> √©valuations</li>`;
            });
            
            html += `
                            </ul>
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px;">
                        <h4><i class="fas fa-chart-line"></i> Performances par enseignant</h4>
                        <div style="margin-top: 10px; max-height: 300px; overflow-y: auto;">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Enseignant</th>
                                        <th>Nombre d'√©valuations</th>
                                        <th>Moyenne g√©n√©rale</th>
                                        <th>√âcart-type</th>
                                    </tr>
                                </thead>
                                <tbody>
            `;
            
            // Calculer les statistiques par enseignant
            teachersData.forEach(teacher => {
                if (teacher.data && teacher.data.evaluations && teacher.data.evaluations.length > 0) {
                    const grades = teacher.data.evaluations
                        .map(e => parseFloat(e.average))
                        .filter(g => !isNaN(g));
                    
                    if (grades.length > 0) {
                        const average = grades.reduce((a, b) => a + b, 0) / grades.length;
                        const stdDev = calculateStandardDeviation(grades);
                        
                        html += `
                            <tr>
                                <td>${teacher.fullName}</td>
                                <td>${teacher.data.evaluations.length}</td>
                                <td>${average.toFixed(2)}</td>
                                <td>${stdDev.toFixed(2)}</td>
                            </tr>
                        `;
                    }
                }
            });
            
            html += `
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
            
            container.innerHTML = html;
        }

        function filterEvaluations() {
            const searchTerm = document.getElementById('evaluationSearch').value.toLowerCase();
            const typeFilter = document.getElementById('evaluationTypeFilter').value;
            
            // Filtrer les √©valuations pour l'affichage
            filteredEvaluations = [];
            
            teachersData.forEach(teacher => {
                if (teacher.data && teacher.data.evaluations) {
                    teacher.data.evaluations.forEach(evaluation => {
                        const matchesSearch = searchTerm === '' || 
                            (evaluation.subject && evaluation.subject.toLowerCase().includes(searchTerm)) ||
                            (evaluation.type && evaluation.type.toLowerCase().includes(searchTerm));
                        
                        const matchesType = typeFilter === '' || evaluation.type === typeFilter;
                        
                        if (matchesSearch && matchesType) {
                            filteredEvaluations.push({
                                teacher: teacher.fullName,
                                ...evaluation
                            });
                        }
                    });
                }
            });
            
            // Mettre √† jour l'affichage
            updateEvaluationsAnalysis();
            showNotification(`${filteredEvaluations.length} √©valuation(s) trouv√©e(s)`, 'info');
        }

        function applyEvaluationFilters() {
            filterEvaluations();
        }

        // ============================================
        // FONCTIONS DE PROJETS COMPL√àTES
        // ============================================

        function updateProjectsOverview() {
            updateProjectsStats();
            updateProjectsCharts();
            updateProjectsAnalysis();
        }

        function updateProjectsStats() {
            const container = document.getElementById('projectsStats');
            if (!container) return;
            
            if (teachersData.length === 0) {
                container.innerHTML = '<p class="text-center">Aucune donn√©e de projet disponible</p>';
                return;
            }
            
            const totalProjects = countDataRecords('projects');
            const totalActivities = countDataRecords('activities');
            const teachersWithProjects = teachersData.filter(t => t.data && t.data.projects && t.data.projects.length > 0).length;
            
            // Compter par statut
            const projectsByStatus = { en_cours: 0, termine: 0, planifie: 0 };
            teachersData.forEach(teacher => {
                if (teacher.data && teacher.data.projects) {
                    teacher.data.projects.forEach(project => {
                        const status = project.status || 'en_cours';
                        projectsByStatus[status] = (projectsByStatus[status] || 0) + 1;
                    });
                }
            });
            
            container.innerHTML = `
                <div class="stat-card">
                    <div><i class="fas fa-project-diagram"></i> Projets total</div>
                    <div class="stat-value">${totalProjects}</div>
                    <div>Enregistr√©s</div>
                </div>
                <div class="stat-card">
                    <div><i class="fas fa-tasks"></i> Activit√©s</div>
                    <div class="stat-value">${totalActivities}</div>
                    <div>Enregistr√©es</div>
                </div>
                <div class="stat-card">
                    <div><i class="fas fa-users"></i> Enseignants avec projets</div>
                    <div class="stat-value">${teachersWithProjects}</div>
                    <div>${teachersData.length > 0 ? ((teachersWithProjects / teachersData.length) * 100).toFixed(1) : 0}%</div>
                </div>
                <div class="stat-card">
                    <div><i class="fas fa-play-circle"></i> En cours</div>
                    <div class="stat-value">${projectsByStatus.en_cours}</div>
                    <div>Projets</div>
                </div>
                <div class="stat-card">
                    <div><i class="fas fa-check-circle"></i> Termin√©s</div>
                    <div class="stat-value">${projectsByStatus.termine}</div>
                    <div>Projets</div>
                </div>
                <div class="stat-card">
                    <div><i class="fas fa-calendar"></i> Planifi√©s</div>
                    <div class="stat-value">${projectsByStatus.planifie}</div>
                    <div>Projets</div>
                </div>
            `;
        }

        function updateProjectsCharts() {
            // Graphique des statuts
            updateProjectsStatusChart();
            
            // Graphique par enseignant
            updateProjectsByTeacherChart();
        }

        function updateProjectsStatusChart() {
            const ctx = document.getElementById('projectsStatusChart');
            if (!ctx) return;
            
            // Compter par statut
            const projectsByStatus = { en_cours: 0, termine: 0, planifie: 0, autre: 0 };
            teachersData.forEach(teacher => {
                if (teacher.data && teacher.data.projects) {
                    teacher.data.projects.forEach(project => {
                        const status = project.status || 'en_cours';
                        if (['en_cours', 'termine', 'planifie'].includes(status)) {
                            projectsByStatus[status] = (projectsByStatus[status] || 0) + 1;
                        } else {
                            projectsByStatus.autre += 1;
                        }
                    });
                }
            });
            
            const labels = ['En cours', 'Termin√©s', 'Planifi√©s', 'Autre'];
            const data = [
                projectsByStatus.en_cours,
                projectsByStatus.termine,
                projectsByStatus.planifie,
                projectsByStatus.autre
            ];
            
            // D√©truire le graphique existant
            if (charts.projectsStatusChart) {
                charts.projectsStatusChart.destroy();
            }
            
            // Cr√©er un nouveau graphique
            charts.projectsStatusChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: [
                            '#3498db', // En cours
                            '#2ecc71', // Termin√©s
                            '#f39c12', // Planifi√©s
                            '#95a5a6'  // Autre
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right'
                        }
                    }
                }
            });
        }

        function updateProjectsByTeacherChart() {
            const ctx = document.getElementById('projectsByTeacherChart');
            if (!ctx) return;
            
            // Compter les projets par enseignant
            const projectsByTeacher = {};
            teachersData.forEach(teacher => {
                if (teacher.data && teacher.data.projects) {
                    projectsByTeacher[teacher.fullName] = teacher.data.projects.length;
                } else {
                    projectsByTeacher[teacher.fullName] = 0;
                }
            });
            
            // Trier et prendre les 10 premiers
            const sortedTeachers = Object.entries(projectsByTeacher)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 10);
            
            const labels = sortedTeachers.map(t => t[0]);
            const data = sortedTeachers.map(t => t[1]);
            
            // D√©truire le graphique existant
            if (charts.projectsByTeacherChart) {
                charts.projectsByTeacherChart.destroy();
            }
            
            // Cr√©er un nouveau graphique
            charts.projectsByTeacherChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Nombre de projets',
                        data: data,
                        backgroundColor: '#9b59b6'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Nombre de projets'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Enseignant'
                            },
                            ticks: {
                                maxRotation: 45,
                                minRotation: 45
                            }
                        }
                    }
                }
            });
        }

        function updateProjectsAnalysis() {
            const container = document.getElementById('projectsAnalysis');
            if (!container) return;
            
            if (teachersData.length === 0) {
                container.innerHTML = '<p class="text-center">Aucune donn√©e disponible. Importez des donn√©es d\'abord.</p>';
                return;
            }
            
            // Compiler tous les projets
            const allProjects = [];
            teachersData.forEach(teacher => {
                if (teacher.data && teacher.data.projects) {
                    teacher.data.projects.forEach(project => {
                        allProjects.push({
                            teacher: teacher.fullName,
                            ...project
                        });
                    });
                }
            });
            
            // Trier par date de d√©but
            allProjects.sort((a, b) => {
                const dateA = a.start_date ? new Date(a.start_date) : new Date(0);
                const dateB = b.start_date ? new Date(b.start_date) : new Date(0);
                return dateB - dateA;
            });
            
            let html = `
                <div style="background: white; padding: 20px; border-radius: 8px;">
                    <h4 style="margin-bottom: 20px;"><i class="fas fa-table"></i> Liste des projets</h4>
                    
                    <div style="margin-bottom: 20px; overflow-x: auto;">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Nom du projet</th>
                                    <th>Enseignant</th>
                                    <th>Type</th>
                                    <th>Date d√©but</th>
                                    <th>Date fin</th>
                                    <th>Statut</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
            `;
            
            allProjects.forEach((project, index) => {
                const statusBadge = getStatusBadge(project.status);
                html += `
                    <tr>
                        <td>${project.name || 'Sans nom'}</td>
                        <td>${project.teacher}</td>
                        <td>${project.type || 'Non sp√©cifi√©'}</td>
                        <td>${project.start_date ? new Date(project.start_date).toLocaleDateString() : 'Non d√©finie'}</td>
                        <td>${project.end_date ? new Date(project.end_date).toLocaleDateString() : 'Non d√©finie'}</td>
                        <td>${statusBadge}</td>
                        <td>
                            <button class="btn btn-xs btn-primary" onclick="viewProjectDetail(${index})">
                                <i class="fas fa-eye"></i>
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            html += `
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="analysis-grid">
                        <div class="analysis-card">
                            <h4><i class="fas fa-chart-pie"></i> R√©partition par type</h4>
                            <ul class="analysis-list">
            `;
            
            // Compter par type
            const projectsByType = {};
            allProjects.forEach(project => {
                const type = project.type || 'Non sp√©cifi√©';
                projectsByType[type] = (projectsByType[type] || 0) + 1;
            });
            
            Object.entries(projectsByType)
                .sort((a, b) => b[1] - a[1])
                .forEach(([type, count]) => {
                    const percentage = (count / allProjects.length * 100).toFixed(1);
                    html += `<li>${type}: <strong>${count}</strong> (${percentage}%)</li>`;
                });
            
            html += `
                            </ul>
                        </div>
                        
                        <div class="analysis-card">
                            <h4><i class="fas fa-calendar-alt"></i> Projets √† venir</h4>
                            <ul class="analysis-list">
            `;
            
            // Projets √† venir (date de d√©but future)
            const today = new Date();
            const upcomingProjects = allProjects.filter(project => {
                if (!project.start_date) return false;
                const startDate = new Date(project.start_date);
                return startDate > today;
            }).slice(0, 5);
            
            if (upcomingProjects.length > 0) {
                upcomingProjects.forEach(project => {
                    const startDate = new Date(project.start_date).toLocaleDateString();
                    html += `<li>${project.name} (${startDate})</li>`;
                });
            } else {
                html += '<li>Aucun projet √† venir</li>';
            }
            
            html += `
                            </ul>
                        </div>
                    </div>
                </div>
            `;
            
            container.innerHTML = html;
        }

        function getStatusBadge(status) {
            switch(status) {
                case 'en_cours':
                    return '<span class="badge badge-primary">En cours</span>';
                case 'termine':
                    return '<span class="badge badge-success">Termin√©</span>';
                case 'planifie':
                    return '<span class="badge badge-warning">Planifi√©</span>';
                default:
                    return '<span class="badge badge-info">' + (status || 'Non d√©fini') + '</span>';
            }
        }

        function viewProjectDetail(index) {
            // Pour l'instant, afficher une alerte
            alert(`D√©tail du projet ${index} - Fonctionnalit√© en cours de d√©veloppement`);
        }

        function filterProjects() {
            const searchTerm = document.getElementById('projectSearch').value.toLowerCase();
            const statusFilter = document.getElementById('projectStatusFilter').value;
            
            // Mettre √† jour l'analyse des projets avec filtres
            updateProjectsAnalysis();
            
            showNotification('Filtres appliqu√©s aux projets', 'info');
        }

        function applyProjectFilters() {
            filterProjects();
        }

        function addNewProject() {
            const html = `
                <div class="edit-form">
                    <div class="form-group">
                        <label class="form-label">Nom du projet *</label>
                        <input type="text" class="form-control" id="projectName" required>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Enseignant responsable *</label>
                            <select class="form-control" id="projectTeacher" required>
                                <option value="">S√©lectionner un enseignant...</option>
                                ${teachersData.map(teacher => 
                                    `<option value="${teacher.id}">${teacher.fullName}</option>`
                                ).join('')}
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Type de projet</label>
                            <select class="form-control" id="projectType">
                                <option value="">S√©lectionner...</option>
                                <option value="pedagogique">P√©dagogique</option>
                                <option value="recherche">Recherche</option>
                                <option value="culturel">Culturel</option>
                                <option value="sportif">Sportif</option>
                                <option value="autre">Autre</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Date de d√©but</label>
                            <input type="date" class="form-control" id="projectStartDate">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Date de fin</label>
                            <input type="date" class="form-control" id="projectEndDate">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Statut</label>
                        <select class="form-control" id="projectStatus">
                            <option value="planifie">Planifi√©</option>
                            <option value="en_cours" selected>En cours</option>
                            <option value="termine">Termin√©</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Description</label>
                        <textarea class="form-control" id="projectDescription" rows="4"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Participants</label>
                        <input type="text" class="form-control" id="projectParticipants" placeholder="S√©par√©s par des virgules">
                    </div>
                    
                    <div style="margin-top: 30px; display: flex; gap: 10px; justify-content: center;">
                        <button class="btn btn-success" onclick="saveNewProject()">
                            <i class="fas fa-save"></i> Cr√©er le projet
                        </button>
                        <button class="btn btn-light" onclick="closeProjectEdit()">
                            <i class="fas fa-times"></i> Annuler
                        </button>
                    </div>
                </div>
            `;
            
            document.getElementById('projectEditTitle').textContent = 'Nouveau projet';
            document.getElementById('projectEditContent').innerHTML = html;
            document.getElementById('projectEditModal').classList.add('active');
        }

        function saveNewProject() {
            const teacherId = document.getElementById('projectTeacher').value;
            const teacher = teachersData.find(t => t.id === teacherId);
            
            if (!teacher) {
                showNotification('Veuillez s√©lectionner un enseignant', 'error');
                return;
            }
            
            const newProject = {
                name: document.getElementById('projectName').value,
                type: document.getElementById('projectType').value,
                start_date: document.getElementById('projectStartDate').value,
                end_date: document.getElementById('projectEndDate').value,
                status: document.getElementById('projectStatus').value,
                description: document.getElementById('projectDescription').value,
                participants: document.getElementById('projectParticipants').value.split(',').map(p => p.trim()).filter(p => p)
            };
            
            if (!teacher.data) teacher.data = {};
            if (!teacher.data.projects) teacher.data.projects = [];
            
            teacher.data.projects.push(newProject);
            
            closeProjectEdit();
            updateProjectsOverview();
            showNotification('Projet cr√©√© avec succ√®s', 'success');
        }

        function closeProjectEdit() {
            document.getElementById('projectEditModal').classList.remove('active');
        }

        // ============================================
        // FONCTIONS DE RETRAITE COMPL√àTES
        // ============================================

        function updateRetirementOverview() {
            updateRetirementTable();
            updateRetirementCharts();
            updateRetirementAnalysis();
            updateRetirementAlerts();
        }

        function updateRetirementTable() {
            const container = document.getElementById('retirementTable');
            if (!container) return;
            
            if (teachersData.length === 0) {
                container.innerHTML = '<p class="text-center">Aucune donn√©e de retraite disponible</p>';
                return;
            }
            
            // Filtrer les enseignants avec date de retraite
            const teachersWithRetirement = teachersData.filter(teacher => 
                teacher.data && teacher.data.professional && teacher.data.professional.retirement_date
            );
            
            // Trier par date de retraite
            teachersWithRetirement.sort((a, b) => {
                const dateA = new Date(a.data.professional.retirement_date);
                const dateB = new Date(b.data.professional.retirement_date);
                return dateA - dateB;
            });
            
            let html = `
                <div style="background: white; padding: 20px; border-radius: 8px; overflow-x: auto;">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Enseignant</th>
                                <th>Matricule</th>
                                <th>√âtablissement</th>
                                <th>√Çge</th>
                                <th>Service</th>
                                <th>Date de retraite</th>
                                <th>Ann√©es restantes</th>
                                <th>Cat√©gorie</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            teachersWithRetirement.forEach((teacher, index) => {
                const retirementDate = new Date(teacher.data.professional.retirement_date);
                const yearsLeft = teacher.yearsToRetirement;
                
                let rowClass = '';
                if (yearsLeft <= 1) rowClass = 'style="background-color: #ffebee;"';
                else if (yearsLeft <= 3) rowClass = 'style="background-color: #fff3e0;"';
                else if (yearsLeft <= 5) rowClass = 'style="background-color: #fff8e1;"';
                
                html += `
                    <tr ${rowClass}>
                        <td>${teacher.fullName}</td>
                        <td>${teacher.matricule || ''}</td>
                        <td>${teacher.establishment || ''}</td>
                        <td>${teacher.age || ''}</td>
                        <td>${teacher.serviceYears || ''}</td>
                        <td>${retirementDate.toLocaleDateString()}</td>
                        <td>
                            <span class="badge ${yearsLeft <= 1 ? 'badge-danger' : yearsLeft <= 3 ? 'badge-warning' : 'badge-info'}">
                                ${yearsLeft} ans
                            </span>
                        </td>
                        <td>${teacher.data.professional.professional_category || ''}</td>
                        <td>
                            <button class="btn btn-xs btn-primary" onclick="viewTeacherDetail(${teachersData.indexOf(teacher)})">
                                <i class="fas fa-eye"></i>
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            html += `
                        </tbody>
                    </table>
                    
                    <div style="margin-top: 20px; color: var(--gray-color);">
                        <i class="fas fa-info-circle"></i> ${teachersWithRetirement.length} enseignant(s) avec date de retraite sur ${teachersData.length} total
                    </div>
                </div>
            `;
            
            container.innerHTML = html;
        }

        function updateRetirementCharts() {
            // Graphique par ann√©e
            updateRetirementYearChart();
        }

        function updateRetirementYearChart() {
            const ctx = document.getElementById('retirementYearChart');
            if (!ctx) return;
            
            // Compter les retraites par ann√©e
            const retirementCounts = {};
            teachersData.forEach(teacher => {
                if (teacher.data && teacher.data.professional && teacher.data.professional.retirement_date) {
                    try {
                        const date = new Date(teacher.data.professional.retirement_date);
                        const year = date.getFullYear();
                        retirementCounts[year] = (retirementCounts[year] || 0) + 1;
                    } catch (error) {
                        console.error('Erreur lors du traitement de la date de retraite:', error);
                    }
                }
            });
            
            // Trier par ann√©e
            const sortedYears = Object.keys(retirementCounts).sort((a, b) => parseInt(a) - parseInt(b));
            const labels = sortedYears;
            const data = sortedYears.map(year => retirementCounts[year]);
            
            // D√©truire le graphique existant
            if (charts.retirementYearChart) {
                charts.retirementYearChart.destroy();
            }
            
            // Cr√©er un nouveau graphique
            charts.retirementYearChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Nombre de retraites',
                        data: data,
                        backgroundColor: '#3498db'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Nombre de retraites'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Ann√©e'
                            }
                        }
                    }
                }
            });
        }

        function updateRetirementAnalysis() {
            const container = document.getElementById('retirementAnalysis');
            if (!container) return;
            
            if (teachersData.length === 0) {
                container.innerHTML = '<p class="text-center">Aucune donn√©e disponible</p>';
                return;
            }
            
            // Calculer les statistiques
            const teachersWithRetirement = teachersData.filter(teacher => 
                teacher.data && teacher.data.professional && teacher.data.professional.retirement_date
            ).length;
            
            const teachersWithoutRetirement = teachersData.length - teachersWithRetirement;
            
            // Calculer les ann√©es moyennes restantes
            const yearsLeftArray = teachersData
                .map(t => t.yearsToRetirement)
                .filter(y => y !== null);
            
            const averageYearsLeft = yearsLeftArray.length > 0 ? 
                yearsLeftArray.reduce((a, b) => a + b, 0) / yearsLeftArray.length : 0;
            
            // Compter par urgence
            const urgencyCounts = {
                immediate: teachersData.filter(t => t.yearsToRetirement !== null && t.yearsToRetirement <= 1).length,
                short: teachersData.filter(t => t.yearsToRetirement !== null && t.yearsToRetirement > 1 && t.yearsToRetirement <= 3).length,
                medium: teachersData.filter(t => t.yearsToRetirement !== null && t.yearsToRetirement > 3 && t.yearsToRetirement <= 5).length,
                long: teachersData.filter(t => t.yearsToRetirement !== null && t.yearsToRetirement > 5).length,
                unknown: teachersData.filter(t => t.yearsToRetirement === null).length
            };
            
            container.innerHTML = `
                <div class="stat-card">
                    <div><i class="fas fa-calendar-check"></i> Avec date</div>
                    <div class="stat-value">${teachersWithRetirement}</div>
                    <div>${teachersData.length > 0 ? ((teachersWithRetirement / teachersData.length) * 100).toFixed(1) : 0}%</div>
                </div>
                <div class="stat-card">
                    <div><i class="fas fa-calendar-times"></i> Sans date</div>
                    <div class="stat-value">${teachersWithoutRetirement}</div>
                    <div>${teachersData.length > 0 ? ((teachersWithoutRetirement / teachersData.length) * 100).toFixed(1) : 0}%</div>
                </div>
                <div class="stat-card">
                    <div><i class="fas fa-clock"></i> Moyenne restante</div>
                    <div class="stat-value">${averageYearsLeft.toFixed(1)}</div>
                    <div>Ans</div>
                </div>
                <div class="stat-card">
                    <div><i class="fas fa-exclamation-triangle"></i> Urgent (‚â§1 an)</div>
                    <div class="stat-value">${urgencyCounts.immediate}</div>
                    <div>Enseignants</div>
                </div>
                <div class="stat-card">
                    <div><i class="fas fa-exclamation-circle"></i> Court terme (1-3 ans)</div>
                    <div class="stat-value">${urgencyCounts.short}</div>
                    <div>Enseignants</div>
                </div>
                <div class="stat-card">
                    <div><i class="fas fa-info-circle"></i> Moyen terme (3-5 ans)</div>
                    <div class="stat-value">${urgencyCounts.medium}</div>
                    <div>Enseignants</div>
                </div>
            `;
        }

        function updateRetirementAlerts() {
            const container = document.getElementById('retirementAlerts');
            if (!container) return;
            
            if (teachersData.length === 0) {
                container.innerHTML = '<p class="text-center">Aucune alerte</p>';
                return;
            }
            
            // Trouver les retraites imminentes
            const imminentRetirements = teachersData.filter(teacher => 
                teacher.yearsToRetirement !== null && teacher.yearsToRetirement <= 1
            );
            
            let html = '<div style="background: white; padding: 15px; border-radius: 8px;">';
            
            if (imminentRetirements.length === 0) {
                html += '<p class="text-center" style="color: var(--success-color);"><i class="fas fa-check-circle"></i> Aucune retraite imminente</p>';
            } else {
                html += '<h5 style="margin-bottom: 15px; color: var(--danger-color);"><i class="fas fa-exclamation-triangle"></i> Retraites imminentes (‚â§1 an)</h5>';
                
                imminentRetirements.forEach(teacher => {
                    const retirementDate = teacher.data && teacher.data.professional && teacher.data.professional.retirement_date ?
                        new Date(teacher.data.professional.retirement_date).toLocaleDateString() : 'Date inconnue';
                    
                    html += `
                        <div style="padding: 10px; margin-bottom: 10px; background: #ffebee; border-radius: 5px; border-left: 4px solid var(--danger-color);">
                            <strong>${teacher.fullName}</strong><br>
                            <small>${teacher.establishment || '√âtablissement inconnu'} - Retraite: ${retirementDate}</small>
                        </div>
                    `;
                });
            }
            
            html += '</div>';
            container.innerHTML = html;
        }

        function updateUpcomingRetirements() {
            const container = document.getElementById('upcomingRetirements');
            if (!container) return;
            
            if (teachersData.length === 0) {
                container.innerHTML = '<p class="text-center">Aucune donn√©e</p>';
                return;
            }
            
            // Trouver les 5 prochaines retraites
            const teachersWithRetirement = teachersData
                .filter(teacher => teacher.data && teacher.data.professional && teacher.data.professional.retirement_date)
                .sort((a, b) => {
                    const dateA = new Date(a.data.professional.retirement_date);
                    const dateB = new Date(b.data.professional.retirement_date);
                    return dateA - dateB;
                })
                .slice(0, 5);
            
            let html = '<div style="background: white; padding: 15px; border-radius: 8px;">';
            
            if (teachersWithRetirement.length === 0) {
                html += '<p class="text-center">Aucune date de retraite d√©finie</p>';
            } else {
                teachersWithRetirement.forEach(teacher => {
                    const retirementDate = new Date(teacher.data.professional.retirement_date);
                    const yearsLeft = teacher.yearsToRetirement;
                    
                    html += `
                        <div style="padding: 10px; margin-bottom: 10px; background: #f8f9fa; border-radius: 5px; border-left: 4px solid ${yearsLeft <= 1 ? 'var(--danger-color)' : yearsLeft <= 3 ? 'var(--warning-color)' : 'var(--info-color)'};">
                            <strong>${teacher.fullName}</strong><br>
                            <small>${teacher.establishment || '√âtablissement inconnu'}</small><br>
                            <div style="margin-top: 5px; font-size: 0.9em;">
                                <i class="fas fa-calendar"></i> ${retirementDate.toLocaleDateString()}
                                <span class="badge ${yearsLeft <= 1 ? 'badge-danger' : yearsLeft <= 3 ? 'badge-warning' : 'badge-info'}" style="margin-left: 10px;">
                                    ${yearsLeft} an${yearsLeft > 1 ? 's' : ''}
                                </span>
                            </div>
                        </div>
                    `;
                });
            }
            
            html += '</div>';
            container.innerHTML = html;
        }

        function filterRetirement() {
            const searchTerm = document.getElementById('retirementSearch').value.toLowerCase();
            const yearFilter = document.getElementById('retirementYearFilter').value;
            
            // Cette fonction serait utilis√©e pour filtrer le tableau des retraites
            // Pour l'instant, on se contente de mettre √† jour l'affichage
            updateRetirementTable();
            
            if (searchTerm || yearFilter) {
                showNotification('Filtres appliqu√©s', 'info');
            }
        }

        function applyRetirementFilters() {
            filterRetirement();
        }

        function generateRetirementReport() {
            if (teachersData.length === 0) {
                showNotification('Aucune donn√©e pour g√©n√©rer un rapport', 'warning');
                return;
            }
            
            showLoader(true);
            
            try {
                // Cr√©er un rapport HTML simple
                const reportWindow = window.open('', '_blank');
                const reportDate = new Date().toLocaleString();
                
                const teachersWithRetirement = teachersData.filter(teacher => 
                    teacher.data && teacher.data.professional && teacher.data.professional.retirement_date
                ).length;
                
                const imminentRetirements = teachersData.filter(teacher => 
                    teacher.yearsToRetirement !== null && teacher.yearsToRetirement <= 1
                ).length;
                
                let reportHTML = `
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <title>Rapport de planification des retraites - ${reportDate}</title>
                        <style>
                            body { font-family: Arial, sans-serif; margin: 20px; }
                            h1 { color: #2c3e50; }
                            h2 { color: #3498db; border-bottom: 2px solid #3498db; padding-bottom: 5px; }
                            table { width: 100%; border-collapse: collapse; margin: 20px 0; }
                            th { background: #3498db; color: white; padding: 10px; text-align: left; }
                            td { padding: 8px 10px; border-bottom: 1px solid #ddd; }
                            .urgent { background: #ffebee; }
                            .warning { background: #fff3e0; }
                            .info { background: #e3f2fd; }
                            .footer { margin-top: 40px; padding-top: 20px; border-top: 1px solid #ddd; color: #666; font-size: 0.9em; }
                        </style>
                    </head>
                    <body>
                        <h1>üìÖ Rapport de planification des retraites</h1>
                        <p>Date de g√©n√©ration: ${reportDate}</p>
                        
                        <h2>üìä Statistiques</h2>
                        <table>
                            <tr>
                                <th>Statistique</th>
                                <th>Valeur</th>
                            </tr>
                            <tr>
                                <td>Total des enseignants</td>
                                <td>${teachersData.length}</td>
                            </tr>
                            <tr>
                                <td>Enseignants avec date de retraite</td>
                                <td>${teachersWithRetirement} (${teachersData.length > 0 ? ((teachersWithRetirement / teachersData.length) * 100).toFixed(1) : 0}%)</td>
                            </tr>
                            <tr>
                                <td>Retraites imminentes (‚â§1 an)</td>
                                <td>${imminentRetirements}</td>
                            </tr>
                            <tr>
                                <td>Retraites √† court terme (1-3 ans)</td>
                                <td>${teachersData.filter(t => t.yearsToRetirement !== null && t.yearsToRetirement > 1 && t.yearsToRetirement <= 3).length}</td>
                            </tr>
                            <tr>
                                <td>Retraites √† moyen terme (3-5 ans)</td>
                                <td>${teachersData.filter(t => t.yearsToRetirement !== null && t.yearsToRetirement > 3 && t.yearsToRetirement <= 5).length}</td>
                            </tr>
                        </table>
                        
                        <h2>üë• Liste des retraites √† venir</h2>
                        <table>
                            <thead>
                                <tr>
                                    <th>Enseignant</th>
                                    <th>√âtablissement</th>
                                    <th>Date de retraite</th>
                                    <th>Ann√©es restantes</th>
                                    <th>Cat√©gorie</th>
                                </tr>
                            </thead>
                            <tbody>
                `;
                
                // Trier par date de retraite
                const sortedTeachers = teachersData
                    .filter(teacher => teacher.data && teacher.data.professional && teacher.data.professional.retirement_date)
                    .sort((a, b) => {
                        const dateA = new Date(a.data.professional.retirement_date);
                        const dateB = new Date(b.data.professional.retirement_date);
                        return dateA - dateB;
                    });
                
                sortedTeachers.forEach(teacher => {
                    const retirementDate = new Date(teacher.data.professional.retirement_date);
                    const yearsLeft = teacher.yearsToRetirement;
                    
                    let rowClass = '';
                    if (yearsLeft <= 1) rowClass = 'urgent';
                    else if (yearsLeft <= 3) rowClass = 'warning';
                    else if (yearsLeft <= 5) rowClass = 'info';
                    
                    reportHTML += `
                        <tr class="${rowClass}">
                            <td>${teacher.fullName}</td>
                            <td>${teacher.establishment || ''}</td>
                            <td>${retirementDate.toLocaleDateString()}</td>
                            <td>${yearsLeft} an${yearsLeft > 1 ? 's' : ''}</td>
                            <td>${teacher.data.professional.professional_category || ''}</td>
                        </tr>
                    `;
                });
                
                reportHTML += `
                            </tbody>
                        </table>
                        
                        <div class="footer">
                            <p>Rapport g√©n√©r√© automatiquement par la Plateforme d'Analyse - Inspecteurs √âducation</p>
                            <p>Ce rapport doit √™tre mis √† jour r√©guli√®rement pour une planification efficace des remplacements.</p>
                        </div>
                    </body>
                    </html>
                `;
                
                reportWindow.document.write(reportHTML);
                reportWindow.document.close();
                
                showNotification('Rapport de retraite g√©n√©r√© avec succ√®s', 'success');
                
            } catch (error) {
                console.error('Erreur lors de la g√©n√©ration du rapport:', error);
                showNotification('Erreur lors de la g√©n√©ration du rapport: ' + error.message, 'error');
            } finally {
                showLoader(false);
            }
        }

        // ============================================
        // FONCTIONS D'EXPORT COMPL√àTES
        // ============================================

        function updateExportPreview() {
            const container = document.getElementById('exportPreview');
            if (!container) return;
            
            if (teachersData.length === 0) {
                container.innerHTML = '<p class="text-center">Aucune donn√©e √† exporter. Importez des donn√©es d\'abord.</p>';
                return;
            }
            
            const totalTeachers = teachersData.length;
            const completeTeachers = teachersData.filter(t => t.complete).length;
            const totalFiles = teachersData.reduce((sum, teacher) => sum + (teacher.files ? teacher.files.length : 0), 0);
            
            container.innerHTML = `
                <div style="background: white; padding: 20px; border-radius: 8px;">
                    <h4 style="margin-bottom: 15px;"><i class="fas fa-info-circle"></i> R√©sum√© des donn√©es disponibles</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                        <div class="stat-card">
                            <div>Enseignants</div>
                            <div class="stat-value">${totalTeachers}</div>
                            <div>Total</div>
                        </div>
                        <div class="stat-card">
                            <div>Fiches compl√®tes</div>
                            <div class="stat-value">${completeTeachers}</div>
                            <div>${totalTeachers > 0 ? ((completeTeachers / totalTeachers) * 100).toFixed(1) : 0}%</div>
                        </div>
                        <div class="stat-card">
                            <div>Fichiers</div>
                            <div class="stat-value">${totalFiles}</div>
                            <div>Import√©s</div>
                        </div>
                        <div class="stat-card">
                            <div>Mati√®res</div>
                            <div class="stat-value">${countUniqueSubjects()}</div>
                            <div>Diff√©rentes</div>
                        </div>
                    </div>
                    
                    <h5 style="margin-bottom: 10px;">D√©tails par cat√©gorie:</h5>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Cat√©gorie</th>
                                <th>Enregistrements</th>
                                <th>Disponible pour export</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Enseignants (liste)</td>
                                <td>${totalTeachers}</td>
                                <td><span class="badge badge-success">Oui</span></td>
                            </tr>
                            <tr>
                                <td>Donn√©es p√©dagogiques</td>
                                <td>${countDataRecords('subjects') + countDataRecords('lessons')}</td>
                                <td><span class="badge ${countDataRecords('subjects') > 0 ? 'badge-success' : 'badge-warning'}">${countDataRecords('subjects') > 0 ? 'Oui' : 'Non'}</span></td>
                            </tr>
                            <tr>
                                <td>√âvaluations</td>
                                <td>${countDataRecords('evaluations')}</td>
                                <td><span class="badge ${countDataRecords('evaluations') > 0 ? 'badge-success' : 'badge-warning'}">${countDataRecords('evaluations') > 0 ? 'Oui' : 'Non'}</span></td>
                            </tr>
                            <tr>
                                <td>Projets et activit√©s</td>
                                <td>${countDataRecords('projects') + countDataRecords('activities')}</td>
                                <td><span class="badge ${countDataRecords('projects') > 0 ? 'badge-success' : 'badge-warning'}">${countDataRecords('projects') > 0 ? 'Oui' : 'Non'}</span></td>
                            </tr>
                            <tr>
                                <td>Planification retraite</td>
                                <td>${countTeachersWithRetirementDate()}</td>
                                <td><span class="badge ${countTeachersWithRetirementDate() > 0 ? 'badge-success' : 'badge-warning'}">${countTeachersWithRetirementDate() > 0 ? 'Oui' : 'Non'}</span></td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <div style="margin-top: 20px; padding: 15px; background: #e8f5e9; border-radius: 5px; border-left: 4px solid var(--success-color);">
                        <h5><i class="fas fa-lightbulb"></i> Recommandation</h5>
                        <p>Utilisez "Export complet" pour obtenir toutes les donn√©es dans un seul fichier Excel avec plusieurs onglets.</p>
                    </div>
                </div>
            `;
        }

        function countTeachersWithRetirementDate() {
            return teachersData.filter(teacher => {
                return teacher.data && teacher.data.professional && teacher.data.professional.retirement_date;
            }).length;
        }

        function exportAllToExcel() {
            if (teachersData.length === 0) {
                showNotification('Aucune donn√©e √† exporter', 'warning');
                return;
            }
            
            showLoader(true);
            
            try {
                // Cr√©er un classeur avec plusieurs onglets
                const wb = XLSX.utils.book_new();
                
                // 1. Onglet "Enseignants"
                const teachersSheet = prepareTeachersSheet();
                XLSX.utils.book_append_sheet(wb, teachersSheet, "Enseignants");
                
                // 2. Onglet "P√©dagogie"
                const pedagogySheet = preparePedagogySheet();
                XLSX.utils.book_append_sheet(wb, pedagogySheet, "P√©dagogie");
                
                // 3. Onglet "√âvaluations"
                const evaluationsSheet = prepareEvaluationsSheet();
                XLSX.utils.book_append_sheet(wb, evaluationsSheet, "√âvaluations");
                
                // 4. Onglet "Projets"
                const projectsSheet = prepareProjectsSheet();
                XLSX.utils.book_append_sheet(wb, projectsSheet, "Projets");
                
                // 5. Onglet "Retraite"
                const retirementSheet = prepareRetirementSheet();
                XLSX.utils.book_append_sheet(wb, retirementSheet, "Retraite");
                
                // 6. Onglet "Statistiques"
                const statsSheet = prepareStatsSheet();
                XLSX.utils.book_append_sheet(wb, statsSheet, "Statistiques");
                
                // G√©n√©rer le fichier Excel
                const fileName = `export_enseignants_${new Date().toISOString().split('T')[0]}.xlsx`;
                XLSX.writeFile(wb, fileName);
                
                showNotification('Export complet r√©alis√© avec succ√®s', 'success');
                
            } catch (error) {
                console.error('Erreur lors de l\'export:', error);
                showNotification('Erreur lors de l\'export: ' + error.message, 'error');
            } finally {
                showLoader(false);
            }
        }

        function prepareTeachersSheet() {
            const headers = [
                "Nom", "Pr√©nom", "Nom complet", "Matricule", "√âtablissement",
                "√Çge", "Ann√©es de service", "Ann√©es avant retraite", "Fiche compl√®te",
                "Date de naissance", "Date d'engagement", "Date de retraite",
                "Cat√©gorie", "Grade", "Heures hebdomadaires"
            ];
            
            const data = teachersData.map(teacher => [
                teacher.lastName || '',
                teacher.firstName || '',
                teacher.fullName || '',
                teacher.matricule || '',
                teacher.establishment || '',
                teacher.age || '',
                teacher.serviceYears || '',
                teacher.yearsToRetirement || '',
                teacher.complete ? "Oui" : "Non",
                teacher.data && teacher.data.personal ? teacher.data.personal.birth_date || '' : '',
                teacher.data && teacher.data.professional ? teacher.data.professional.engagement_date || '' : '',
                teacher.data && teacher.data.professional ? teacher.data.professional.retirement_date || '' : '',
                teacher.data && teacher.data.professional ? teacher.data.professional.professional_category || '' : '',
                teacher.data && teacher.data.professional ? teacher.data.professional.grade || '' : '',
                teacher.data && teacher.data.professional ? teacher.data.professional.weekly_hours || '' : ''
            ]);
            
            return XLSX.utils.aoa_to_sheet([headers, ...data]);
        }

        function preparePedagogySheet() {
            const headers = [
                "Enseignant", "Matricule", "√âtablissement",
                "Mati√®re", "Type", "Heures", "Niveau"
            ];
            
            const data = [];
            teachersData.forEach(teacher => {
                if (teacher.data && teacher.data.subjects) {
                    teacher.data.subjects.forEach(subject => {
                        data.push([
                            teacher.fullName || '',
                            teacher.matricule || '',
                            teacher.establishment || '',
                            subject.name || '',
                            subject.type || '',
                            subject.hours || '',
                            subject.level || ''
                        ]);
                    });
                }
            });
            
            return XLSX.utils.aoa_to_sheet([headers, ...data]);
        }

        function prepareEvaluationsSheet() {
            const headers = [
                "Enseignant", "Matricule", "√âtablissement",
                "Date", "Type", "Mati√®re", "Moyenne", "Meilleure note",
                "Nombre d'√©l√®ves", "Commentaire"
            ];
            
            const data = [];
            teachersData.forEach(teacher => {
                if (teacher.data && teacher.data.evaluations) {
                    teacher.data.evaluations.forEach(evaluation => {
                        data.push([
                            teacher.fullName || '',
                            teacher.matricule || '',
                            teacher.establishment || '',
                            evaluation.date || '',
                            evaluation.type || '',
                            evaluation.subject || '',
                            evaluation.average || '',
                            evaluation.best || '',
                            evaluation.student_count || '',
                            evaluation.comment || ''
                        ]);
                    });
                }
            });
            
            return XLSX.utils.aoa_to_sheet([headers, ...data]);
        }

        function prepareProjectsSheet() {
            const headers = [
                "Enseignant", "Matricule", "√âtablissement",
                "Projet", "Type", "Date d√©but", "Date fin",
                "Description", "Statut", "Participants"
            ];
            
            const data = [];
            teachersData.forEach(teacher => {
                if (teacher.data && teacher.data.projects) {
                    teacher.data.projects.forEach(project => {
                        data.push([
                            teacher.fullName || '',
                            teacher.matricule || '',
                            teacher.establishment || '',
                            project.name || '',
                            project.type || '',
                            project.start_date || '',
                            project.end_date || '',
                            project.description || '',
                            project.status || '',
                            project.participants ? project.participants.join(', ') : ''
                        ]);
                    });
                }
            });
            
            return XLSX.utils.aoa_to_sheet([headers, ...data]);
        }

        function prepareRetirementSheet() {
            const headers = [
                "Enseignant", "Matricule", "√âtablissement",
                "√Çge", "Ann√©es de service", "Date de retraite",
                "Ann√©es restantes", "Cat√©gorie", "Remarques"
            ];
            
            const data = teachersData
                .filter(teacher => teacher.data && teacher.data.professional && teacher.data.professional.retirement_date)
                .map(teacher => [
                    teacher.fullName || '',
                    teacher.matricule || '',
                    teacher.establishment || '',
                    teacher.age || '',
                    teacher.serviceYears || '',
                    teacher.data.professional.retirement_date || '',
                    teacher.yearsToRetirement || '',
                    teacher.data.professional.professional_category || '',
                    teacher.data.professional.retirement_notes || ''
                ]);
            
            return XLSX.utils.aoa_to_sheet([headers, ...data]);
        }

        function prepareStatsSheet() {
            const headers = ["Statistique", "Valeur", "D√©tail"];
            
            const totalTeachers = teachersData.length;
            const completeTeachers = teachersData.filter(t => t.complete).length;
            const averageAge = calculateAverage(teachersData.map(t => t.age).filter(age => age !== null));
            const averageService = calculateAverage(teachersData.map(t => t.serviceYears).filter(years => years !== null));
            const subjectCount = countUniqueSubjects();
            const establishmentCount = [...new Set(teachersData.map(t => t.establishment).filter(Boolean))].length;
            const upcomingRetirements = teachersData.filter(t => t.yearsToRetirement !== null && t.yearsToRetirement <= 5).length;
            
            const data = [
                ["Enseignants total", totalTeachers, "Nombre total d'enseignants import√©s"],
                ["Fiches compl√®tes", completeTeachers, `${totalTeachers > 0 ? ((completeTeachers / totalTeachers) * 100).toFixed(1) : 0}% du total`],
                ["√Çge moyen", averageAge.toFixed(1), "√Çge moyen des enseignants"],
                ["Service moyen", averageService.toFixed(1), "Ann√©es de service moyennes"],
                ["Mati√®res diff√©rentes", subjectCount, "Nombre de mati√®res enseign√©es"],
                ["√âtablissements", establishmentCount, "Nombre d'√©tablissements diff√©rents"],
                ["Retraites proches", upcomingRetirements, "Retraites dans moins de 5 ans"],
                ["Taux de compl√©tion", `${totalTeachers > 0 ? ((completeTeachers / totalTeachers) * 100).toFixed(1) : 0}%`, "Pourcentage de fiches compl√®tes"],
                ["Date d'export", new Date().toLocaleDateString(), "Date de g√©n√©ration du rapport"],
                ["Nombre de fichiers", teachersData.reduce((sum, t) => sum + (t.files ? t.files.length : 0), 0), "Total des fichiers import√©s"]
            ];
            
            return XLSX.utils.aoa_to_sheet([headers, ...data]);
        }

        function exportTeachersToExcel() {
            if (teachersData.length === 0) {
                showNotification('Aucun enseignant √† exporter', 'warning');
                return;
            }
            
            const sheet = prepareTeachersSheet();
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, sheet, "Enseignants");
            
            const fileName = `liste_enseignants_${new Date().toISOString().split('T')[0]}.xlsx`;
            XLSX.writeFile(wb, fileName);
            
            showNotification('Liste des enseignants export√©e avec succ√®s', 'success');
        }

        function exportPedagogyToExcel() {
            if (countDataRecords('subjects') === 0) {
                showNotification('Aucune donn√©e p√©dagogique √† exporter', 'warning');
                return;
            }
            
            const sheet = preparePedagogySheet();
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, sheet, "P√©dagogie");
            
            const fileName = `donnees_pedagogiques_${new Date().toISOString().split('T')[0]}.xlsx`;
            XLSX.writeFile(wb, fileName);
            
            showNotification('Donn√©es p√©dagogiques export√©es avec succ√®s', 'success');
        }

        function exportEvaluationsToExcel() {
            if (countDataRecords('evaluations') === 0) {
                showNotification('Aucune donn√©e d\'√©valuation √† exporter', 'warning');
                return;
            }
            
            const sheet = prepareEvaluationsSheet();
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, sheet, "√âvaluations");
            
            const fileName = `evaluations_${new Date().toISOString().split('T')[0]}.xlsx`;
            XLSX.writeFile(wb, fileName);
            
            showNotification('Donn√©es d\'√©valuation export√©es avec succ√®s', 'success');
        }

        function exportRetirementToExcel() {
            if (countTeachersWithRetirementDate() === 0) {
                showNotification('Aucune donn√©e de retraite √† exporter', 'warning');
                return;
            }
            
            const sheet = prepareRetirementSheet();
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, sheet, "Retraite");
            
            const fileName = `planification_retraite_${new Date().toISOString().split('T')[0]}.xlsx`;
            XLSX.writeFile(wb, fileName);
            
            showNotification('Planification retraite export√©e avec succ√®s', 'success');
        }

        function exportProjectsToExcel() {
            if (countDataRecords('projects') === 0) {
                showNotification('Aucun projet ou activit√© √† exporter', 'warning');
                return;
            }
            
            const sheet = prepareProjectsSheet();
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, sheet, "Projets");
            
            const fileName = `projets_activites_${new Date().toISOString().split('T')[0]}.xlsx`;
            XLSX.writeFile(wb, fileName);
            
            showNotification('Projets et activit√©s export√©s avec succ√®s', 'success');
        }

        function exportCustomExcel() {
            // Cette fonction permettrait un export personnalis√©
            // Pour l'instant, on utilise l'export complet
            exportAllToExcel();
        }

        // ============================================
        // FONCTIONS PYTHON COMPL√àTES
        // ============================================

        async function runPythonAnalysis() {
            if (!pyodideLoaded) {
                showNotification('Chargement de Pyodide en cours...', 'warning');
                await initPyodide();
                if (!pyodideLoaded) {
                    showNotification('Impossible de charger Pyodide. Veuillez r√©essayer.', 'error');
                    return;
                }
            }
            
            const pythonCode = document.getElementById('pythonEditor').value;
            const outputElement = document.getElementById('pythonOutput');
            
            if (!pythonCode.trim()) {
                showNotification('Veuillez entrer du code Python', 'warning');
                return;
            }
            
            showLoader(true);
            outputElement.innerHTML = '<span style="color: #4CAF50;">Ex√©cution en cours...</span>';
            
            try {
                // Pr√©parer les donn√©es pour Python
                const pythonReadyData = prepareDataForPython(teachersData);
                
                // Injecter les donn√©es dans l'environnement Python
                pyodide.globals.set('teachers_data', pythonReadyData);
                pyodide.globals.set('FILE_TYPES', FILE_TYPES);
                
                // Ajouter des modules essentiels
                await pyodide.runPythonAsync(`
                    import json
                    import datetime
                    from datetime import datetime as dt
                    import statistics
                    import math
                    from collections import Counter, defaultdict
                `);
                
                // Ex√©cuter le code Python
                try {
                    await pyodide.runPythonAsync(pythonCode);
                    showNotification('Analyse Python ex√©cut√©e avec succ√®s', 'success');
                } catch (pyError) {
                    outputElement.innerHTML = `
                        <div style="color: #ff6b6b; font-family: monospace;">
                            <strong>Erreur Python:</strong><br>
                            ${pyError.toString().replace(/\n/g, '<br>')}
                        </div>
                    `;
                    showNotification('Erreur dans l\'ex√©cution Python', 'error');
                }
                
                // Mettre √† jour les statistiques Python
                updatePythonStats();
                
            } catch (error) {
                outputElement.innerHTML = `
                    <div style="color: #ff6b6b; font-family: monospace;">
                        <strong>Erreur d'ex√©cution:</strong><br>
                        ${error.toString().replace(/\n/g, '<br>')}
                    </div>
                `;
                showNotification('Erreur dans l\'analyse Python', 'error');
            } finally {
                showLoader(false);
            }
        }

        function prepareDataForPython(data) {
            // Convertir les donn√©es en format compatible avec Python
            return JSON.parse(JSON.stringify(data));
        }

        function loadPythonTemplate(templateName) {
            const templates = {
                'basic_analysis': `# === ANALYSE BASIQUE DES DONN√âES ENSEIGNANTS ===
def analyse_basique(teachers_data):
    """Analyse statistique basique des enseignants"""
    if not teachers_data:
        return "‚ö†Ô∏è Aucune donn√©e disponible"
    
    total = len(teachers_data)
    complet = sum(1 for t in teachers_data if t.get('complete', False))
    
    # Calcul des √¢ges
    ages = [t.get('age') for t in teachers_data if t.get('age')]
    age_moyenne = statistics.mean(ages) if ages else 0
    age_min = min(ages) if ages else 0
    age_max = max(ages) if ages else 0
    
    # Analyse par √©tablissement
    etablissements = Counter()
    for teacher in teachers_data:
        etab = teacher.get('establishment', 'Non sp√©cifi√©')
        etablissements[etab] += 1
    
    # Analyse par cat√©gorie professionnelle
    categories = Counter()
    for teacher in teachers_data:
        if teacher.get('data') and teacher['data'].get('professional'):
            cat = teacher['data']['professional'].get('professional_category', 'Non sp√©cifi√©')
            categories[cat] += 1
    
    # G√©n√©ration du rapport
    rapport = []
    rapport.append("=== RAPPORT D'ANALYSE BASIQUE ===")
    rapport.append(f"üìÖ Date: {dt.now().strftime('%Y-%m-%d %H:%M:%S')}")
    rapport.append(f"üë• Total enseignants: {total}")
    rapport.append(f"‚úÖ Fiches compl√®tes: {complet} ({complet/total*100:.1f}%)")
    rapport.append(f"üéÇ √Çge moyen: {age_moyenne:.1f} ans (min: {age_min}, max: {age_max})")
    rapport.append("")
    rapport.append("=== üìä R√âPARTITION PAR √âTABLISSEMENT ===")
    for etab, count in etablissements.most_common(15):
        rapport.append(f"üè´ {etab}: {count} ({count/total*100:.1f}%)")
    
    rapport.append("")
    rapport.append("=== üè∑Ô∏è R√âPARTITION PAR CAT√âGORIE ===")
    for cat, count in categories.most_common():
        if cat != 'Non sp√©cifi√©':
            rapport.append(f"üìã {cat}: {count} ({count/total*100:.1f}%)")
    
    return "\\n".join(rapport)

# Ex√©cution
print(analyse_basique(teachers_data))`,

                'pedagogy_analysis': `# === ANALYSE P√âDAGOGIQUE APPROFONDIE ===
def analyse_pedagogique(teachers_data):
    """Analyse d√©taill√©e des donn√©es p√©dagogiques"""
    if not teachers_data:
        return "‚ö†Ô∏è Aucune donn√©e p√©dagogique disponible"
    
    rapport = []
    rapport.append("=== üìö ANALYSE P√âDAGOGIQUE ===")
    
    # Statistiques g√©n√©rales
    total_lecons = sum(len(t.get('data', {}).get('lessons', [])) for t in teachers_data)
    total_tp = sum(len(t.get('data', {}).get('tps', [])) for t in teachers_data)
    
    enseignants_avec_lecons = sum(1 for t in teachers_data if t.get('data', {}).get('lessons'))
    enseignants_avec_tp = sum(1 for t in teachers_data if t.get('data', {}).get('tps'))
    
    rapport.append(f"üìñ Le√ßons totales: {total_lecons}")
    rapport.append(f"üî¨ TP total: {total_tp}")
    rapport.append(f"üë®‚Äçüè´ Enseignants avec le√ßons: {enseignants_avec_lecons}/{len(teachers_data)} ({enseignants_avec_lecons/len(teachers_data)*100:.1f}%)")
    rapport.append(f"üë©‚Äçüî¨ Enseignants avec TP: {enseignants_avec_tp}/{len(teachers_data)} ({enseignants_avec_tp/len(teachers_data)*100:.1f}%)")
    
    # Analyse par mati√®re
    matieres = Counter()
    heures_par_matiere = defaultdict(float)
    
    for teacher in teachers_data:
        if teacher.get('data') and teacher['data'].get('subjects'):
            for subject in teacher['data']['subjects']:
                if subject and subject.get('name'):
                    matiere = subject['name']
                    matieres[matiere] += 1
                    heures = float(subject.get('hours', 0) or 0)
                    heures_par_matiere[matiere] += heures
    
    rapport.append("")
    rapport.append("=== üìö MATI√àRES LES PLUS ENSEIGN√âES ===")
    for matiere, count in matieres.most_common(15):
        heures = heures_par_matiere[matiere]
        rapport.append(f"üìñ {matiere}: {count} enseignants, {heures:.0f} heures totales")
    
    # Analyse des emplois du temps
    teachers_avec_edt = sum(1 for t in teachers_data if t.get('data', {}).get('timetable'))
    rapport.append("")
    rapport.append(f"üìÖ Enseignants avec emploi du temps: {teachers_avec_edt} ({teachers_avec_edt/len(teachers_data)*100:.1f}%)")
    
    # Analyse des ressources
    total_ressources = sum(len(t.get('data', {}).get('resources', [])) for t in teachers_data)
    rapport.append(f"üìé Ressources p√©dagogiques totales: {total_ressources}")
    
    return "\\n".join(rapport)

print(analyse_pedagogique(teachers_data))`,

                'retirement_analysis': `# === ANALYSE DE LA PLANIFICATION DES RETRAITES ===
def analyse_retraites(teachers_data):
    """Analyse des d√©parts √† la retraite"""
    rapport = []
    rapport.append("=== üèñÔ∏è ANALYSE DES RETRAITES ===")
    
    # Enseignants avec date de retraite
    teachers_avec_date = []
    for teacher in teachers_data:
        if teacher.get('data') and teacher['data'].get('professional'):
            if teacher['data']['professional'].get('retirement_date'):
                teachers_avec_date.append(teacher)
    
    total = len(teachers_data)
    avec_date = len(teachers_avec_date)
    sans_date = total - avec_date
    
    rapport.append(f"üë• Total enseignants: {total}")
    rapport.append(f"üìÖ Avec date de retraite: {avec_date} ({avec_date/total*100:.1f}%)")
    rapport.append(f"‚ùì Sans date de retraite: {sans_date} ({sans_date/total*100:.1f}%)")
    
    if not teachers_avec_date:
        return "\\n".join(rapport)
    
    # Calcul des ann√©es restantes
    aujourdhui = datetime.datetime.now()
    
    retraites_par_annee = Counter()
    urgence = {'< 1 an': 0, '1-3 ans': 0, '3-5 ans': 0, '> 5 ans': 0}
    annees_restantes_liste = []
    
    for teacher in teachers_avec_date:
        date_retraite_str = teacher['data']['professional']['retirement_date']
        try:
            if 'T' in date_retraite_str:
                date_retraite = datetime.datetime.fromisoformat(date_retraite_str.replace('Z', '+00:00'))
            else:
                date_retraite = datetime.datetime.strptime(date_retraite_str, '%Y-%m-%d')
            
            annees_restantes = (date_retraite - aujourdhui).days / 365.25
            annees_restantes_liste.append(annees_restantes)
            
            annee = date_retraite.year
            retraites_par_annee[annee] += 1
            
            if annees_restantes < 1:
                urgence['< 1 an'] += 1
            elif annees_restantes < 3:
                urgence['1-3 ans'] += 1
            elif annees_restantes < 5:
                urgence['3-5 ans'] += 1
            else:
                urgence['> 5 ans'] += 1
                
        except Exception as e:
            continue
    
    rapport.append("")
    rapport.append("=== ‚ö†Ô∏è R√âPARTITION PAR URGENCE ===")
    for categorie, count in urgence.items():
        pourcentage = count / avec_date * 100
        rapport.append(f"üïí {categorie}: {count} ({pourcentage:.1f}%)")
    
    if annees_restantes_liste:
        rapport.append("")
        rapport.append("=== üìä STATISTIQUES TEMPS RESTANT ===")
        rapport.append(f"‚è±Ô∏è  Moyenne: {statistics.mean(annees_restantes_liste):.1f} ans")
        rapport.append(f"üìà Maximum: {max(annees_restantes_liste):.1f} ans")
        rapport.append(f"üìâ Minimum: {min(annees_restantes_liste):.1f} ans")
        rapport.append(f"üìä M√©diane: {statistics.median(annees_restantes_liste):.1f} ans")
    
    rapport.append("")
    rapport.append("=== üìÖ RETRAITES PAR ANN√âE ===")
    for annee, count in sorted(retraites_par_annee.items()):
        rapport.append(f"üóìÔ∏è  {annee}: {count} retraites")
    
    # Analyse par cat√©gorie
    retraites_par_categorie = Counter()
    for teacher in teachers_avec_date:
        if teacher.get('data') and teacher['data'].get('professional'):
            cat = teacher['data']['professional'].get('professional_category', 'Non sp√©cifi√©')
            retraites_par_categorie[cat] += 1
    
    rapport.append("")
    rapport.append("=== üè∑Ô∏è RETRAITES PAR CAT√âGORIE ===")
    for cat, count in retraites_par_categorie.most_common():
        if cat != 'Non sp√©cifi√©':
            rapport.append(f"üìã {cat}: {count}")
    
    return "\\n".join(rapport)

print(analyse_retraites(teachers_data))`,

                'evaluation_analysis': `# === ANALYSE DES √âVALUATIONS ===
def analyse_evaluations(teachers_data):
    """Analyse des donn√©es d'√©valuation"""
    if not teachers_data:
        return "‚ö†Ô∏è Aucune donn√©e d'√©valuation disponible"
    
    rapport = []
    rapport.append("=== üìä ANALYSE DES √âVALUATIONS ===")
    
    # Compilation des donn√©es
    total_evaluations = 0
    evaluations_par_type = Counter()
    evaluations_par_matiere = Counter()
    evaluations_par_mois = Counter()
    
    notes_totales = []
    meilleures_notes = []
    
    for teacher in teachers_data:
        if teacher.get('data') and teacher['data'].get('evaluations'):
            evaluations = teacher['data']['evaluations']
            total_evaluations += len(evaluations)
            
            for eval_item in evaluations:
                # Type d'√©valuation
                eval_type = eval_item.get('type', 'Non sp√©cifi√©')
                evaluations_par_type[eval_type] += 1
                
                # Mati√®re
                sujet = eval_item.get('subject', 'Non sp√©cifi√©')
                if sujet != 'Non sp√©cifi√©':
                    evaluations_par_matiere[sujet] += 1
                
                # Date
                date_str = eval_item.get('date', '')
                if date_str:
                    try:
                        mois = date_str[:7]  # YYYY-MM
                        evaluations_par_mois[mois] += 1
                    except:
                        pass
                
                # Notes
                moyenne = eval_item.get('average')
                meilleure = eval_item.get('best')
                
                if moyenne is not None:
                    try:
                        notes_totales.append(float(moyenne))
                    except:
                        pass
                
                if meilleure is not None:
                    try:
                        meilleures_notes.append(float(meilleure))
                    except:
                        pass
    
    rapport.append(f"üìà √âvaluations totales: {total_evaluations}")
    
    if notes_totales:
        rapport.append(f"üìä Moyenne g√©n√©rale: {statistics.mean(notes_totales):.2f}/20")
        rapport.append(f"üèÜ Meilleure note moyenne: {max(notes_totales):.2f}/20")
        rapport.append(f"üìâ √âcart-type: {statistics.stdev(notes_totales):.2f}")
    
    rapport.append("")
    rapport.append("=== üè∑Ô∏è R√âPARTITION PAR TYPE ===")
    for type_eval, count in evaluations_par_type.most_common():
        pourcentage = count / total_evaluations * 100 if total_evaluations > 0 else 0
        rapport.append(f"üìã {type_eval}: {count} ({pourcentage:.1f}%)")
    
    rapport.append("")
    rapport.append("=== üìö √âVALUATIONS PAR MATI√àRE (TOP 10) ===")
    for matiere, count in evaluations_par_matiere.most_common(10):
        pourcentage = count / total_evaluations * 100 if total_evaluations > 0 else 0
        rapport.append(f"üìñ {matiere}: {count} ({pourcentage:.1f}%)")
    
    rapport.append("")
    rapport.append("=== üìÖ √âVOLUTION MENSUELLE ===")
    for mois, count in sorted(evaluations_par_mois.items()):
        rapport.append(f"üóìÔ∏è  {mois}: {count} √©valuations")
    
    # Enseignants avec/sans √©valuations
    enseignants_avec_eval = sum(1 for t in teachers_data if t.get('data', {}).get('evaluations'))
    rapport.append("")
    rapport.append(f"üë®‚Äçüè´ Enseignants avec √©valuations: {enseignants_avec_eval}/{len(teachers_data)} ({enseignants_avec_eval/len(teachers_data)*100:.1f}%)")
    
    return "\\n".join(rapport)

print(analyse_evaluations(teachers_data))`,

                'export_analysis': `# === G√âN√âRATION DE RAPPORT COMPLET ===
def generer_rapport_complet(teachers_data):
    """G√©n√®re un rapport complet pour export"""
    import datetime
    
    rapport = []
    rapport.append("=" * 70)
    rapport.append("üìä RAPPORT COMPLET D'ANALYSE DES ENSEIGNANTS")
    rapport.append(f"üìÖ Date de g√©n√©ration: {datetime.datetime.now().strftime('%Y-%m-%d %H:%M:%S')}")
    rapport.append("=" * 70)
    rapport.append("")
    
    # 1. Statistiques g√©n√©rales
    rapport.append("1. üìà STATISTIQUES G√âN√âRALES")
    rapport.append("-" * 50)
    rapport.append(f"üë• Nombre total d'enseignants: {len(teachers_data)}")
    
    fiches_completes = sum(1 for t in teachers_data if t.get('complete', False))
    rapport.append(f"‚úÖ Fiches compl√®tes: {fiches_completes} ({fiches_completes/len(teachers_data)*100:.1f}%)")
    
    # Calcul de l'√¢ge
    ages = [t.get('age') for t in teachers_data if t.get('age')]
    if ages:
        rapport.append(f"üéÇ √Çge moyen: {statistics.mean(ages):.1f} ans")
        rapport.append(f"üìâ √Çge minimum: {min(ages)} ans")
        rapport.append(f"üìà √Çge maximum: {max(ages)} ans")
        rapport.append(f"üìä √âcart-type: {statistics.stdev(ages):.1f} ans")
    
    # 2. Analyse par √©tablissement
    rapport.append("")
    rapport.append("2. üè´ R√âPARTITION PAR √âTABLISSEMENT")
    rapport.append("-" * 50)
    
    etablissements = Counter()
    for teacher in teachers_data:
        etab = teacher.get('establishment', 'Non sp√©cifi√©')
        etablissements[etab] += 1
    
    for etab, count in etablissements.most_common():
        pourcentage = count / len(teachers_data) * 100
        rapport.append(f"üè´ {etab}: {count} enseignants ({pourcentage:.1f}%)")
    
    # 3. Analyse p√©dagogique
    rapport.append("")
    rapport.append("3. üìö ANALYSE P√âDAGOGIQUE")
    rapport.append("-" * 50)
    
    total_lecons = sum(len(t.get('data', {}).get('lessons', [])) for t in teachers_data)
    total_tp = sum(len(t.get('data', {}).get('tps', [])) for t in teachers_data)
    
    rapport.append(f"üìñ Le√ßons totales enregistr√©es: {total_lecons}")
    rapport.append(f"üî¨ Travaux pratiques total: {total_tp}")
    rapport.append(f"üìä Moyenne le√ßons/enseignant: {total_lecons/len(teachers_data):.1f}")
    
    # 4. Analyse des √©valuations
    rapport.append("")
    rapport.append("4. üìä ANALYSE DES √âVALUATIONS")
    rapport.append("-" * 50)
    
    total_evaluations = sum(len(t.get('data', {}).get('evaluations', [])) for t in teachers_data)
    rapport.append(f"üìà √âvaluations totales: {total_evaluations}")
    rapport.append(f"üìä Moyenne √©valuations/enseignant: {total_evaluations/len(teachers_data):.1f}")
    
    # 5. Planification retraite
    rapport.append("")
    rapport.append("5. üèñÔ∏è PLANIFICATION DES RETRAITES")
    rapport.append("-" * 50)
    
    teachers_avec_retraite = sum(1 for t in teachers_data 
                                if t.get('data') and t['data'].get('professional') 
                                and t['data']['professional'].get('retirement_date'))
    
    rapport.append(f"üìÖ Enseignants avec date de retraite: {teachers_avec_retraite}/{len(teachers_data)}")
    
    # 6. Recommandations
    rapport.append("")
    rapport.append("6. üí° RECOMMANDATIONS ET OBSERVATIONS")
    rapport.append("-" * 50)
    
    # Taux de compl√©tion
    taux_completion = fiches_completes / len(teachers_data) if teachers_data else 0
    if taux_completion < 0.7:
        rapport.append("‚ö†Ô∏è  Priorit√©: Am√©liorer le taux de compl√©tion des fiches")
        rapport.append(f"   ‚Ä¢ Objectif: Atteindre 70% (actuellement {taux_completion*100:.1f}%)")
    
    # Retraites
    taux_retraite = teachers_avec_retraite / len(teachers_data) if teachers_data else 0
    if taux_retraite < 0.5:
        rapport.append("‚ö†Ô∏è  Priorit√©: Compl√©ter les dates de retraite")
        rapport.append(f"   ‚Ä¢ Objectif: Atteindre 50% (actuellement {taux_retraite*100:.1f}%)")
    
    # Le√ßons
    taux_lecons = total_lecons / len(teachers_data) if teachers_data else 0
    if taux_lecons < 10:
        rapport.append("üìù Observation: Faible nombre de le√ßons enregistr√©es")
        rapport.append(f"   ‚Ä¢ Moyenne actuelle: {taux_lecons:.1f} le√ßons/enseignant")
    
    # √âvaluations
    taux_evaluations = total_evaluations / len(teachers_data) if teachers_data else 0
    if taux_evaluations < 5:
        rapport.append("üìä Observation: Faible nombre d'√©valuations")
        rapport.append(f"   ‚Ä¢ Moyenne actuelle: {taux_evaluations:.1f} √©valuations/enseignant")
    
    rapport.append("")
    rapport.append("=" * 70)
    rapport.append("‚úÖ FIN DU RAPPORT")
    rapport.append("=" * 70)
    
    return "\\n".join(rapport)

# G√©n√©ration et affichage du rapport
print(generer_rapport_complet(teachers_data))`,

                'data_validation': `# === VALIDATION DE LA QUALIT√â DES DONN√âES ===
def valider_donnees(teachers_data):
    """Valide la qualit√© et la compl√©tude des donn√©es"""
    if not teachers_data:
        return "‚ö†Ô∏è Aucune donn√©e √† valider"
    
    rapport = []
    rapport.append("=== üîç VALIDATION DE LA QUALIT√â DES DONN√âES ===")
    
    total = len(teachers_data)
    erreurs_par_type = Counter()
    enseignants_problemes = []
    
    for idx, teacher in enumerate(teachers_data):
        problemes = []
        
        # V√©rification des champs obligatoires
        if not teacher.get('lastName') or not teacher.get('firstName'):
            problemes.append("Nom/pr√©nom manquant")
            erreurs_par_type['identite'] += 1
        
        if not teacher.get('matricule'):
            problemes.append("Matricule manquant")
            erreurs_par_type['matricule'] += 1
        
        if not teacher.get('establishment'):
            problemes.append("√âtablissement manquant")
            erreurs_par_type['etablissement'] += 1
        
        # V√©rification des donn√©es structurelles
        if teacher.get('data'):
            data = teacher['data']
            
            # Informations personnelles
            if data.get('personal'):
                personal = data['personal']
                if not personal.get('birth_date'):
                    problemes.append("Date de naissance manquante")
                    erreurs_par_type['naissance'] += 1
            
            # Informations professionnelles
            if data.get('professional'):
                professional = data['professional']
                if not professional.get('engagement_date'):
                    problemes.append("Date d'engagement manquante")
                    erreurs_par_type['engagement'] += 1
            
            # Mati√®res enseign√©es
            if not data.get('subjects') or len(data.get('subjects', [])) == 0:
                problemes.append("Aucune mati√®re enseign√©e")
                erreurs_par_type['matieres'] += 1
        
        if problemes:
            enseignants_problemes.append({
                'nom': teacher.get('fullName', f'Enseignant {idx+1}'),
                'problemes': problemes,
                'matricule': teacher.get('matricule', 'Non sp√©cifi√©')
            })
    
    # R√©sum√©
    rapport.append(f"üë• Total enseignants analys√©s: {total}")
    rapport.append(f"‚úÖ Enseignants sans probl√®mes: {total - len(enseignants_problemes)} ({((total - len(enseignants_problemes))/total*100):.1f}%)")
    rapport.append(f"‚ùå Enseignants avec probl√®mes: {len(enseignants_problemes)} ({len(enseignants_problemes)/total*100:.1f}%)")
    
    rapport.append("")
    rapport.append("=== üìä R√âPARTITION DES PROBL√àMES ===")
    for type_erreur, count in erreurs_par_type.most_common():
        pourcentage = count / total * 100
        rapport.append(f"üî¥ {type_erreur}: {count} occurrences ({pourcentage:.1f}%)")
    
    rapport.append("")
    rapport.append("=== üë®‚Äçüè´ ENSEIGNANTS AVEC PROBL√àMES (TOP 10) ===")
    for enseignant in enseignants_problemes[:10]:
        rapport.append(f"üìå {enseignant['nom']} ({enseignant['matricule']})")
        for probleme in enseignant['problemes']:
            rapport.append(f"   ‚Ä¢ {probleme}")
    
    # Recommandations
    rapport.append("")
    rapport.append("=== üí° RECOMMANDATIONS ===")
    
    if erreurs_par_type['identite'] > 0:
        rapport.append("1. üî∏ Compl√©ter les noms et pr√©noms manquants")
    
    if erreurs_par_type['matricule'] > 0:
        rapport.append("2. üî∏ Ajouter les num√©ros de matricule")
    
    if erreurs_par_type['etablissement'] > 0:
        rapport.append("3. üî∏ Sp√©cifier les √©tablissements")
    
    if erreurs_par_type['matieres'] > 0:
        rapport.append("4. üî∏ Ajouter les mati√®res enseign√©es")
    
    return "\\n".join(rapport)

print(valider_donnees(teachers_data))`
            };
            
            const editor = document.getElementById('pythonEditor');
            if (templates[templateName]) {
                editor.value = templates[templateName];
                showNotification(`Mod√®le "${templateName}" charg√©`, 'success');
                
                // Mettre √† jour les statistiques Python
                updatePythonStats();
            } else {
                showNotification('Mod√®le non trouv√©', 'warning');
            }
        }

        function savePythonScript() {
            const pythonCode = document.getElementById('pythonEditor').value;
            if (!pythonCode.trim()) {
                showNotification('Aucun code √† sauvegarder', 'warning');
                return;
            }
            
            const blob = new Blob([pythonCode], { type: 'text/x-python' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `analyse_enseignants_${new Date().toISOString().split('T')[0]}.py`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('Script Python sauvegard√©', 'success');
        }

        function clearPythonOutput() {
            document.getElementById('pythonOutput').innerHTML = 
                '<span style="color: #4CAF50;">Sortie Python s\'affichera ici...</span><br><br>' +
                '<span style="color: #888; font-size: 0.9em;">Ex√©cutez le script pour voir les r√©sultats d\'analyse.</span>';
        }

        function updatePythonStats() {
            if (!teachersData || teachersData.length === 0) {
                document.getElementById('pythonTeacherCount').textContent = '0';
                document.getElementById('pythonCompleteCount').textContent = '0';
                document.getElementById('pythonSubjectsCount').textContent = '0';
                document.getElementById('pythonEstablishmentsCount').textContent = '0';
                return;
            }
            
            const totalTeachers = teachersData.length;
            const completeTeachers = teachersData.filter(t => t.complete).length;
            
            // Compter les mati√®res uniques
            const subjectSet = new Set();
            teachersData.forEach(teacher => {
                if (teacher.data && teacher.data.subjects) {
                    teacher.data.subjects.forEach(subject => {
                        if (subject && subject.name) subjectSet.add(subject.name);
                    });
                }
            });
            
            // Compter les √©tablissements uniques
            const establishmentSet = new Set();
            teachersData.forEach(teacher => {
                if (teacher.establishment) {
                    establishmentSet.add(teacher.establishment);
                }
            });
            
            document.getElementById('pythonTeacherCount').textContent = totalTeachers;
            document.getElementById('pythonCompleteCount').textContent = completeTeachers;
            document.getElementById('pythonSubjectsCount').textContent = subjectSet.size;
            document.getElementById('pythonEstablishmentsCount').textContent = establishmentSet.size;
        }

        // ============================================
        // FONCTIONS DE GESTION COMPL√àTES
        // ============================================

        function clearAllData() {
            if (teachersData.length === 0) {
                showNotification('Aucune donn√©e √† effacer', 'info');
                return;
            }
            
            if (confirm('√ätes-vous s√ªr de vouloir effacer toutes les donn√©es ? Cette action est irr√©versible.')) {
                teachersData = [];
                filteredTeachers = [];
                filteredProjects = [];
                filteredEvaluations = [];
                
                // R√©initialiser l'interface
                document.getElementById('importedFilesSection').style.display = 'none';
                document.getElementById('overviewSection').style.display = 'none';
                document.getElementById('dataPreviewSection').style.display = 'none';
                
                updateTeachersList();
                updateDashboard();
                updatePedagogyOverview();
                updateEvaluationsOverview();
                updateProjectsOverview();
                updateRetirementOverview();
                updateExportPreview();
                updatePythonStats();
                
                // Effacer le localStorage
                localStorage.removeItem('teachersAnalyticsData');
                
                showNotification('Toutes les donn√©es ont √©t√© effac√©es', 'success');
            }
        }

        function generateReport() {
            if (teachersData.length === 0) {
                showNotification('Aucune donn√©e pour g√©n√©rer un rapport', 'warning');
                return;
            }
            
            showLoader(true);
            
            try {
                // Cr√©er un rapport simple en HTML
                const reportWindow = window.open('', '_blank');
                const reportDate = new Date().toLocaleString();
                
                let reportHTML = `
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <title>Rapport d'analyse enseignants - ${reportDate}</title>
                        <style>
                            body { font-family: Arial, sans-serif; margin: 20px; }
                            h1 { color: #2c3e50; }
                            h2 { color: #3498db; border-bottom: 2px solid #3498db; padding-bottom: 5px; }
                            .stat-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px 0; }
                            .stat-card { background: #f8f9fa; padding: 15px; border-radius: 5px; text-align: center; border: 1px solid #dee2e6; }
                            .stat-value { font-size: 2rem; font-weight: bold; color: #3498db; margin: 10px 0; }
                            table { width: 100%; border-collapse: collapse; margin: 20px 0; }
                            th { background: #3498db; color: white; padding: 10px; text-align: left; }
                            td { padding: 8px 10px; border-bottom: 1px solid #ddd; }
                            tr:hover { background: #f5f5f5; }
                            .badge { padding: 3px 8px; border-radius: 10px; font-size: 0.8rem; }
                            .badge-success { background: #d4edda; color: #155724; }
                            .badge-warning { background: #fff3cd; color: #856404; }
                            .footer { margin-top: 40px; padding-top: 20px; border-top: 1px solid #ddd; color: #666; font-size: 0.9em; }
                        </style>
                    </head>
                    <body>
                        <h1>üìä Rapport d'analyse des enseignants</h1>
                        <p>Date de g√©n√©ration: ${reportDate}</p>
                        
                        <h2>üìà Statistiques globales</h2>
                        <div class="stat-grid">
                `;
                
                const totalTeachers = teachersData.length;
                const completeTeachers = teachersData.filter(t => t.complete).length;
                const averageAge = calculateAverage(teachersData.map(t => t.age).filter(age => age !== null));
                const averageService = calculateAverage(teachersData.map(t => t.serviceYears).filter(years => years !== null));
                const subjectCount = countUniqueSubjects();
                const establishmentCount = [...new Set(teachersData.map(t => t.establishment).filter(Boolean))].length;
                const upcomingRetirements = teachersData.filter(t => t.yearsToRetirement !== null && t.yearsToRetirement <= 5).length;
                
                reportHTML += `
                            <div class="stat-card">
                                <div>Enseignants total</div>
                                <div class="stat-value">${totalTeachers}</div>
                            </div>
                            <div class="stat-card">
                                <div>Fiches compl√®tes</div>
                                <div class="stat-value">${completeTeachers}</div>
                                <div>${totalTeachers > 0 ? ((completeTeachers / totalTeachers) * 100).toFixed(1) : 0}%</div>
                            </div>
                            <div class="stat-card">
                                <div>√Çge moyen</div>
                                <div class="stat-value">${averageAge.toFixed(1)}</div>
                                <div>ans</div>
                            </div>
                            <div class="stat-card">
                                <div>Service moyen</div>
                                <div class="stat-value">${averageService.toFixed(1)}</div>
                                <div>ans</div>
                            </div>
                            <div class="stat-card">
                                <div>Mati√®res</div>
                                <div class="stat-value">${subjectCount}</div>
                                <div>diff√©rentes</div>
                            </div>
                            <div class="stat-card">
                                <div>√âtablissements</div>
                                <div class="stat-value">${establishmentCount}</div>
                                <div>diff√©rents</div>
                            </div>
                        </div>
                        
                        <h2>üë• Liste des enseignants</h2>
                        <table>
                            <thead>
                                <tr>
                                    <th>Nom</th>
                                    <th>Matricule</th>
                                    <th>√âtablissement</th>
                                    <th>√Çge</th>
                                    <th>Service</th>
                                    <th>Retraite</th>
                                    <th>Statut</th>
                                </tr>
                            </thead>
                            <tbody>
                `;
                
                teachersData.forEach(teacher => {
                    reportHTML += `
                        <tr>
                            <td>${teacher.fullName}</td>
                            <td>${teacher.matricule || ''}</td>
                            <td>${teacher.establishment || ''}</td>
                            <td>${teacher.age || ''}</td>
                            <td>${teacher.serviceYears || ''}</td>
                            <td>${teacher.yearsToRetirement !== null ? `${teacher.yearsToRetirement} ans` : ''}</td>
                            <td><span class="badge ${teacher.complete ? 'badge-success' : 'badge-warning'}">${teacher.complete ? 'Complet' : 'Incomplet'}</span></td>
                        </tr>
                    `;
                });
                
                reportHTML += `
                            </tbody>
                        </table>
                        
                        <h2>üìä Analyse par √©tablissement</h2>
                        <table>
                            <thead>
                                <tr>
                                    <th>√âtablissement</th>
                                    <th>Nombre d'enseignants</th>
                                    <th>Pourcentage</th>
                                </tr>
                            </thead>
                            <tbody>
                `;
                
                // Compter par √©tablissement
                const establishmentCounts = {};
                teachersData.forEach(teacher => {
                    const etab = teacher.establishment || 'Non sp√©cifi√©';
                    establishmentCounts[etab] = (establishmentCounts[etab] || 0) + 1;
                });
                
                Object.entries(establishmentCounts).forEach(([etab, count]) => {
                    const percentage = totalTeachers > 0 ? ((count / totalTeachers) * 100).toFixed(1) : 0;
                    reportHTML += `
                        <tr>
                            <td>${etab}</td>
                            <td>${count}</td>
                            <td>${percentage}%</td>
                        </tr>
                    `;
                });
                
                reportHTML += `
                            </tbody>
                        </table>
                        
                        <div class="footer">
                            <p>Rapport g√©n√©r√© automatiquement par la Plateforme d'Analyse - Inspecteurs √âducation</p>
                            <p>Nombre total de fichiers import√©s: ${teachersData.reduce((sum, t) => sum + (t.files ? t.files.length : 0), 0)}</p>
                        </div>
                    </body>
                    </html>
                `;
                
                reportWindow.document.write(reportHTML);
                reportWindow.document.close();
                
                showNotification('Rapport g√©n√©r√© avec succ√®s', 'success');
                
            } catch (error) {
                console.error('Erreur lors de la g√©n√©ration du rapport:', error);
                showNotification('Erreur lors de la g√©n√©ration du rapport: ' + error.message, 'error');
            } finally {
                showLoader(false);
            }
        }

        function saveSession() {
            if (teachersData.length === 0) {
                showNotification('Aucune donn√©e √† sauvegarder', 'warning');
                return;
            }
            
            const sessionData = {
                teachers: teachersData,
                timestamp: new Date().toISOString(),
                version: '1.0'
            };
            
            try {
                localStorage.setItem('teachersAnalyticsData', JSON.stringify(sessionData));
                showNotification('Session sauvegard√©e avec succ√®s', 'success');
            } catch (error) {
                console.error('Erreur lors de la sauvegarde:', error);
                showNotification('Erreur lors de la sauvegarde: ' + error.message, 'error');
            }
        }

        function loadSessionData() {
            try {
                const savedData = localStorage.getItem('teachersAnalyticsData');
                if (savedData) {
                    const sessionData = JSON.parse(savedData);
                    if (sessionData.teachers && Array.isArray(sessionData.teachers)) {
                        teachersData = sessionData.teachers;
                        updateUIAfterImport();
                        showNotification('Session pr√©c√©dente charg√©e avec succ√®s', 'success');
                    }
                }
            } catch (error) {
                console.error('Erreur lors du chargement de la session:', error);
                // Ne pas afficher d'erreur pour ne pas perturber l'utilisateur
            }
        }

        function backupData() {
            if (teachersData.length === 0) {
                showNotification('Aucune donn√©e √† sauvegarder', 'warning');
                return;
            }
            
            const backupData = {
                teachers: teachersData,
                timestamp: new Date().toISOString(),
                version: '1.0',
                exportType: 'backup'
            };
            
            const blob = new Blob([JSON.stringify(backupData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `backup_enseignants_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('Sauvegarde des donn√©es export√©e avec succ√®s', 'success');
        }

        // ============================================
        // FONCTIONS DE PARAM√àTRES
        // ============================================

        function showSettings() {
            // Charger les param√®tres actuels dans le modal
            document.getElementById('languageSetting').value = appSettings.language;
            document.getElementById('themeSetting').value = appSettings.theme;
            document.getElementById('autoSaveSetting').checked = appSettings.autoSave;
            document.getElementById('notificationsSetting').checked = appSettings.notifications;
            document.getElementById('fontSizeSetting').value = appSettings.fontSize;
            
            document.getElementById('settingsModal').classList.add('active');
        }

        function closeSettings() {
            document.getElementById('settingsModal').classList.remove('active');
        }

        function loadSettings() {
            try {
                const savedSettings = localStorage.getItem('teachersAnalyticsSettings');
                if (savedSettings) {
                    appSettings = { ...appSettings, ...JSON.parse(savedSettings) };
                }
            } catch (error) {
                console.error('Erreur lors du chargement des param√®tres:', error);
            }
        }

        function saveSettings() {
            appSettings.language = document.getElementById('languageSetting').value;
            appSettings.theme = document.getElementById('themeSetting').value;
            appSettings.autoSave = document.getElementById('autoSaveSetting').checked;
            appSettings.notifications = document.getElementById('notificationsSetting').checked;
            appSettings.fontSize = document.getElementById('fontSizeSetting').value;
            
            try {
                localStorage.setItem('teachersAnalyticsSettings', JSON.stringify(appSettings));
                applySettings();
                closeSettings();
                showNotification('Param√®tres sauvegard√©s avec succ√®s', 'success');
            } catch (error) {
                console.error('Erreur lors de la sauvegarde des param√®tres:', error);
                showNotification('Erreur lors de la sauvegarde des param√®tres', 'error');
            }
        }

        function applySettings() {
            // Appliquer le th√®me
            document.body.setAttribute('data-theme', appSettings.theme);
            
            // Appliquer la taille des polices
            document.body.style.fontSize = {
                small: '14px',
                medium: '16px',
                large: '18px'
            }[appSettings.fontSize] || '16px';
            
            // Appliquer la langue
            // (√Ä impl√©menter si on ajoute des traductions)
        }

        // ============================================
        // FONCTIONS UTILITAIRES
        // ============================================

        function showNotification(message, type = 'success') {
            if (!appSettings.notifications) return;
            
            const notification = document.getElementById('notification');
            const icon = document.getElementById('notificationIcon');
            const messageElement = document.getElementById('notificationMessage');
            
            // Mettre √† jour le message et le type
            messageElement.textContent = message;
            notification.className = 'notification';
            
            // D√©finir l'ic√¥ne et la couleur selon le type
            switch(type) {
                case 'error':
                    notification.classList.add('error');
                    icon.className = 'fas fa-exclamation-circle';
                    break;
                case 'warning':
                    notification.classList.add('warning');
                    icon.className = 'fas fa-exclamation-triangle';
                    break;
                case 'info':
                    notification.classList.add('info');
                    icon.className = 'fas fa-info-circle';
                    break;
                default:
                    notification.classList.add('success');
                    icon.className = 'fas fa-check-circle';
            }
            
            // Afficher la notification
            notification.classList.add('show');
            
            // Masquer automatiquement apr√®s 5 secondes
            setTimeout(() => {
                notification.classList.remove('show');
            }, 5000);
        }

        function showLoader(show) {
            const loader = document.getElementById('loader');
            if (show) {
                loader.classList.add('active');
            } else {
                loader.classList.remove('active');
            }
        }

        // ============================================
        // FONCTIONS MANQUANTES (pour √©viter les erreurs)
        // ============================================

        function updateProjectsCalendar() {
            // √Ä impl√©menter
            const container = document.getElementById('projectsCalendar');
            if (container) {
                container.innerHTML = '<p class="text-center">Calendrier des projets en cours de d√©veloppement</p>';
            }
        }

        function updateRetirementCalendar() {
            // √Ä impl√©menter
            const container = document.getElementById('retirementCalendar');
            if (container) {
                container.innerHTML = '<p class="text-center">Calendrier des retraites en cours de d√©veloppement</p>';
            }
        }

        function updateReplacementPlan() {
            // √Ä impl√©menter
            const container = document.getElementById('replacementPlan');
            if (container) {
                container.innerHTML = '<p class="text-center">Plan de remplacement en cours de d√©veloppement</p>';
            }
        }

    </script>
</body>
</html>
